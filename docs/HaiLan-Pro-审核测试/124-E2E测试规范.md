---
file: 124-E2E测试规范.md
description: HaiLan Pro 端到端测试规范，包含用户场景测试、跨端测试、性能测试
author: YanYuCloudCube Team
version: v1.0.0
created: 2026-01-26
updated: 2026-01-26
status: published
tags:
  - HaiLan-Pro-审核测试,[]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 124 E2E测试规范

## 概述

本文档详细描述HaiLan Pro-HaiLan-Pro-审核测试-E2E测试规范相关内容，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范E2E测试规范相关的业务标准与技术落地要求
- 为项目相关人员提供清晰的参考依据
- 保障相关模块开发、实施、运维的一致性与规范性

### 2. 设计原则

#### 2.1 五高原则
- **高可用性**：确保系统7x24小时稳定运行，支持PWA离线能力
- **高性能**：优化响应时间和处理能力，支持高并发访问
- **高安全性**：保护用户数据和隐私安全，双重加密机制
- **高扩展性**：支持业务快速扩展，微服务架构设计
- **高可维护性**：便于后续维护和升级，模块化设计

#### 2.2 五标体系
- **标准化**：统一的技术和流程标准
- **规范化**：严格的开发和管理规范
- **自动化**：提高开发效率和质量，CI/CD自动化
- **智能化**：利用AI技术提升能力，LLM智能顾问
- **可视化**：直观的监控和管理界面

#### 2.3 五化架构
- **流程化**：标准化的开发流程
- **文档化**：完善的文档体系
- **工具化**：高效的开发工具链
- **数字化**：数据驱动的决策
- **生态化**：开放的生态系统

### 3. E2E测试规范

#### 3.1 测试框架配置

HaiLan Pro 使用 Playwright 作为 E2E 测试框架，支持多浏览器跨端测试。

```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,

  reporter: [
    ['html', { outputFolder: 'playwright-report' }],
    ['json', { outputFile: 'test-results.json' }],
    ['junit', { outputFile: 'junit-results.xml' }],
  ],

  use: {
    baseURL: 'https://hailan.pro',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
    viewport: { width: 375, height: 812 }, // Mobile first
    locale: 'zh-CN',
    timezoneId: 'Asia/Shanghai',
  },

  projects: [
    // Desktop browsers
    {
      name: 'chromium-desktop',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox-desktop',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit-desktop',
      use: { ...devices['Desktop Safari'] },
    },
    // Mobile devices
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
    {
      name: 'Mobile Safari',
      use: { ...devices['iPhone 12'] },
    },
    // PWA testing
    {
      name: 'PWA Mode',
      use: {
        ...devices['Pixel 5'],
        serviceWorkers: 'allow',
      },
    },
  ],

  webServer: {
    command: 'bun run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
    timeout: 120 * 1000,
  },
});
```

#### 3.2 用户注册登录流程测试

```typescript
// e2e/auth-flow.spec.ts
import { test, expect, Page } from '@playwright/test';

test.describe('用户注册登录 E2E 测试', () => {
  test('完整注册流程', async ({ page }) => {
    // 1. 访问首页
    await page.goto('/');
    await expect(page.locator('h1')).toContainText('海蓝');

    // 2. 点击注册按钮
    await page.click('button:has-text("注册")');
    await expect(page).toHaveURL(/\/register/);

    // 3. 填写注册表单
    await page.fill('[name="email"]', 'e2e-test@hailan.pro');
    await page.fill('[name="password"]', 'SecurePass123!');
    await page.fill('[name="confirmPassword"]', 'SecurePass123!');
    await page.selectOption('[name="privacyLevel"]', 'STANDARD');

    // 4. 同意条款
    await page.check('[name="agreeTerms"]');

    // 5. 提交注册
    await page.click('button[type="submit"]');

    // 6. 验证注册成功
    await expect(page).toHaveURL(/\/dashboard/);
    await expect(page.locator('.welcome-message')).toContainText('欢迎来到海蓝');

    // 7. 验证用户信息显示
    await expect(page.locator('.user-email')).toContainText('e2e-test@hailan.pro');
    await expect(page.locator('.privacy-badge')).toContainText('标准模式');
  });

  test('登录并访问个人中心', async ({ page }) => {
    // 1. 访问登录页
    await page.goto('/login');

    // 2. 输入凭据
    await page.fill('[name="email"]', 'e2e-test@hailan.pro');
    await page.fill('[name="password"]', 'SecurePass123!');

    // 3. 提交登录
    await page.click('button[type="submit"]');

    // 4. 验证跳转到首页
    await expect(page).toHaveURL('/');

    // 5. 访问个人中心
    await page.click('[data-testid="profile-menu"]');
    await page.click('a:has-text("个人中心")');

    // 6. 验证个人信息页面
    await expect(page).toHaveURL(/\/profile/);
    await expect(page.locator('h2')).toContainText('个人中心');
  });

  test('隐私模式切换完整流程', async ({ page }) => {
    // 登录
    await page.goto('/login');
    await page.fill('[name="email"]', 'e2e-test@hailan.pro');
    await page.fill('[name="password"]', 'SecurePass123!');
    await page.click('button[type="submit"]');

    // 进入隐私设置
    await page.click('[data-testid="settings-menu"]');
    await page.click('a:has-text("隐私设置")');

    // 切换到隐身模式
    await page.click('[data-testid="privacy-stealth-mode"]');
    await page.click('button:has-text("确认切换")');

    // 验证模式切换提示
    await expect(page.locator('.toast-message')).toContainText('已切换到隐身模式');

    // 验证敏感信息已脱敏
    await page.goto('/profile');
    const emailElement = page.locator('.user-email');
    await expect(emailElement).toContainText('***@hailan.pro');

    // 验证浏览历史不显示
    await page.goto('/history');
    await expect(page.locator('.empty-state')).toContainText('浏览历史已隐藏');
  });
});
```

#### 3.3 商品浏览与购买流程测试

```typescript
// e2e/shopping-flow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('商品浏览购买 E2E 测试', () => {
  test.beforeEach(async ({ page }) => {
    // 登录
    await page.goto('/login');
    await page.fill('[name="email"]', 'e2e-test@hailan.pro');
    await page.fill('[name="password"]', 'SecurePass123!');
    await page.click('button[type="submit"]');
    await page.waitForURL('/');
  });

  test('完整购买流程', async ({ page }) => {
    // 1. 浏览商品列表
    await page.goto('/products');
    await expect(page.locator('.product-list')).toBeVisible();

    // 2. 搜索商品
    await page.fill('[name="search"]', '健康监测');
    await page.press('[name="search"]', 'Enter');
    await expect(page.locator('.product-card')).toHaveCount(3);

    // 3. 点击第一个商品
    await page.click('.product-card:first-child');
    await expect(page).toHaveURL(/\/products\/.+/);

    // 4. 查看商品详情
    await expect(page.locator('.product-name')).toBeVisible();
    await expect(page.locator('.product-price')).toBeVisible();
    await expect(page.locator('.product-description')).toBeVisible();

    // 5. 选择规格
    await page.click('[data-spec="color-blue"]');
    await page.selectOption('[name="quantity"]', '2');

    // 6. 加入购物车
    await page.click('button:has-text("加入购物车")');
    await expect(page.locator('.cart-badge')).toContainText('2');

    // 7. 进入购物车
    await page.click('[data-testid="cart-icon"]');
    await expect(page).toHaveURL('/cart');

    // 8. 确认订单
    await expect(page.locator('.cart-item')).toHaveCount(1);
    await page.click('button:has-text("去结算")');

    // 9. 填写收货地址（伪装模式）
    await page.fill('[name="receiverName"]', '张先生');
    await page.fill('[name="receiverPhone"]', '138****8888');
    await page.fill('[name="address"]', '北京市朝阳区某某街道');

    // 10. 选择支付方式
    await page.click('[data-payment="wechat"]');
    await page.click('button:has-text("提交订单")');

    // 11. 确认支付跳转
    await expect(page.locator('.payment-modal')).toBeVisible();
    await expect(page.locator('.order-amount')).toContainText('¥');
  });

  test('AI 推荐商品流程', async ({ page }) => {
    // 1. 打开 AI 助手
    await page.click('[data-testid="ai-assistant"]');
    await expect(page.locator('.ai-chat-panel')).toBeVisible();

    // 2. 发送咨询
    await page.fill('.chat-input', '我想找适合初次使用的产品');
    await page.click('button:has-text("发送")');

    // 3. 等待 AI 回复
    await expect(page.locator('.ai-message.assistant')).toBeVisible({ timeout: 5000 });

    // 4. 点击推荐商品
    await page.click('.ai-recommendation-card:first-child');

    // 5. 验证跳转到商品详情
    await expect(page).toHaveURL(/\/products\/.+/);
  });

  test('隐私模式下的购物体验', async ({ page }) => {
    // 切换到伪装模式
    await page.click('[data-testid="settings-menu"]');
    await page.click('a:has-text("隐私设置")');
    await page.click('[data-testid="privacy-disguise-mode"]');
    await page.click('button:has-text("确认切换")');

    // 浏览商品
    await page.goto('/products');

    // 验证商品图片正常显示（伪装模式不影响商品展示）
    await expect(page.locator('.product-image').first()).toBeVisible();

    // 添加到购物车
    await page.click('.product-card:first-child');
    await page.click('button:has-text("加入购物车")');

    // 进入结算
    await page.click('[data-testid="cart-icon"]');
    await page.click('button:has-text("去结算")');

    // 验证收货地址虚拟化提示
    await expect(page.locator('.disguise-address-notice')).toContainText('虚拟地址');
  });
});
```

#### 3.4 PWA 功能测试

```typescript
// e2e/pwa-functionality.spec.ts
import { test, expect } from '@playwright/test';

test.describe('PWA 功能 E2E 测试', () => {
  test('Service Worker 注册与缓存', async ({ page }) => {
    // 1. 访问应用
    await page.goto('/');

    // 2. 验证 Service Worker 注册
    const swRegistration = await page.evaluate(async () => {
      return await navigator.serviceWorker.ready;
    });
    expect(swRegistration).toBeTruthy();
    expect(swRegistration.active).toBeTruthy();

    // 3. 验证缓存策略
    const cachedResources = await page.evaluate(async () => {
      const cache = await caches.open('hailan-static-v1');
      return await cache.keys();
    });
    expect(cachedResources.length).toBeGreaterThan(0);

    // 4. 模拟离线状态
    await page.context().setOffline(true);
    await page.reload();

    // 5. 验证离线页面可访问
    await expect(page.locator('h1')).toContainText('海蓝');
    await expect(page.locator('.offline-indicator')).toBeVisible();

    // 6. 恢复在线
    await page.context().setOffline(false);
  });

  test('PWA 安装流程', async ({ page }) => {
    // 1. 访问应用
    await page.goto('/');

    // 2. 等待安装提示（首次访问）
    await page.waitForTimeout(3000);

    // 3. 检查安装提示是否显示
    const installPrompt = page.locator('.pwa-install-prompt');

    // 注意：在测试环境中可能不会触发真实的安装提示
    // 这里测试安装按钮的逻辑
    await page.evaluate(() => {
      const event = new Event('beforeinstallprompt');
      window.dispatchEvent(event);
    });

    // 4. 点击安装按钮
    if (await installPrompt.isVisible()) {
      await installPrompt.click();
      await expect(page.locator('.install-modal')).toBeVisible();
    }
  });

  test('离线数据同步', async ({ page, context }) => {
    // 1. 登录
    await page.goto('/login');
    await page.fill('[name="email"]', 'e2e-test@hailan.pro');
    await page.fill('[name="password"]', 'SecurePass123!');
    await page.click('button[type="submit"]');

    // 2. 离线状态下添加商品到购物车
    await context.setOffline(true);
    await page.goto('/products');
    await page.click('.product-card:first-child');
    await page.click('button:has-text("加入购物车")');

    // 3. 验证离线提示
    await expect(page.locator('.sync-pending')).toBeVisible();

    // 4. 恢复在线
    await context.setOffline(false);
    await page.reload();

    // 5. 验证数据已同步
    await page.click('[data-testid="cart-icon"]');
    await expect(page.locator('.cart-item')).toHaveCount(1);
  });
});
```

#### 3.5 IoT 设备连接测试

```typescript
// e2e/iot-device.spec.ts
import { test, expect } from '@playwright/test';

test.describe('IoT 设备 E2E 测试', () => {
  test('蓝牙设备连接流程', async ({ page }) => {
    // 1. 登录
    await page.goto('/login');
    await page.fill('[name="email"]', 'e2e-test@hailan.pro');
    await page.fill('[name="password"]', 'SecurePass123!');
    await page.click('button[type="submit"]');

    // 2. 进入设备管理
    await page.click('[data-testid="device-menu"]');
    await page.click('a:has-text("我的设备")');

    // 3. 点击添加设备
    await page.click('button:has-text("添加设备")');

    // 4. 模拟蓝牙权限请求（需要在支持蓝牙的浏览器中测试）
    const bluetoothMock = await page.evaluateHandle(() => ({
      requestDevice: () => Promise.resolve({
        id: 'mock-device-001',
        name: 'HaiLan Device',
      }),
    }));

    // 5. 选择设备
    await page.click('.device-list-item:has-text("HaiLan Device")');
    await page.click('button:has-text("连接")');

    // 6. 验证连接成功
    await expect(page.locator('.connection-status')).toContainText('已连接');
    await expect(page.locator('.device-info')).toContainText('HaiLan Device');
  });

  test('设备数据查看与同步', async ({ page }) => {
    // 前置：已连接设备
    await page.goto('/devices');

    // 1. 点击设备查看详情
    await page.click('.device-card');

    // 2. 验证设备数据展示
    await expect(page.locator('.device-battery')).toBeVisible();
    await expect(page.locator('.device-usage')).toBeVisible();
    await expect(page.locator('.device-history')).toBeVisible();

    // 3. 手动同步数据
    await page.click('button:has-text("同步数据")');
    await expect(page.locator('.syncing-indicator')).toBeVisible();

    // 4. 等待同步完成
    await expect(page.locator('.sync-complete')).toBeVisible({ timeout: 10000 });
  });
});
```

#### 3.6 支付流程测试

```typescript
// e2e/payment-flow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('支付流程 E2E 测试', () => {
  test.beforeEach(async ({ page }) => {
    // 登录并添加商品到购物车
    await page.goto('/login');
    await page.fill('[name="email"]', 'e2e-test@hailan.pro');
    await page.fill('[name="password"]', 'SecurePass123!');
    await page.click('button[type="submit"]');

    await page.goto('/products/test-product-001');
    await page.click('button:has-text("加入购物车")');
    await page.click('[data-testid="cart-icon"]');
    await page.click('button:has-text("去结算")');
  });

  test('微信支付流程', async ({ page }) => {
    // 1. 选择微信支付
    await page.click('[data-payment="wechat"]');
    await page.click('button:has-text("提交订单")');

    // 2. 验证支付页面
    await expect(page).toHaveURL(/\/payment\/.+/);
    await expect(page.locator('.payment-qr-code')).toBeVisible();

    // 3. 模拟支付成功（测试环境）
    await page.evaluate(() => {
      window.postMessage({ type: 'PAYMENT_SUCCESS', orderId: 'TEST-ORDER-001' }, '*');
    });

    // 4. 验证跳转到支付成功页
    await expect(page).toHaveURL(/\/payment\/success/);
    await expect(page.locator('.order-id')).toContainText('TEST-ORDER-001');
  });

  test('支付宝支付流程', async ({ page }) => {
    // 1. 选择支付宝
    await page.click('[data-payment="alipay"]');
    await page.click('button:has-text("提交订单")');

    // 2. 验证跳转到支付宝
    await expect(page.locator('.alipay-redirect-notice')).toBeVisible();
  });

  test('隐私模式下的支付流程', async ({ page }) => {
    // 1. 切换到伪装模式
    await page.click('[data-testid="privacy-toggle"]');
    await page.click('[data-mode="disguise"]');

    // 2. 完成支付流程
    await page.click('[data-payment="wechat"]');
    await page.click('button:has-text("提交订单")');

    // 3. 验证支付单据虚拟化
    await page.evaluate(() => {
      window.postMessage({ type: 'PAYMENT_SUCCESS' }, '*');
    });

    // 4. 查看订单详情
    await page.goto('/orders');
    await page.click('.order-item:first-child');

    // 5. 验证商品描述已虚拟化
    await expect(page.locator('.order-items')).toContainText('虚拟商品');
  });
});
```

#### 3.7 跨平台兼容性测试

```typescript
// e2e/cross-platform.spec.ts
import { test, expect, devices } from '@playwright/test';

test.describe('跨平台 E2E 测试', () => {
  // iOS Safari 测试
  test('iOS Safari 完整流程', async ({ page }) => {
    test.info().annotations.push({ type: 'device', description: 'iPhone 12' });

    await page.goto('/');
    await expect(page.locator('h1')).toContainText('海蓝');

    // 测试 iOS 特有功能
    const isSafari = await page.evaluate(() => {
      return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
    });

    if (isSafari) {
      // 测试 Safari 特定功能
      await expect(page.locator('.ios-safe-area-bottom')).toBeVisible();
    }
  });

  // Android Chrome 测试
  test('Android Chrome 完整流程', async ({ page }) => {
    test.info().annotations.push({ type: 'device', description: 'Pixel 5' });

    await page.goto('/');

    // 测试 Android 特有功能
    const isAndroid = await page.evaluate(() => {
      return /android/i.test(navigator.userAgent);
    });

    if (isAndroid) {
      // 测试 Android 返回键处理
      await page.goBack();
      await expect(page).toHaveURL('/');
    }
  });

  // 桌面浏览器测试
  test('Desktop Chrome 完整流程', async ({ page }) => {
    test.info().annotations.push({ type: 'device', description: 'Desktop Chrome' });

    await page.goto('/');

    // 测试桌面端特有功能
    await expect(page.locator('[data-desktop-nav]')).toBeVisible();

    // 测试键盘快捷键
    await page.keyboard.press('Control+K');
    await expect(page.locator('.search-modal')).toBeVisible();
  });
});
```

---

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

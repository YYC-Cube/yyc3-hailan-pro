---
file: 024-数据库设计文档.md
description: HaiLan Pro 数据库表结构、关系、索引、分库分表的详细设计，保障数据存储规范
author: YanYuCloudCube Team
version: v1.0.0
created: 2026-01-26
updated: 2026-02-03
status: published
tags:
  - 架构设计,[数据库],[表结构设计]
---

> ***YanYuCloudCube***
> 言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> 万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 024 数据库设计文档

## 概述

本文档详细描述HaiLan Pro项目的数据库设计方案，包括表结构设计、索引策略、关系定义、数据约束以及分库分表方案，确保数据存储符合高可用、高性能、高安全性的要求。

## 核心内容

### 1. 数据库架构概述

#### 1.1 数据库选型

HaiLan Pro 采用 Supabase PostgreSQL 作为主数据库，IPFS 作为敏感数据存储层。

**选型理由：**
- **ACID 事务**：订单、支付场景需要强一致性
- **JSONB 支持**：灵活存储用户偏好、设备配置
- **Row Level Security**：数据库级权限控制
- **全文搜索**：内置 tsvector 支持
- **扩展性**：PostGIS、pgcrypto、uuid-ossp 等扩展

#### 1.2 数据库分层

```
┌─────────────────────────────────────────────────────────────┐
│                      应用层                                  │
│              (React Context API)                            │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                 PostgreSQL (Supabase)                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   用户数据    │  │   业务数据    │  │   配置数据    │         │
│  │  (加密存储)  │  │  (明文存储)  │  │  (明文存储)   │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      IPFS 网络                               │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  敏感数据 (加密后)                                     │    │
│  │  - 健康记录                                             │    │
│  │  - AI 对话历史                                          │    │
│  │  - 隐私文档                                             │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### 2. 数据表设计

#### 2.1 用户相关表

##### 2.1.1 users (用户主表)

```sql
CREATE TABLE users (
  -- 主键
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- 去中心化身份
  did VARCHAR(255) UNIQUE NOT NULL,
  did_public_key TEXT,

  -- 联系方式 (加密存储)
  email VARCHAR(255) UNIQUE,
  email_hash VARCHAR(64), -- SHA-256 哈希用于搜索
  phone VARCHAR(50) UNIQUE,
  phone_hash VARCHAR(64),

  -- 隐私设置
  privacy_level VARCHAR(20) DEFAULT 'STANDARD' CHECK (privacy_level IN ('STANDARD', 'STEALTH', 'DISGUISE')),
  privacy_settings JSONB DEFAULT '{}',

  -- 用户状态
  status VARCHAR(20) DEFAULT 'ACTIVE' CHECK (status IN ('ACTIVE', 'SUSPENDED', 'DELETED')),
  email_verified BOOLEAN DEFAULT false,
  phone_verified BOOLEAN DEFAULT false,

  -- 偏好设置
  preferences JSONB DEFAULT '{}',
  language VARCHAR(10) DEFAULT 'zh-CN',
  timezone VARCHAR(50) DEFAULT 'Asia/Shanghai',

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_active TIMESTAMP WITH TIME ZONE,
  deleted_at TIMESTAMP WITH TIME ZONE,

  -- IPFS 引用
  ipfs_profile_cid VARCHAR(255),

  -- 约束
  CONSTRAINT valid_email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$' OR email IS NULL),
  CONSTRAINT valid_phone_format CHECK (phone ~ '^1[3-9][0-9]{9}$' OR phone IS NULL)
);

-- 索引
CREATE INDEX idx_users_did ON users(did);
CREATE INDEX idx_users_email_hash ON users(email_hash);
CREATE INDEX idx_users_phone_hash ON users(phone_hash);
CREATE INDEX idx_users_status ON users(status);
CREATE INDEX idx_users_last_active ON users(last_active DESC);
CREATE INDEX idx_users_created_at ON users(created_at DESC);

-- 触发器：自动更新 updated_at
CREATE TRIGGER update_users_updated_at
  BEFORE UPDATE ON users
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();
```

##### 2.1.2 user_profiles (用户扩展信息)

```sql
CREATE TABLE user_profiles (
  user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,

  -- 显示信息
  display_name VARCHAR(100),
  avatar_url VARCHAR(500),
  banner_url VARCHAR(500),
  bio TEXT,

  -- 个人信息
  gender VARCHAR(20) CHECK (gender IN ('MALE', 'FEMALE', 'OTHER', 'PREFER_NOT_TO_SAY')),
  birth_date DATE,

  -- 兴趣与健康目标
  interests TEXT[],
  health_goals JSONB DEFAULT '[]',

  -- 统计数据
  total_orders INT DEFAULT 0,
  total_spent DECIMAL(12,2) DEFAULT 0,
  loyalty_points INT DEFAULT 0,
  membership_tier VARCHAR(20) DEFAULT 'BRONZE' CHECK (membership_tier IN ('BRONZE', 'SILVER', 'GOLD', 'PLATINUM')),

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 索引
CREATE INDEX idx_user_profiles_display_name ON user_profiles(display_name);
CREATE INDEX idx_user_profiles_membership_tier ON user_profiles(membership_tier);
```

##### 2.1.3 user_addresses (用户地址)

```sql
CREATE TABLE user_addresses (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

  -- 地址信息 (加密存储)
  recipient_name VARCHAR(100), -- 加密
  phone VARCHAR(50), -- 加密
  province VARCHAR(50), -- 加密
  city VARCHAR(50), -- 加密
  district VARCHAR(50), -- 加密
  detail_address TEXT, -- 加密
  postal_code VARCHAR(20),

  -- 隐私设置
  privacy_mode VARCHAR(20) DEFAULT 'NORMAL' CHECK (privacy_mode IN ('NORMAL', 'ENCRYPTED_ADDR', 'ANONYMOUS')),

  -- 标签
  tag VARCHAR(50) CHECK (tag IN ('HOME', 'WORK', 'OTHER')),
  is_default BOOLEAN DEFAULT false,

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 索引
CREATE INDEX idx_user_addresses_user_id ON user_addresses(user_id);
CREATE INDEX idx_user_addresses_is_default ON user_addresses(is_default);
```

#### 2.2 商品相关表

##### 2.2.1 categories (商品分类)

```sql
CREATE TABLE categories (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- 分类编码 (场景导向 + 科学分类)
  code VARCHAR(50) UNIQUE NOT NULL CHECK (code IN ('CARE', 'PLAY', 'INTIMACY', 'LINGERIE', 'SMART')),
  parent_id UUID REFERENCES categories(id),

  -- 分类名称
  name VARCHAR(100) NOT NULL,
  name_en VARCHAR(100),
  slug VARCHAR(100) UNIQUE NOT NULL,

  -- 分类属性
  description TEXT,
  icon_url VARCHAR(500),
  banner_url VARCHAR(500),

  -- 排序与状态
  display_order INT DEFAULT 0,
  is_active BOOLEAN DEFAULT true,

  -- SEO
  meta_title VARCHAR(200),
  meta_description TEXT,

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 索引
CREATE INDEX idx_categories_code ON categories(code);
CREATE INDEX idx_categories_parent_id ON categories(parent_id);
CREATE INDEX idx_categories_slug ON categories(slug);
CREATE INDEX idx_categories_display_order ON categories(display_order);
```

##### 2.2.2 products (商品主表)

```sql
CREATE TABLE products (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- 分类关联
  category_id UUID NOT NULL REFERENCES categories(id),

  -- 商品基本信息
  sku VARCHAR(100) UNIQUE NOT NULL,
  name VARCHAR(200) NOT NULL,
  name_en VARCHAR(200),
  slug VARCHAR(200) UNIQUE NOT NULL,
  description TEXT,
  description_en TEXT,

  -- 价格
  price DECIMAL(10,2) NOT NULL CHECK (price >= 0),
  compare_at_price DECIMAL(10,2) CHECK (compare_at_price >= 0),
  cost_price DECIMAL(10,2) CHECK (cost_price >= 0),

  -- 媒体资源
  images JSONB DEFAULT '[]',
  videos JSONB DEFAULT '[]',

  -- 商品属性
  attributes JSONB DEFAULT '{}',
  variants JSONB DEFAULT '[]',

  -- 库存
  inventory INT DEFAULT 0 CHECK (inventory >= 0),
  inventory_status VARCHAR(20) DEFAULT 'IN_STOCK' CHECK (inventory_status IN ('IN_STOCK', 'LOW_STOCK', 'OUT_OF_STOCK')),

  -- 销售统计
  sales_count INT DEFAULT 0,
  view_count INT DEFAULT 0,
  wishlist_count INT DEFAULT 0,

  -- 评分
  rating_average DECIMAL(3,2) DEFAULT 0 CHECK (rating_average BETWEEN 0 AND 5),
  review_count INT DEFAULT 0,

  -- 标签
  is_featured BOOLEAN DEFAULT false,
  is_new BOOLEAN DEFAULT false,
  is_bestseller BOOLEAN DEFAULT false,

  -- 状态
  status VARCHAR(20) DEFAULT 'DRAFT' CHECK (status IN ('DRAFT', 'ACTIVE', 'INACTIVE', 'ARCHIVED')),

  -- SEO
  meta_title VARCHAR(200),
  meta_description TEXT,

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  published_at TIMESTAMP WITH TIME ZONE
);

-- 索引
CREATE INDEX idx_products_sku ON products(sku);
CREATE INDEX idx_products_category_id ON products(category_id);
CREATE INDEX idx_products_slug ON products(slug);
CREATE INDEX idx_products_status ON products(status);
CREATE INDEX idx_products_is_featured ON products(is_featured);
CREATE INDEX idx_products_rating_average ON products(rating_average DESC);
CREATE INDEX idx_products_sales_count ON products(sales_count DESC);
CREATE INDEX idx_products_price ON products(price);

-- 全文搜索索引
CREATE INDEX idx_products_fulltext ON products USING gin(
  to_tsvector('simple',
    COALESCE(name, '') || ' ' ||
    COALESCE(description, '') || ' ' ||
    COALESCE(sku, '')
  )
);
```

#### 2.3 订单相关表

##### 2.3.1 orders (订单主表)

```sql
CREATE TABLE orders (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),

  -- 用户关联
  user_id UUID NOT NULL REFERENCES users(id),

  -- 订单编号
  order_number VARCHAR(50) UNIQUE NOT NULL,

  -- 订单状态
  status VARCHAR(20) DEFAULT 'PENDING' CHECK (status IN (
    'PENDING', 'CONFIRMED', 'PROCESSING',
    'SHIPPED', 'DELIVERED', 'CANCELLED', 'REFUNDED'
  )),

  -- 隐私模式
  privacy_mode VARCHAR(20) DEFAULT 'NORMAL' CHECK (privacy_mode IN ('NORMAL', 'ENCRYPTED_ADDR', 'ANONYMOUS')),

  -- 商品信息
  items JSONB NOT NULL,

  -- 金额
  subtotal DECIMAL(10,2) NOT NULL CHECK (subtotal >= 0),
  shipping_fee DECIMAL(10,2) DEFAULT 0 CHECK (shipping_fee >= 0),
  discount DECIMAL(10,2) DEFAULT 0 CHECK (discount >= 0),
  tax DECIMAL(10,2) DEFAULT 0 CHECK (tax >= 0),
  total DECIMAL(10,2) NOT NULL CHECK (total >= 0),

  -- 地址信息 (加密存储)
  shipping_address JSONB,
  billing_address JSONB,

  -- 支付信息
  payment_method VARCHAR(50),
  payment_status VARCHAR(20) DEFAULT 'UNPAID' CHECK (payment_status IN ('UNPAID', 'PROCESSING', 'PAID', 'FAILED', 'REFUNDED')),
  payment_id VARCHAR(255),
  paid_at TIMESTAMP WITH TIME ZONE,

  -- 物流信息
  tracking_number VARCHAR(255),
  shipping_provider VARCHAR(100),
  estimated_delivery TIMESTAMP WITH TIME ZONE,
  actual_delivery TIMESTAMP WITH TIME ZONE,

  -- 备注
  customer_notes TEXT,
  internal_notes TEXT,

  -- IPFS 引用
  ipfs_receipt_cid VARCHAR(255),

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  confirmed_at TIMESTAMP WITH TIME ZONE,
  shipped_at TIMESTAMP WITH TIME ZONE,
  cancelled_at TIMESTAMP WITH TIME ZONE
);

-- 索引
CREATE INDEX idx_orders_user_id ON orders(user_id);
CREATE INDEX idx_orders_order_number ON orders(order_number);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_payment_status ON orders(payment_status);
CREATE INDEX idx_orders_created_at ON orders(created_at DESC);
CREATE INDEX idx_orders_tracking_number ON orders(tracking_number);

-- 触发器：生成订单编号
CREATE TRIGGER generate_order_number
  BEFORE INSERT ON orders
  FOR EACH ROW
  EXECUTE FUNCTION generate_order_number_func();
```

##### 2.3.2 order_items (订单明细)

```sql
CREATE TABLE order_items (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  order_id UUID NOT NULL REFERENCES orders(id) ON DELETE CASCADE,

  -- 商品信息 (快照)
  product_id UUID NOT NULL,
  product_name VARCHAR(200) NOT NULL,
  product_sku VARCHAR(100) NOT NULL,
  product_image VARCHAR(500),

  -- 购买信息
  quantity INT NOT NULL CHECK (quantity > 0),
  unit_price DECIMAL(10,2) NOT NULL CHECK (unit_price >= 0),
  total_price DECIMAL(10,2) NOT NULL CHECK (total_price >= 0),

  -- 属性
  variant_info JSONB DEFAULT '{}',

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 索引
CREATE INDEX idx_order_items_order_id ON order_items(order_id);
CREATE INDEX idx_order_items_product_id ON order_items(product_id);
```

#### 2.4 AI 相关表

##### 2.4.1 ai_conversations (AI 对话记录)

```sql
CREATE TABLE ai_conversations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

  -- 会话标识
  session_id UUID NOT NULL,

  -- 消息内容
  role VARCHAR(20) NOT NULL CHECK (role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL, -- 加密存储

  -- 上下文
  context JSONB DEFAULT '{}',
  tokens_used INT DEFAULT 0,

  -- 模型信息
  model_provider VARCHAR(50),
  model_version VARCHAR(50),

  -- IPFS 引用
  ipfs_content_cid VARCHAR(255),

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 索引
CREATE INDEX idx_ai_conversations_user_id ON ai_conversations(user_id);
CREATE INDEX idx_ai_conversations_session_id ON ai_conversations(session_id);
CREATE INDEX idx_ai_conversations_created_at ON ai_conversations(created_at DESC);
```

##### 2.4.2 ai_recommendations (AI 推荐记录)

```sql
CREATE TABLE ai_recommendations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

  -- 推荐场景
  scenario VARCHAR(100) NOT NULL,

  -- 推荐商品
  product_ids UUID[] NOT NULL,

  -- 算法信息
  algorithm VARCHAR(50) NOT NULL,
  model_version VARCHAR(50),
  confidence DECIMAL(5,4),

  -- 用户反馈
  feedback BOOLEAN,
  clicked_products UUID[],

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  expires_at TIMESTAMP WITH TIME ZONE
);

-- 索引
CREATE INDEX idx_ai_recommendations_user_id ON ai_recommendations(user_id);
CREATE INDEX idx_ai_recommendations_scenario ON ai_recommendations(scenario);
CREATE INDEX idx_ai_recommendations_created_at ON ai_recommendations(created_at DESC);
```

#### 2.5 IoT 相关表

##### 2.5.1 iot_devices (IoT 设备)

```sql
CREATE TABLE iot_devices (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,

  -- 设备标识
  device_id VARCHAR(255) UNIQUE NOT NULL,
  device_name VARCHAR(100),
  device_type VARCHAR(50) NOT NULL,

  -- 蓝牙信息
  bluetooth_address VARCHAR(50) UNIQUE,

  -- 固件信息
  firmware_version VARCHAR(50),
  hardware_version VARCHAR(50),

  -- 状态
  last_sync TIMESTAMP WITH TIME ZONE,
  battery_level INT CHECK (battery_level BETWEEN 0 AND 100),
  is_active BOOLEAN DEFAULT true,

  -- 配置
  settings JSONB DEFAULT '{}',

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 索引
CREATE INDEX idx_iot_devices_user_id ON iot_devices(user_id);
CREATE INDEX idx_iot_devices_device_id ON iot_devices(device_id);
CREATE INDEX idx_iot_devices_bluetooth_address ON iot_devices(bluetooth_address);
```

##### 2.5.2 health_data (健康数据)

```sql
CREATE TABLE health_data (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  device_id UUID REFERENCES iot_devices(id) ON DELETE SET NULL,

  -- 数据信息
  data_type VARCHAR(50) NOT NULL,
  value JSONB NOT NULL, -- 加密存储
  unit VARCHAR(50),

  -- 采集时间
  recorded_at TIMESTAMP WITH TIME ZONE NOT NULL,

  -- 验证
  zk_proof_hash VARCHAR(255),
  verified BOOLEAN DEFAULT false,

  -- IPFS 引用
  ipfs_data_cid VARCHAR(255),

  -- 时间戳
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 索引
CREATE INDEX idx_health_data_user_id ON health_data(user_id);
CREATE INDEX idx_health_data_device_id ON health_data(device_id);
CREATE INDEX idx_health_data_data_type ON health_data(data_type);
CREATE INDEX idx_health_data_recorded_at ON health_data(recorded_at DESC);
```

### 3. 索引策略

#### 3.1 索引设计原则

1. **高频查询字段**：user_id、order_number、status
2. **外键字段**：所有外键建立索引
3. **组合索引**：考虑查询模式，建立合理的组合索引
4. **全文搜索**：使用 tsvector 实现全文搜索

#### 3.2 索引类型

| 索引类型 | 使用场景 | 示例 |
|----------|----------|------|
| B-tree | 等值查询、范围查询 | `idx_users_email` |
| GIN | JSONB、数组、全文搜索 | `idx_products_fulltext` |
| Hash | 等值查询 | `idx_users_did` |
| Partial | 条件索引 | `idx_active_products` |

### 4. 数据安全

#### 4.1 Row Level Security (RLS)

```sql
-- 启用 RLS
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE health_data ENABLE ROW LEVEL SECURITY;

-- 用户策略：只能访问自己的数据
CREATE POLICY user_isolation ON users
  FOR ALL
  USING (auth.uid() = id);

CREATE POLICY order_isolation ON orders
  FOR ALL
  USING (auth.uid() = user_id);

-- 健康数据策略：ZK-Proof 验证后可访问
CREATE POLICY health_data_access ON health_data
  FOR SELECT
  USING (
    auth.uid() = user_id OR
    EXISTS (
      SELECT 1 FROM zk_verifications
      WHERE verifier_id = auth.uid()
      AND data_id = health_data.id
      AND verified = true
    )
  );
```

#### 4.2 数据加密

```sql
-- 使用 pgcrypto 加密敏感字段
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- 加密函数
CREATE OR REPLACE FUNCTION encrypt_data(data TEXT, key TEXT)
RETURNS BYTEA AS $$
BEGIN
  RETURN pgp_sym_encrypt(data, key);
END;
$$ LANGUAGE plpgsql;

-- 解密函数
CREATE OR REPLACE FUNCTION decrypt_data(data BYTEA, key TEXT)
RETURNS TEXT AS $$
BEGIN
  RETURN pgp_sym_decrypt(data, key);
END;
$$ LANGUAGE plpgsql;
```

### 5. 数据分区策略

#### 5.1 订单表分区

```sql
-- 按年月分区
CREATE TABLE orders_partitioned (
  LIKE orders INCLUDING ALL
) PARTITION BY RANGE (created_at);

-- 创建分区
CREATE TABLE orders_2025_01 PARTITION OF orders_partitioned
  FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');

CREATE TABLE orders_2025_02 PARTITION OF orders_partitioned
  FOR VALUES FROM ('2025-02-01') TO ('2025-03-01');
```

#### 5.2 健康数据分区

```sql
-- 按数据类型和创建时间分区
CREATE TABLE health_data_partitioned (
  LIKE health_data INCLUDING ALL
) PARTITION BY LIST (data_type);

CREATE TABLE health_data_heart_rate PARTITION OF health_data_partitioned
  FOR VALUES IN ('HEART_RATE');

CREATE TABLE health_data_blood_pressure PARTITION OF health_data_partitioned
  FOR VALUES IN ('BLOOD_PRESSURE');
```

### 6. 备份与恢复

#### 6.1 备份策略

```bash
# 全量备份
pg_dump -U postgres -d hailan_pro -Fc > hailan_pro_$(date +%Y%m%d).dump

# 增量备份 (WAL)
archive_mode = on
archive_command = 'cp %p /wal_archive/%f'
```

#### 6.2 恢复流程

```bash
# 恢复全量备份
pg_restore -U postgres -d hailan_pro hailan_pro_20250203.dump

# 应用 WAL 日志
# PostgreSQL 自动应用 WAL 进行时间点恢复
```

### 7. 附录

#### 7.1 数据字典

详见：[086-数据库-全库表字段字典.md](../HaiLan-Pro-类型定义/086-数据库-全库表字段字典.md)

#### 7.2 枚举值定义

详见：[087-数据库-枚举值字典文档.md](../HaiLan-Pro-类型定义/087-数据库-枚举值字典文档.md)

#### 7.3 参考文档

- [021-系统架构设计文档.md](./021-系统架构设计文档.md) - 系统架构
- [022-数据架构设计文档.md](./022-数据架构设计文档.md) - 数据架构

---

<div align="center">

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

</div>

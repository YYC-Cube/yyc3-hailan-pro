---
file: 021-系统架构设计文档.md
description: HaiLan Pro 全系统整体架构设计，包含分层、分模块、部署架构的核心设计方案
author: YanYuCloudCube Team
version: v1.0.0
created: 2026-01-26
updated: 2026-02-03
status: published
tags:
  - 架构设计,[系统架构],[整体设计]
---

> ***YanYuCloudCube***
> 言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> 万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 021 系统架构设计文档

## 概述

本文档详细描述HaiLan Pro项目的整体系统架构设计，阐述系统的分层结构、模块划分、部署架构以及各组件之间的交互关系，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景

HaiLan Pro (海蓝) 是一款基于 React 18.2、Vite 6 和 Supabase 构建的医疗级私密健康管理系统。项目致力于通过 ZK-Proof (零知识证明)、匿名 DID 和 IPFS 分布式存储，为精英用户提供绝对隐私的健康数据管理体验。

#### 1.2 架构设计目标

- **高可用性**：确保系统 7×24 小时稳定运行，支持 PWA 离线能力
- **高性能**：优化响应时间和处理能力，支持高并发访问
- **高安全性**：保护用户数据和隐私安全，双重加密机制
- **高扩展性**：支持业务快速扩展，模块化设计
- **高可维护性**：便于后续维护和升级，清晰的架构分层

#### 1.3 架构设计原则

#### 1.3.1 五高原则

- **高可用性**：系统采用多层缓存、服务降级、熔断机制保障可用性
- **高性能**：前端采用 PWA 缓存策略，后端采用 CDN 加速、数据库读写分离
- **高安全性**：数据传输采用 HTTPS，敏感数据采用 ZK-Proof 加密验证
- **高扩展性**：前后端分离架构，支持微服务拆分
- **高可维护性**：统一的代码规范、完善的文档体系

#### 1.3.2 五标体系

- **标准化**：统一的 API 接口规范、数据格式规范
- **规范化**：严格的开发流程规范、代码审查规范
- **自动化**：CI/CD 自动化部署、自动化测试
- **智能化**：AI 智能顾问、智能推荐系统
- **可视化**：完善的监控系统、日志系统

#### 1.3.3 五化架构

- **流程化**：标准化的开发流程、发布流程
- **文档化**：完善的架构文档、API 文档、用户手册
- **工具化**：高效的开发工具链、自动化脚本
- **数字化**：数据驱动的决策分析
- **生态化**：开放的生态系统、第三方集成能力

### 2. 系统整体架构

#### 2.1 架构分层设计

HaiLan Pro 采用经典的前后端分离架构，整体分为以下五层：

##### 2.1.1 表现层 (Presentation Layer)

**前端技术栈：**
- **核心框架**：React 18.2.0
- **构建工具**：Vite 6.3.5
- **样式方案**：Tailwind CSS v4.0 + MUI v6 + Radix UI
- **路由方案**：React Router v6（基于 MemoryRouter 实现隐私保护）
- **状态管理**：React Context API（CartContext、UserContext、PrivacyContext、PaymentContext）

**PWA 能力：**
- Service Worker：离线缓存、后台同步
- Manifest：桌面安装、启动画面
- Push API：推送通知
- IndexedDB：本地数据存储

**核心页面模块：**
- 用户引导模块：WelcomePage、PrivacySelectionPage、RegistrationFlow
- 商城模块：HomePage、CategoryPage、ProductDetailPage、CartPage、CheckoutPage
- 隐私中心模块：UserProfilePage、PrivacyControlPage、PreferencesPage
- AI 智能模块：AIAssistantPage、QuizIntroPage、QuizQuestionPage、QuizResultPage
- AR 体验模块：ARStartPage、ARViewerPage
- 社区模块：CommunityHomePage、PostDetailPage、CreatePostPage、QAPage
- IoT 设备模块：DeviceHubPage、ScenarioPage、MultiDeviceSyncPage、HealthAssetsPage、ZKMedicalVaultPage
- 管理后台模块：AdminDashboardPage、ProductManagementPage、OrderManagementPage、ContentModerationPage、DataAnalyticsPage

##### 2.1.2 网关层 (Gateway Layer)

**API 网关功能：**
- 请求路由与转发
- 统一鉴权与认证（基于 Supabase Auth）
- 限流与熔断
- 日志记录与监控
- 跨域处理

##### 2.1.3 业务层 (Business Layer)

**核心业务模块：**

1. **用户服务模块**
   - 用户注册与登录
   - 匿名 DID 管理
   - 用户画像与偏好设置
   - 生物识别认证

2. **隐私服务模块**
   - 隐私模式管理（STANDARD/STEALTH/DISGUISE）
   - 数据加密与解密
   - 隐私遮罩控制
   - ZK-Proof 验证

3. **商城服务模块**
   - 商品管理
   - 购物车管理
   - 订单处理
   - 支付集成

4. **AI 服务模块**
   - LLM 对话管理
   - 智能推荐算法
   - 健康问答系统
   - 情感分析

5. **IoT 服务模块**
   - 设备连接管理（Web Bluetooth API）
   - 设备数据同步
   - 健康数据采集
   - 多设备协同

6. **供应链模块**
   - 库存管理
   - 物流跟踪
   - 伪装发货
   - O2O 集成

##### 2.1.4 数据层 (Data Layer)

**数据存储方案：**

1. **关系型数据库（Supabase/PostgreSQL）**
   - 用户基础信息
   - 商品目录数据
   - 订单交易数据
   - 权限与配置数据

2. **分布式文件存储（IPFS）**
   - 敏感健康数据（加密后）
   - 用户隐私文档
   - 商品多媒体资源
   - 社区内容

3. **缓存层**
   - Redis 会话缓存
   - PWA 离线缓存（Service Worker）
   - CDN 静态资源缓存

4. **消息队列**
   - 异步任务处理
   - 推送通知队列
   - 数据同步队列

##### 2.1.5 基础设施层 (Infrastructure Layer)

- **容器化**：Docker 容器部署
- **编排管理**：Kubernetes 集群管理
- **监控告警**：Prometheus + Grafana
- **日志收集**：ELK Stack
- **CI/CD**：GitHub Actions 自动化部署

#### 2.2 系统架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           表现层 (Presentation Layer)                    │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   PWA 客户端  │  │  Web 浏览器  │  │ Figma 预览  │  │  桌面应用    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  React 18.2 + Vite 6 + Tailwind CSS v4 + MUI v6 + Radix UI             │
└─────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            网关层 (Gateway Layer)                       │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  API 网关    │  │  鉴权中心    │  │  限流熔断    │  │  日志监控    │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  Supabase Auth + Custom Middleware                                    │
└─────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           业务层 (Business Layer)                       │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  用户服务    │  │  隐私服务    │  │  商城服务    │  │  AI 服务     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│  ┌─────────────┐  ┌─────────────┐                                           │
│  │  IoT 服务    │  │  供应链服务  │                                           │
│  └─────────────┘  └─────────────┘                                           │
└─────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                            数据层 (Data Layer)                           │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ PostgreSQL  │  │    IPFS     │  │   Redis     │  │   CDN       │    │
│  │ (Supabase)  │  │  (加密数据)  │  │  (缓存)     │  │ (静态资源)   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        基础设施层 (Infrastructure Layer)                 │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Docker    │  │ Kubernetes  │  │ Prometheus  │  │   ELK       │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3. 核心模块架构

#### 3.1 隐私保护架构

**隐私等级体系：**

| 等级 | 名称 | 描述 | 应用场景 |
|------|------|------|----------|
| STANDARD | 标准模式 | 常规浏览体验 | 首次使用、熟悉用户 |
| STEALTH | 隐身模式 | 隐私遮罩启用 | 公共场合使用 |
| DISGUISE | 伪装模式 | 伪装界面展示 | 极端隐私需求 |

**核心隐私组件：**
- `CamouflageScreen`：全局伪装屏组件
- `PrivacyBlur`：隐私模糊滤镜
- `PrivacyContext`：隐私状态管理
- `ZKMedicalVaultPage`：零知识证明医疗金库

#### 3.2 PWA 架构设计

**Service Worker 策略：**

```typescript
// 缓存策略配置
const CACHE_STRATEGIES = {
  // 静态资源：Cache First
  static: {
    pattern: /\/static\/.*/,
    strategy: 'cacheFirst'
  },
  // API 请求：Network First
  api: {
    pattern: /\/api\/.*/,
    strategy: 'networkFirst'
  },
  // 页面资源：Stale While Revalidate
  pages: {
    pattern: /\.html?$/,
    strategy: 'staleWhileRevalidate'
  }
};
```

**离线能力：**
- 核心页面离线访问
- 购物车本地存储（IndexedDB）
- 用户偏好本地缓存
- 队列化操作（离线时暂存，联网后同步）

#### 3.3 AI 集成架构

**AI 功能模块：**

1. **对话系统**
   - 上下文管理（Conversation Context）
   - 多轮对话状态维护
   - 流式响应（Streaming Response）

2. **智能推荐**
   - 基于用户画像的协同过滤
   - 隐式行为分析
   - 场景化推荐算法

3. **健康问答**
   - LLM 知识库集成
   - 隐私保护的问答机制
   - ZK-Proof 验证的敏感问题处理

**组件架构：**
- `GlobalAIAssistant`：全局 AI 助手浮窗
- `AIAssistantPage`：独立 AI 对话页面
- `AIContext`：AI 状态与配置管理

#### 3.4 IoT 设备架构

**设备连接方案：**

```typescript
// Web Bluetooth 连接流程
interface DeviceConnection {
  requestDevice: (filters: BluetoothLEScanFilter[]) => Promise<BluetoothDevice>;
  connect: () => Promise<void>;
  disconnect: () => void;
  subscribe: (service: string, characteristic: string) => void;
  sendCommand: (command: Buffer) => Promise<void>;
}
```

**设备管理模块：**
- `DeviceHubPage`：设备中心
- `ScenarioPage`：场景化设备控制
- `MultiDeviceSyncPage`：多设备同步协议
- `HealthAssetsPage`：健康资产管理
- `ZKMedicalVaultPage`：零知识证明医疗金库

### 4. 数据流架构

#### 4.1 用户认证流程

```
用户输入隐私偏好
        ↓
PrivacySelectionPage
        ↓
RegistrationFlow (匿名DID生成)
        ↓
Supabase Auth 认证
        ↓
UserContext 更新状态
        ↓
路由跳转至首页
```

#### 4.2 数据加密流程

```
敏感数据输入
        ↓
前端加密 (AES-256)
        ↓
ZK-Proof 生成
        ↓
IPFS 存储 (加密数据)
        ↓
DID 引用存储 (PostgreSQL)
        ↓
用户解密请求
        ↓
ZK-Proof 验证
        ↓
IPFS 数据检索
        ↓
前端解密展示
```

### 5. 部署架构

#### 5.1 多端部署方案

| 部署目标 | 技术方案 | 访问方式 |
|----------|----------|----------|
| 移动端 PWA | Vite 构建 + HTTPS | Safari/Chrome 添加到主屏幕 |
| 桌面端 Web | Vite 构建 + CDN | 直接浏览器访问 |
| Figma 预览 | MemoryRouter + 静态资源 | Figma Sandbox 嵌入 |
| 本地开发 | Vite Dev Server | localhost:5173 |

#### 5.2 环境配置

```bash
# 开发环境
VITE_API_URL=http://localhost:3000
VITE_SUPABASE_URL=<dev-url>
VITE_SUPABASE_ANON_KEY=<dev-anon-key>

# 生产环境
VITE_API_URL=https://api.hailan.pro
VITE_SUPABASE_URL=<prod-url>
VITE_SUPABASE_ANON_KEY=<prod-anon-key>
```

### 6. 安全架构

#### 6.1 数据安全

- **传输加密**：全站 HTTPS
- **存储加密**：敏感数据 AES-256 加密后存入 IPFS
- **身份验证**：Supabase Auth + JWT
- **隐私验证**：ZK-Proof 零知识证明

#### 6.2 接口安全

- **CORS 控制**：严格的跨域策略
- **速率限制**：API 调用频率限制
- **输入验证**：前后端双重校验
- **SQL 注入防护**：参数化查询

### 7. 可观测性架构

#### 7.1 监控指标

- **前端性能**：FCP、LCP、CLS（Core Web Vitals）
- **API 性能**：响应时间、成功率、错误率
- **业务指标**：活跃用户、转化率、留存率

#### 7.2 日志管理

- **前端日志**：Console 捕获 + 远程上报
- **API 日志**：请求/响应记录
- **错误追踪**：ErrorBoundary + Sentry

### 8. 技术债务与改进计划

#### 8.1 短期改进（Q1-Q2）

- 完善单元测试覆盖率
- 优化 PWA 缓存策略
- 增强 AI 对话上下文能力
- 完善 IoT 设备兼容性

#### 8.2 中期规划（Q3-Q4）

- 微服务架构拆分
- 引入 GraphQL 优化数据查询
- 实现多语言国际化
- 构建 AI 模型本地化方案

#### 8.3 长期愿景（明年）

- 区块链完全去中心化
- 跨平台原生应用
- 医疗级认证体系
- 生态系统开放平台

### 9. 附录

#### 9.1 关键技术术语

| 术语 | 全称 | 说明 |
|------|------|------|
| PWA | Progressive Web App | 渐进式 Web 应用 |
| ZK-Proof | Zero-Knowledge Proof | 零知识证明 |
| DID | Decentralized Identity | 去中心化身份标识 |
| IPFS | InterPlanetary File System | 星际文件系统 |
| GDPR | General Data Protection Regulation | 通用数据保护条例 |

#### 9.2 参考文档

- [README.md](../README.md) - 项目主文档
- [023-技术选型报告.md](./023-技术选型报告.md) - 技术选型详解
- [026-隐私保护架构设计.md](./026-隐私保护架构设计.md) - 隐私架构详解
- [028-PWA架构设计文档.md](./028-PWA架构设计文档.md) - PWA 架构详解

---

<div align="center">

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

</div>

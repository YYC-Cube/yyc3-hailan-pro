---
file: 088-数据库-隐私等级枚举定义.md
description: HaiLan Pro 隐私等级(STANDARD/STEALTH/DISGUISE)枚举值定义与使用规范
author: YanYuCloudCube Team
version: v1.0.0
created: 2026-01-26
updated: 2026-01-26
status: published
tags:
  - HaiLan-Pro-类型定义,[]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 088 数据库-隐私等级枚举定义

## 概述

本文档详细描述HaiLan Pro-HaiLan-Pro-类型定义-数据库-隐私等级枚举定义相关内容，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范数据库-隐私等级枚举定义相关的业务标准与技术落地要求
- 为项目相关人员提供清晰的参考依据
- 保障相关模块开发、实施、运维的一致性与规范性

### 2. 设计原则

#### 2.1 五高原则
- **高可用性**：确保系统7x24小时稳定运行，支持PWA离线能力
- **高性能**：优化响应时间和处理能力，支持高并发访问
- **高安全性**：保护用户数据和隐私安全，双重加密机制
- **高扩展性**：支持业务快速扩展，微服务架构设计
- **高可维护性**：便于后续维护和升级，模块化设计

#### 2.2 五标体系
- **标准化**：统一的技术和流程标准
- **规范化**：严格的开发和管理规范
- **自动化**：提高开发效率和质量，CI/CD自动化
- **智能化**：利用AI技术提升能力，LLM智能顾问
- **可视化**：直观的监控和管理界面

#### 2.3 五化架构
- **流程化**：标准化的开发流程
- **文档化**：完善的文档体系
- **工具化**：高效的开发工具链
- **数字化**：数据驱动的决策
- **生态化**：开放的生态系统

### 3. 隐私等级枚举定义

#### 3.1 枚举值定义

```typescript
/**
 * 隐私等级枚举
 * 定义用户可选择的隐私保护级别
 */
export enum PrivacyLevel {
  /**
   * 标准模式
   * 正常显示用户信息，适用于一般使用场景
   */
  STANDARD = 'STANDARD',

  /**
   * 隐身模式
   * 隐藏在线状态、浏览记录等行为数据
   * 适用于希望低调使用平台的用户
   */
  STEALTH = 'STEALTH',

  /**
   * 伪装模式
   * 使用虚拟收货信息，完全保护真实身份
   * 适用于注重极致隐私的用户
   */
  DISGUISE = 'DISGUISE'
}
```

#### 3.2 各等级详细规范

##### 3.2.1 标准模式 (STANDARD)

```typescript
/**
 * 标准模式配置
 */
export interface StandardPrivacyConfig {
  /** 隐私等级 */
  level: PrivacyLevel.STANDARD;

  /** 个人资料可见性 */
  profile: {
    /** 头像可见 */
    avatarVisible: true;
    /** 昵称可见 */
    nicknameVisible: true;
    /** 个人简介可见 */
    bioVisible: true;
  };

  /** 行为数据 */
  behavior: {
    /** 显示在线状态 */
    showOnlineStatus: true;
    /** 显示浏览记录 */
    showViewHistory: true;
    /** 显示收藏记录 */
    showFavoriteHistory: true;
  };

  /** 订单信息 */
  order: {
    /** 使用真实收货信息 */
    useRealAddress: true;
    /** 显示订单详情 */
    showOrderDetails: true;
  };

  /** 通知设置 */
  notification: {
    /** 接收营销通知 */
    marketingEnabled: true;
    /** 接收订单通知 */
    orderEnabled: true;
  };
}
```

##### 3.2.2 隐身模式 (STEALTH)

```typescript
/**
 * 隐身模式配置
 */
export interface StealthPrivacyConfig {
  /** 隐私等级 */
  level: PrivacyLevel.STEALTH;

  /** 个人资料可见性 */
  profile: {
    /** 头像可见（可设置模糊头像） */
    avatarVisible: true;
    avatarBlur: true;  // 新增：头像模糊效果
    /** 昵称可见（使用代号） */
    nicknameVisible: true;
    nicknameMasked: true;  // 新增：昵称部分隐藏
    /** 个人简介隐藏 */
    bioVisible: false;
  };

  /** 行为数据 */
  behavior: {
    /** 隐藏在线状态 */
    showOnlineStatus: false;
    /** 隐藏浏览记录 */
    showViewHistory: false;
    /** 隐藏收藏记录 */
    showFavoriteHistory: false;
    /** 隐藏活跃时间 */
    showLastActive: false;
  };

  /** 订单信息 */
  order: {
    /** 使用真实收货信息 */
    useRealAddress: true;
    /** 订单列表加密显示 */
    encryptOrderList: true;
  };

  /** 通知设置 */
  notification: {
    /** 仅接收必要通知 */
    marketingEnabled: false;
    orderEnabled: true;
  };

  /** 搜索可见性 */
  search: {
    /** 不出现在用户搜索结果中 */
    searchable: false;
    /** 不出现在推荐列表中 */
    recommendable: false;
  };
}
```

##### 3.2.3 伪装模式 (DISGUISE)

```typescript
/**
 * 伪装模式配置
 */
export interface DisguisePrivacyConfig {
  /** 隐私等级 */
  level: PrivacyLevel.DISGUISE;

  /** 个人资料可见性 */
  profile: {
    /** 使用默认头像 */
    avatarVisible: true;
    avatarDefault: true;  // 使用默认或匿名头像
    /** 使用虚拟昵称 */
    nicknameVisible: true;
    nicknameVirtual: true;  // 生成虚拟昵称
    /** 个人简介隐藏 */
    bioVisible: false;
  };

  /** 行为数据 */
  behavior: {
    /** 隐藏所有行为数据 */
    showOnlineStatus: false;
    showViewHistory: false;
    showFavoriteHistory: false;
    showLastActive: false;
    /** 隐藏关注关系 */
    showFollows: false;
  };

  /** 订单信息 */
  order: {
    /** 使用虚拟收货信息 */
    useRealAddress: false;
    /** 使用代收服务 */
    usePickupService: true;
    /** 伪装发货名称 */
    useDisguiseSender: true;
    /** 发货备注伪装 */
    useDisguiseNote: true;
  };

  /** 通知设置 */
  notification: {
    /** 最小化通知 */
    marketingEnabled: false;
    orderEnabled: true;
    orderPickupOnly: true;  // 仅代收点取货通知
  };

  /** 搜索可见性 */
  search: {
    /** 完全匿名 */
    searchable: false;
    recommendable: false;
    /** 隐藏用户ID */
    hideUserId: true;
  };

  /** 数据加密 */
  encryption: {
    /** 个人信息加密 */
    encryptPersonalInfo: true;
    /** 收货地址加密 */
    encryptAddress: true;
    /** 联系方式加密 */
    encryptContact: true;
  };
}
```

#### 3.3 虚拟信息生成规则

```typescript
/**
 * 虚拟昵称生成器
 */
export class VirtualNicknameGenerator {
  private static adjectives = [
    '宁静', '温柔', '阳光', '清新', '优雅', '智慧',
    '快乐', '自在', '舒适', '安详', '平和', '恬静'
  ];

  private static nouns = [
    '微风', '晨曦', '月光', '星光', '白云', '流水',
    '花香', '鸟语', '森林', '海洋', '天空', '山谷'
  ];

  /**
   * 生成虚拟昵称
   */
  static generate(): string {
    const adj = this.adjectives[Math.floor(Math.random() * this.adjectives.length)];
    const noun = this.nouns[Math.floor(Math.random() * this.nouns.length)];
    const number = Math.floor(Math.random() * 999) + 1;
    return `${adj}${noun}${number}`;
  }

  /**
   * 生成虚拟收货人姓名
   */
  static generateReceiverName(): string {
    const surnames = ['张', '王', '李', '赵', '刘', '陈', '杨', '黄'];
    const names = ['伟', '芳', '娜', '敏', '静', '强', '磊', '洋'];

    const surname = surnames[Math.floor(Math.random() * surnames.length)];
    const name = names[Math.floor(Math.random() * names.length)];
    return surname + name;
  }
}

/**
 * 虚拟收货信息生成器
 */
export class VirtualAddressGenerator {
  /**
   * 生成虚拟收货地址
   * @param realAddress 真实地址（用于代收点匹配）
   */
  static generateVirtualAddress(realAddress: string): VirtualAddress {
    // 根据真实地址匹配最近的代收点
    const pickupPoint = this.findNearestPickupPoint(realAddress);

    return {
      receiverName: VirtualNicknameGenerator.generateReceiverName(),
      receiverPhone: this.generateVirtualPhone(),
      province: pickupPoint.province,
      city: pickupPoint.city,
      district: pickupPoint.district,
      detailedAddress: pickupPoint.address,
      postalCode: pickupPoint.postalCode,
      pickupCode: pickupPoint.code,  // 取件码
      isPickupPoint: true,
      expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7天有效期
    };
  }

  /**
   * 查找最近的代收点
   * @private
   */
  private static findNearestPickupPoint(address: string): PickupPoint {
    // TODO: 实现代收点匹配逻辑
    return {
      province: '广东省',
      city: '深圳市',
      district: '南山区',
      address: 'XX驿站 代收点',
      postalCode: '518000',
      code: '123456'
    };
  }

  /**
   * 生成虚拟手机号
   * @private
   */
  private static generateVirtualPhone(): string {
    // 生成虚拟手机号（用于代收通知）
    return '170' + Math.random().toString().substring(2, 11);
  }
}

/**
 * 虚拟收货地址接口
 */
export interface VirtualAddress {
  /** 收货人姓名（虚拟） */
  receiverName: string;
  /** 收货人电话（虚拟） */
  receiverPhone: string;
  /** 省份 */
  province: string;
  /** 城市 */
  city: string;
  /** 区县 */
  district: string;
  /** 详细地址（代收点） */
  detailedAddress: string;
  /** 邮政编码 */
  postalCode: string;
  /** 取件码 */
  pickupCode: string;
  /** 是否代收点 */
  isPickupPoint: boolean;
  /** 地址过期时间 */
  expiresAt: Date;
}

/**
 * 代收点接口
 */
interface PickupPoint {
  province: string;
  city: string;
  district: string;
  address: string;
  postalCode: string;
  code: string;
}
```

#### 3.4 数据加密规则

```typescript
/**
 * 加密字段定义
 * 根据隐私等级确定需要加密的字段
 */
export const EncryptedFields = {
  [PrivacyLevel.STANDARD]: [],  // 标准模式不加密

  [PrivacyLevel.STEALTH]: [
    'orderHistory',      // 订单历史
    'viewHistory',       // 浏览历史
    'favoriteList'       // 收藏列表
  ],

  [PrivacyLevel.DISGUISE]: [
    'realName',          // 真实姓名
    'idCard',            // 身份证号
    'phone',             // 手机号
    'address',           // 收货地址
    'orderHistory',      // 订单历史
    'viewHistory',       // 浏览历史
    'favoriteList',      // 收藏列表
    'follows'            // 关注关系
  ]
};

/**
 * 数据加密服务
 */
export class PrivacyEncryptionService {
  /**
   * 加密敏感数据
   * @param data 原始数据
   * @param level 隐私等级
   */
  static encrypt(data: string, level: PrivacyLevel): string {
    if (level === PrivacyLevel.STANDARD) {
      return data;
    }

    // 使用AES-256加密
    const algorithm = 'aes-256-gcm';
    const key = this.getEncryptionKey(level);
    const iv = crypto.randomBytes(16);

    const cipher = crypto.createCipheriv(algorithm, key, iv);
    let encrypted = cipher.update(data, 'utf8', 'hex');
    encrypted += cipher.final('hex');

    const authTag = cipher.getAuthTag();

    // 返回格式：iv:authTag:encrypted
    return `${iv.toString('hex')}:${authTag.toString('hex')}:${encrypted}`;
  }

  /**
   * 解密敏感数据
   * @param encryptedData 加密数据
   * @param level 隐私等级
   */
  static decrypt(encryptedData: string, level: PrivacyLevel): string {
    if (level === PrivacyLevel.STANDARD) {
      return encryptedData;
    }

    const [ivHex, authTagHex, encrypted] = encryptedData.split(':');
    const algorithm = 'aes-256-gcm';
    const key = this.getEncryptionKey(level);

    const decipher = crypto.createDecipheriv(
      algorithm,
      key,
      Buffer.from(ivHex, 'hex')
    );

    decipher.setAuthTag(Buffer.from(authTagHex, 'hex'));

    let decrypted = decipher.update(encrypted, 'hex', 'utf8');
    decrypted += decipher.final('utf8');

    return decrypted;
  }

  /**
   * 获取加密密钥
   * @private
   */
  private static getEncryptionKey(level: PrivacyLevel): Buffer {
    // 根据隐私等级使用不同的密钥
    const keyPrefix = {
      [PrivacyLevel.STEALTH]: process.env.STEALTH_ENCRYPTION_KEY,
      [PrivacyLevel.DISGUISE]: process.env.DISGUISE_ENCRYPTION_KEY
    };

    return Buffer.from(keyPrefix[level] || '', 'hex');
  }
}
```

#### 3.5 数据库表设计

```sql
-- ========================================
-- 用户隐私配置表 (user_privacy_settings)
-- ========================================
CREATE TABLE user_privacy_settings (
    id                      VARCHAR(32) PRIMARY KEY,
    user_id                 VARCHAR(32) NOT NULL UNIQUE REFERENCES users(id) ON DELETE CASCADE,

    -- 隐私等级
    privacy_level           VARCHAR(20) DEFAULT 'STANDARD' NOT NULL,
    CHECK (privacy_level IN ('STANDARD', 'STEALTH', 'DISGUISE')),

    -- 标准模式配置
    standard_config         JSONB DEFAULT '{}'::jsonb,

    -- 隐身模式配置
    stealth_config          JSONB DEFAULT '{}'::jsonb,

    -- 伪装模式配置
    disguise_config         JSONB DEFAULT '{}'::jsonb,

    -- 虚拟信息缓存
    virtual_info            JSONB DEFAULT '{}'::jsonb,

    created_at              TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at              TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_user_privacy_settings_user_id ON user_privacy_settings(user_id);
CREATE INDEX idx_user_privacy_settings_level ON user_privacy_settings(privacy_level);

-- ========================================
-- 虚拟收货信息表 (virtual_shipping_addresses)
-- ========================================
CREATE TABLE virtual_shipping_addresses (
    id                      VARCHAR(32) PRIMARY KEY,
    user_id                 VARCHAR(32) NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    order_id                VARCHAR(32) REFERENCES orders(id) ON DELETE SET NULL,

    -- 虚拟收货人信息
    virtual_receiver_name   VARCHAR(50) NOT NULL,
    virtual_receiver_phone  VARCHAR(20) NOT NULL,

    -- 虚拟地址信息
    virtual_province        VARCHAR(50) NOT NULL,
    virtual_city            VARCHAR(50) NOT NULL,
    virtual_district        VARCHAR(50) NOT NULL,
    virtual_address         VARCHAR(200) NOT NULL,
    virtual_postal_code     VARCHAR(10),

    -- 代收点信息
    pickup_point_id         VARCHAR(32),
    pickup_code             VARCHAR(20),
    pickup_expire_at        TIMESTAMP NOT NULL,

    -- 真实地址（加密存储，用于售后）
    real_address_encrypted  TEXT,

    is_active               BOOLEAN DEFAULT TRUE,
    created_at              TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_virtual_shipping_user_id ON virtual_shipping_addresses(user_id);
CREATE INDEX idx_virtual_shipping_order_id ON virtual_shipping_addresses(order_id);
CREATE INDEX idx_virtual_shipping_expire_at ON virtual_shipping_addresses(pickup_expire_at);
```

#### 3.6 隐私等级切换规则

```typescript
/**
 * 隐私等级切换规则
 */
export class PrivacyLevelTransition {
  /**
   * 允许的切换路径
   */
  private static readonly ALLOWED_TRANSITIONS: Record<PrivacyLevel, PrivacyLevel[]> = {
    [PrivacyLevel.STANDARD]: [PrivacyLevel.STEALTH, PrivacyLevel.DISGUISE],
    [PrivacyLevel.STEALTH]: [PrivacyLevel.STANDARD, PrivacyLevel.DISGUISE],
    [PrivacyLevel.DISGUISE]: [PrivacyLevel.STANDARD]  // 伪装模式只能降级到标准模式
  };

  /**
   * 检查是否允许切换
   */
  static canTransition(from: PrivacyLevel, to: PrivacyLevel): boolean {
    return this.ALLOWED_TRANSITIONS[from]?.includes(to) ?? false;
  }

  /**
   * 切换隐私等级
   */
  static async transition(
    userId: string,
    to: PrivacyLevel,
    config?: any
  ): Promise<void> {
    const currentLevel = await this.getCurrentLevel(userId);

    if (!this.canTransition(currentLevel, to)) {
      throw new Error(`无法从 ${currentLevel} 切换到 ${to}`);
    }

    // 执行切换
    await this.updatePrivacyLevel(userId, to, config);

    // 根据目标等级执行相应操作
    switch (to) {
      case PrivacyLevel.STEALTH:
        await this.applyStealthMode(userId);
        break;
      case PrivacyLevel.DISGUISE:
        await this.applyDisguiseMode(userId);
        break;
      case PrivacyLevel.STANDARD:
        await this.applyStandardMode(userId);
        break;
    }
  }

  /**
   * 应用隐身模式
   * @private
   */
  private static async applyStealthMode(userId: string): Promise<void> {
    // 隐藏在线状态
    await this.hideOnlineStatus(userId);

    // 加密浏览记录
    await this.encryptViewHistory(userId);
  }

  /**
   * 应用伪装模式
   * @private
   */
  private static async applyDisguiseMode(userId: string): Promise<void> {
    // 生成虚拟信息
    const virtualInfo = await this.generateVirtualInfo(userId);

    // 保存虚拟信息
    await this.saveVirtualInfo(userId, virtualInfo);
  }

  /**
   * 应用标准模式
   * @private
   */
  private static async applyStandardMode(userId: string): Promise<void> {
    // 恢复正常显示
    await this.restoreNormalDisplay(userId);
  }
}
```

---

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

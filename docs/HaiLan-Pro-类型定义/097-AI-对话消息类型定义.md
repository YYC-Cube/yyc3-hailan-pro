---
@file: 097-AI-对话消息类型定义.md
@description: HaiLan Pro AI对话系统消息类型定义，包含用户消息、AI响应、上下文等
@author: YanYuCloudCube Team
@version: v1.0.0
@created: 2026-01-26
@updated: 2026-01-26
@status: published
@tags: [HaiLan-Pro-类型定义],[]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 097 AI-对话消息类型定义

## 概述

本文档详细描述HaiLan Pro-HaiLan-Pro-类型定义-AI-对话消息类型定义相关内容，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范AI-对话消息类型定义相关的业务标准与技术落地要求
- 为项目相关人员提供清晰的参考依据
- 保障相关模块开发、实施、运维的一致性与规范性

### 2. 设计原则

#### 2.1 五高原则
- **高可用性**：确保系统7x24小时稳定运行，支持PWA离线能力
- **高性能**：优化响应时间和处理能力，支持高并发访问
- **高安全性**：保护用户数据和隐私安全，双重加密机制
- **高扩展性**：支持业务快速扩展，微服务架构设计
- **高可维护性**：便于后续维护和升级，模块化设计

#### 2.2 五标体系
- **标准化**：统一的技术和流程标准
- **规范化**：严格的开发和管理规范
- **自动化**：提高开发效率和质量，CI/CD自动化
- **智能化**：利用AI技术提升能力，LLM智能顾问
- **可视化**：直观的监控和管理界面

#### 2.3 五化架构
- **流程化**：标准化的开发流程
- **文档化**：完善的文档体系
- **工具化**：高效的开发工具链
- **数字化**：数据驱动的决策
- **生态化**：开放的生态系统

### 3. AI对话消息类型定义

#### 3.1 消息基础类型

```typescript
/**
 * src/types/ai/message.ts
 * AI对话消息基础类型定义
 */

/**
 * 消息角色枚举
 */
export enum MessageRole {
  /** 用户 */
  USER = 'user',
  /** AI助手 */
  ASSISTANT = 'assistant',
  /** 系统 */
  SYSTEM = 'system',
  /** 工具调用 */
  TOOL = 'tool',
  /** 函数调用 */
  FUNCTION = 'function'
}

/**
 * 消息状态枚举
 */
export enum MessageStatus {
  /** 发送中 */
  SENDING = 'sending',
  /** 已发送 */
  SENT = 'sent',
  /** 处理中 */
  PROCESSING = 'processing',
  /** 已完成 */
  COMPLETED = 'completed',
  /** 失败 */
  FAILED = 'failed',
  /** 已取消 */
  CANCELLED = 'cancelled'
}

/**
 * 消息类型枚举
 */
export enum MessageType {
  /** 文本消息 */
  TEXT = 'text',
  /** 语音消息 */
  VOICE = 'voice',
  /** 图片消息 */
  IMAGE = 'image',
  /** 视频消息 */
  VIDEO = 'video',
  /** 文件消息 */
  FILE = 'file',
  /** 系统消息 */
  SYSTEM = 'system',
  /** 提示消息 */
  PROMPT = 'prompt',
  /** 回复消息 */
  RESPONSE = 'response',
  /** 工具调用消息 */
  TOOL_CALL = 'tool_call',
  /** 工具返回消息 */
  TOOL_RESULT = 'tool_result'
}

/**
 * 消息内容类型
 */
export type MessageContent =
  | string
  | TextContent
  | ImageContent
  | VoiceContent
  | MultiModalContent;

/**
 * 文本内容
 */
export interface TextContent {
  /** 内容类型 */
  type: 'text';
  /** 文本内容 */
  text: string;
}

/**
 * 图片内容
 */
export interface ImageContent {
  /** 内容类型 */
  type: 'image';
  /** 图片URL */
  url?: string;
  /** Base64数据 */
  base64?: string;
  /** 图片描述 */
  description?: string;
  /** 图片MIME类型 */
  mimeType?: string;
}

/**
 * 语音内容
 */
export interface VoiceContent {
  /** 内容类型 */
  type: 'voice';
  /** 音频URL */
  url?: string;
  /** Base64数据 */
  base64?: string;
  /** 音频时长(秒) */
  duration?: number;
  /** 音频文本转录 */
  transcript?: string;
  /** 音频MIME类型 */
  mimeType?: string;
}

/**
 * 多模态内容
 */
export interface MultiModalContent {
  /** 内容类型 */
  type: 'multimodal';
  /** 内容列表 */
  content: Array<TextContent | ImageContent | VoiceContent>;
}

/**
 * 基础消息结构
 */
export interface BaseMessage {
  /** 消息ID */
  messageId: string;
  /** 会话ID */
  conversationId: string;
  /** 用户ID */
  userId: string;
  /** 消息角色 */
  role: MessageRole;
  /** 消息类型 */
  type: MessageType;
  /** 消息内容 */
  content: MessageContent;
  /** 消息状态 */
  status: MessageStatus;
  /** 创建时间 */
  createdAt: string;
  /** 更新时间 */
  updatedAt: string;
  /** Token使用情况 */
  tokenUsage?: TokenUsage;
  /** 元数据 */
  metadata?: MessageMetadata;
}

/**
 * Token使用情况
 */
export interface TokenUsage {
  /** 输入Token数 */
  promptTokens: number;
  /** 输出Token数 */
  completionTokens: number;
  /** 总Token数 */
  totalTokens: number;
  /** 估算价格 */
  estimatedCost?: number;
}

/**
 * 消息元数据
 */
export interface MessageMetadata {
  /** 消息来源 */
  source?: 'web' | 'mobile' | 'api' | 'widget';
  /** 客户端IP */
  clientIp?: string;
  /** 用户代理 */
  userAgent?: string;
  /** 引用消息ID列表 */
  referencedMessageIds?: string[];
  /** 附加数据 */
  extra?: Record<string, any>;
}
```

#### 3.2 对话上下文类型

```typescript
/**
 * src/types/ai/context.ts
 * AI对话上下文类型定义
 */

/**
 * 会话上下文
 */
export interface ConversationContext {
  /** 会话ID */
  conversationId: string;
  /** 用户ID */
  userId: string;
  /** 会话类别 */
  category: ConversationCategory;
  /** AI人格 */
  aiPersonality: AIPersonality;
  /** 上下文窗口大小 */
  contextWindow: number;
  /** 最大Token数 */
  maxTokens: number;
  /** 温度参数 */
  temperature: number;
  /** Top-P采样 */
  topP: number;
  /** 频率惩罚 */
  frequencyPenalty: number;
  /** 存在惩罚 */
  presencePenalty: number;
  /** 系统提示词 */
  systemPrompt?: string;
  /** 对话历史 */
  messages: BaseMessage[];
  /** 上下文变量 */
  variables: ContextVariable[];
  /** 知识库引用 */
  knowledgeReferences?: KnowledgeReference[];
  /** 工具配置 */
  tools?: ToolConfig[];
}

/**
 * 会话类别
 */
export enum ConversationCategory {
  /** 健康咨询 */
  HEALTH_CONSULTING = 'health_consulting',
  /** 情感陪伴 */
  EMOTIONAL_COMPANIONSHIP = 'emotional_companionship',
  /** 产品推荐 */
  PRODUCT_RECOMMENDATION = 'product_recommendation',
  /** 使用指导 */
  USAGE_GUIDANCE = 'usage_guidance',
  /** 售后服务 */
  AFTER_SALES_SERVICE = 'after_sales_service',
  /** 设备控制 */
  DEVICE_CONTROL = 'device_control',
  /** 闲聊 */
  CASUAL_CHAT = 'casual_chat',
  /** 通用 */
  GENERAL = 'general'
}

/**
 * AI人格类型
 */
export enum AIPersonality {
  /** 温暖体贴型 */
  WARM_CARE = 'warm_care',
  /** 专业顾问型 */
  PROFESSIONAL_ADVISOR = 'professional_advisor',
  /** 活泼可爱型 */
  LIVELY_CUTE = 'lively_cute',
  /** 知性优雅型 */
  INTELLECTUAL_ELEGANT = 'intellectual_elegant',
  /** 神秘诱惑型 */
  MYSTERIOUS_SEDUCTIVE = 'mysterious_seductive',
  /** 亲和友善型 */
  FRIENDLY_APPROACHABLE = 'friendly_approachable',
  /** 幽默风趣型 */
  HUMOROUS_WITTY = 'humorous_witty',
  /** 严肃专业型 */
  SERIOUS_PROFESSIONAL = 'serious_professional'
}

/**
 * 上下文变量
 */
export interface ContextVariable {
  /** 变量名 */
  name: string;
  /** 变量值 */
  value: any;
  /** 变量类型 */
  type: 'string' | 'number' | 'boolean' | 'object' | 'array';
  /** 是否持久化 */
  persistent: boolean;
  /** 过期时间 */
  expiresAt?: string;
}

/**
 * 知识库引用
 */
export interface KnowledgeReference {
  /** 知识库ID */
  knowledgeId: string;
  /** 文档ID */
  documentId: string;
  /** 相关度分数 */
  relevanceScore: number;
  /** 引用片段 */
  snippet: string;
  /** 文档标题 */
  title: string;
  /** 文档URL */
  url?: string;
}

/**
 * 工具配置
 */
export interface ToolConfig {
  /** 工具名称 */
  name: string;
  /** 工具描述 */
  description: string;
  /** 工具类型 */
  type: 'function' | 'plugin' | 'api';
  /** 参数定义 */
  parameters?: Record<string, any>;
  /** 是否启用 */
  enabled: boolean;
  /** 执行权限 */
  permissions?: string[];
}
```

#### 3.3 流式响应类型

```typescript
/**
 * src/types/ai/stream.ts
 * AI流式响应类型定义
 */

/**
 * 流式事件类型
 */
export enum StreamEventType {
  /** 开始 */
  START = 'start',
  /** Token片段 */
  TOKEN = 'token',
  /** 思考过程 */
  THINKING = 'thinking',
  /** 工具调用 */
  TOOL_CALL = 'tool_call',
  /** 工具结果 */
  TOOL_RESULT = 'tool_result',
  /** 错误 */
  ERROR = 'error',
  /** 结束 */
  END = 'end',
  /** 进度 */
  PROGRESS = 'progress'
}

/**
 * 流式数据块
 */
export interface StreamChunk {
  /** 事件类型 */
  event: StreamEventType;
  /** 数据 */
  data: StreamData;
  /** 时间戳 */
  timestamp: number;
}

/**
 * 流式数据
 */
export type StreamData =
  | StreamStartData
  | StreamTokenData
  | StreamThinkingData
  | StreamToolCallData
  | StreamErrorData
  | StreamEndData;

/**
 * 开始事件数据
 */
export interface StreamStartData {
  /** 消息ID */
  messageId: string;
  /** 会话ID */
  conversationId: string;
  /** AI人格 */
  aiPersonality: AIPersonality;
  /** 预计Token数 */
  estimatedTokens?: number;
}

/**
 * Token事件数据
 */
export interface StreamTokenData {
  /** Token内容 */
  content: string;
  /** Token索引 */
  index: number;
  /** 是否完成 */
  done: boolean;
}

/**
 * 思考事件数据
 */
export interface StreamThinkingData {
  /** 思考内容 */
  thought: string;
  /** 思考步骤 */
  step: number;
  /** 总步骤数 */
  totalSteps?: number;
}

/**
 * 工具调用数据
 */
export interface StreamToolCallData {
  /** 工具调用ID */
  toolCallId: string;
  /** 工具名称 */
  toolName: string;
  /** 工具参数 */
  parameters: Record<string, any>;
  /** 调用状态 */
  status: 'calling' | 'executing' | 'completed' | 'failed';
  /** 执行结果 */
  result?: any;
  /** 错误信息 */
  error?: string;
}

/**
 * 错误事件数据
 */
export interface StreamErrorData {
  /** 错误代码 */
  code: string;
  /** 错误消息 */
  message: string;
  /** 错误详情 */
  details?: any;
}

/**
 * 结束事件数据
 */
export interface StreamEndData {
  /** 完成原因 */
  reason: 'stop' | 'length' | 'tool_calls' | 'content_filter' | 'error';
  /** Token使用情况 */
  tokenUsage?: TokenUsage;
  /** 消息评分 */
  rating?: number;
}

/**
 * 流式响应配置
 */
export interface StreamConfig {
  /** 是否启用流式 */
  enabled: boolean;
  /** Token回调 */
  onToken?: (token: string) => void;
  /** 完成回调 */
  onComplete?: (result: StreamEndData) => void;
  /** 错误回调 */
  onError?: (error: StreamErrorData) => void;
  /** 思考回调 */
  onThinking?: (thought: string) => void;
  /** 工具调用回调 */
  onToolCall?: (toolCall: StreamToolCallData) => void;
}
```

#### 3.4 知识库类型

```typescript
/**
 * src/types/ai/knowledge.ts
 * AI知识库类型定义
 */

/**
 * 知识库文档
 */
export interface KnowledgeDocument {
  /** 文档ID */
  documentId: string;
  /** 知识库ID */
  knowledgeBaseId: string;
  /** 文档标题 */
  title: string;
  /** 文档内容 */
  content: string;
  /** 文档类型 */
  documentType: DocumentType;
  /** 文档分类 */
  category: string;
  /** 标签列表 */
  tags: string[];
  /** 文档URL */
  url?: string;
  /** 向量嵌入 */
  embedding?: number[];
  /** 元数据 */
  metadata: DocumentMetadata;
  /** 创建时间 */
  createdAt: string;
  /** 更新时间 */
  updatedAt: string;
}

/**
 * 文档类型
 */
export enum DocumentType {
  /** 产品说明 */
  PRODUCT_MANUAL = 'product_manual',
  /** 使用指南 */
  USAGE_GUIDE = 'usage_guide',
  /** FAQ */
  FAQ = 'faq',
  /** 健康知识 */
  HEALTH_KNOWLEDGE = 'health_knowledge',
  /** 安全须知 */
  SAFETY_NOTICE = 'safety_notice',
  /** 政策条款 */
  POLICY_TERMS = 'policy_terms',
  /** 自定义 */
  CUSTOM = 'custom'
}

/**
 * 文档元数据
 */
export interface DocumentMetadata {
  /** 作者 */
  author?: string;
  /** 来源 */
  source?: string;
  /** 语言 */
  language: string;
  /** 字符数 */
  charCount: number;
  /** 版本 */
  version?: string;
  /** 状态 */
  status: 'draft' | 'published' | 'archived';
  /** 权重 */
  weight?: number;
  /** 有效期 */
  expiresAt?: string;
}

/**
 * 知识库配置
 */
export interface KnowledgeBaseConfig {
  /** 知识库ID */
  knowledgeBaseId: string;
  /** 知识库名称 */
  name: string;
  /** 知识库描述 */
  description: string;
  /** 向量模型 */
  embeddingModel: EmbeddingModel;
  /** 相似度阈值 */
  similarityThreshold: number;
  /** Top-K结果数 */
  topK: number;
  /** 是否启用重排序 */
  enableRerank: boolean;
  /** 重排序模型 */
  rerankModel?: string;
}

/**
 * 向量模型
 */
export enum EmbeddingModel {
  /** OpenAI text-embedding-3-small */
  OPENAI_SMALL = 'openai-text-embedding-3-small',
  /** OpenAI text-embedding-3-large */
  OPENAI_LARGE = 'openai-text-embedding-3-large',
  /** BGE-M3 */
  BGE_M3 = 'bge-m3',
  /** BGE-Large */
  BGE_LARGE = 'bge-large',
  /** Jina */
  JINA = 'jina',
  /** 自定义 */
  CUSTOM = 'custom'
}

/**
 * 检索查询
 */
export interface RetrievalQuery {
  /** 查询文本 */
  query: string;
  /** 知识库ID列表 */
  knowledgeBaseIds: string[];
  /** Top-K结果数 */
  topK?: number;
  /** 相似度阈值 */
  similarityThreshold?: number;
  /** 过滤条件 */
  filters?: RetrievalFilter;
}

/**
 * 检索过滤条件
 */
export interface RetrievalFilter {
  /** 文档类型 */
  documentTypes?: DocumentType[];
  /** 分类列表 */
  categories?: string[];
  /** 标签列表 */
  tags?: string[];
  /** 自定义过滤 */
  customFilters?: Record<string, any>;
}

/**
 * 检索结果
 */
export interface RetrievalResult {
  /** 查询文本 */
  query: string;
  /** 文档列表 */
  documents: Array<KnowledgeDocument & { score: number }>;
  /** 总数 */
  total: number;
  /** 检索耗时(毫秒) */
  retrievalTime: number;
}
```

#### 3.5 RAG类型定义

```typescript
/**
 * src/types/ai/rag.ts
 * RAG(检索增强生成)类型定义
 */

/**
 * RAG配置
 */
export interface RAGConfig {
  /** 是否启用RAG */
  enabled: boolean;
  /** 检索配置 */
  retrieval: RetrievalConfig;
  /** 生成配置 */
  generation: GenerationConfig;
  /** 提示模板 */
  promptTemplate: string;
}

/**
 * 检索配置
 */
export interface RetrievalConfig {
  /** 知识库ID列表 */
  knowledgeBaseIds: string[];
  /** Top-K结果数 */
  topK: number;
  /** 相似度阈值 */
  similarityThreshold: number;
  /** 检索模式 */
  mode: RetrievalMode;
  /** 重排序 */
  rerank?: boolean;
}

/**
 * 检索模式
 */
export enum RetrievalMode {
  /** 向量检索 */
  VECTOR = 'vector',
  /** 关键词检索 */
  KEYWORD = 'keyword',
  /** 混合检索 */
  HYBRID = 'hybrid'
}

/**
 * 生成配置
 */
export interface GenerationConfig {
  /** 模型名称 */
  model: string;
  /** 最大Token数 */
  maxTokens: number;
  /** 温度参数 */
  temperature: number;
  /** Top-P采样 */
  topP: number;
  /** 频率惩罚 */
  frequencyPenalty: number;
  /** 存在惩罚 */
  presencePenalty: number;
}

/**
 * RAG请求
 */
export interface RAGRequest {
  /** 用户问题 */
  query: string;
  /** 会话ID */
  conversationId: string;
  /** 用户ID */
  userId: string;
  /** RAG配置 */
  config: RAGConfig;
}

/**
 * RAG响应
 */
export interface RAGResponse {
  /** 回答内容 */
  answer: string;
  /** 引用的文档 */
  referencedDocuments: KnowledgeReference[];
  /** 检索结果 */
  retrievalResults: RetrievalResult;
  /** Token使用情况 */
  tokenUsage: TokenUsage;
  /** 响应时间(毫秒) */
  responseTime: number;
}
```

#### 3.6 AI提示词类型

```typescript
/**
 * src/types/ai/prompt.ts
 * AI提示词类型定义
 */

/**
 * 提示词模板
 */
export interface PromptTemplate {
  /** 模板ID */
  templateId: string;
  /** 模板名称 */
  name: string;
  /** 模板描述 */
  description: string;
  /** 模板类别 */
  category: PromptCategory;
  /** 模板内容 */
  content: string;
  /** 变量定义 */
  variables: PromptVariable[];
  /** 系统提示词 */
  systemPrompt?: string;
  /** 示例对话 */
  examples?: PromptExample[];
  /** 版本 */
  version: string;
  /** 创建时间 */
  createdAt: string;
  /** 更新时间 */
  updatedAt: string;
}

/**
 * 提示词类别
 */
export enum PromptCategory {
  /** 健康咨询 */
  HEALTH_CONSULTING = 'health_consulting',
  /** 情感陪伴 */
  EMOTIONAL_COMPANIONSHIP = 'emotional_companionship',
  /** 产品推荐 */
  PRODUCT_RECOMMENDATION = 'product_recommendation',
  /** 使用指导 */
  USAGE_GUIDANCE = 'usage_guidance',
  /** 售后服务 */
  AFTER_SALES_SERVICE = 'after_sales_service',
  /** 设备控制 */
  DEVICE_CONTROL = 'device_control',
  /** 闲聊 */
  CASUAL_CHAT = 'casual_chat',
  /** 系统指令 */
  SYSTEM_INSTRUCTION = 'system_instruction'
}

/**
 * 提示词变量
 */
export interface PromptVariable {
  /** 变量名 */
  name: string;
  /** 变量类型 */
  type: 'string' | 'number' | 'boolean' | 'array' | 'object';
  /** 变量描述 */
  description: string;
  /** 是否必填 */
  required: boolean;
  /** 默认值 */
  defaultValue?: any;
  /** 枚举值 */
  enum?: any[];
}

/**
 * 提示词示例
 */
export interface PromptExample {
  /** 示例ID */
  exampleId: string;
  /** 用户输入 */
  input: string;
  /** AI回复 */
  output: string;
  /** 示例说明 */
  explanation?: string;
}

/**
 * 提示词渲染上下文
 */
export interface PromptRenderContext {
  /** 模板ID */
  templateId: string;
  /** 变量值 */
  variables: Record<string, any>;
  /** 用户信息 */
  userInfo: UserInfo;
  /** 会话信息 */
  conversationInfo: ConversationInfo;
  /** 知识库引用 */
  knowledgeReferences?: KnowledgeReference[];
}

/**
 * 用户信息 */
interface UserInfo {
  userId: string;
  nickname: string;
  gender?: string;
  age?: number;
  memberLevel: string;
}

/**
 * 会话信息 */
interface ConversationInfo {
  conversationId: string;
  category: ConversationCategory;
  messageCount: number;
  lastMessageAt?: string;
}
```

---

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

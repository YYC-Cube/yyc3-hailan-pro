---
@file: 070-业务域-IoT设备接口手册.md
@description: HaiLan Pro 智能硬件设备相关接口的详细定义，包含设备绑定、控制、数据同步等
@author: YanYuCloudCube Team
@version: v1.0.0
@created: 2026-02-03
@updated: 2026-02-03
@status: published
@tags: [API接口],[业务域],[IoT]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 070 业务域-IoT设备接口手册

## 概述

本文档详细描述HaiLan Pro项目智能硬件设备相关接口的详细定义，包含设备绑定、控制、数据同步等，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范IoT设备接口的定义和使用
- 为前后端开发人员提供清晰的接口文档
- 保障设备与平台之间的数据交互安全可靠

### 2. 接口列表

| 接口名称 | HTTP方法 | 路径 | 认证要求 |
|---------|---------|------|---------|
| 扫描设备 | GET | /api/v1.0/iot/scan | JWT Token |
| 绑定设备 | POST | /api/v1.0/iot/device/bind | JWT Token |
| 解绑设备 | POST | /api/v1.0/iot/device/unbind | JWT Token |
| 获取设备列表 | GET | /api/v1.0/iot/devices | JWT Token |
| 获取设备详情 | GET | /api/v1.0/iot/device/{deviceId} | JWT Token |
| 控制设备 | POST | /api/v1.0/iot/device/{deviceId}/control | JWT Token |
| 获取设备状态 | GET | /api/v1.0/iot/device/{deviceId}/status | JWT Token |
| 更新设备固件 | POST | /api/v1.0/iot/device/{deviceId}/firmware/update | JWT Token |
| 获取设备数据 | GET | /api/v1.0/iot/device/{deviceId}/data | JWT Token |
| 同步设备数据 | POST | /api/v1.0/iot/device/{deviceId}/sync | JWT Token |
| 设置设备模式 | POST | /api/v1.0/iot/device/{deviceId}/mode | JWT Token |
| 获取设备使用统计 | GET | /api/v1.0/iot/device/{deviceId}/stats | JWT Token |
| 设备固件升级 | POST | /api/v1.0/iot/device/{deviceId}/upgrade | JWT Token |
| 设备重置 | POST | /api/v1.0/iot/device/{deviceId}/reset | JWT Token |

### 3. 接口详情

#### 3.1 扫描设备

##### 3.1.1 接口定义
```
GET /api/v1.0/iot/scan
```

##### 3.1.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.1.3 查询参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| type | string | 否 | 设备类型 | MASSAGER/SENSOR/TOY |
| timeout | number | 否 | 扫描超时时间（秒） | 10 |

##### 3.1.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "扫描成功",
  "data": {
    "devices": [
      {
        "deviceId": "HL-MASSAGER-001",
        "name": "海蓝智能按摩器",
        "type": "MASSAGER",
        "typeText": "按摩器",
        "mac": "AA:BB:CC:DD:EE:FF",
        "rssi": -65,
        "battery": 85,
        "isBound": false,
        "firmwareVersion": "1.2.3"
      }
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.1.5 错误码
| 错误码 | 说明 |
|-------|------|
| 7000 | 蓝牙未开启 |
| 7001 | 扫描超时 |
| 1121 | Token已过期 |

#### 3.2 绑定设备

##### 3.2.1 接口定义
```
POST /api/v1.0/iot/device/bind
```

##### 3.2.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.2.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |
| name | string | 否 | 设备别名 | 我的按摩器 |
| pin | string | 否 | 设备PIN码 | 1234 |

##### 3.2.4 请求示例
```json
{
  "deviceId": "HL-MASSAGER-001",
  "name": "我的按摩器",
  "pin": "1234"
}
```

##### 3.2.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "绑定成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "name": "我的按摩器",
    "type": "MASSAGER",
    "typeText": "按摩器",
    "boundAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.2.6 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7003 | PIN码错误 |
| 7004 | 设备已被绑定 |
| 1121 | Token已过期 |

#### 3.3 解绑设备

##### 3.3.1 接口定义
```
POST /api/v1.0/iot/device/unbind
```

##### 3.3.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.3.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.3.4 请求示例
```json
{
  "deviceId": "HL-MASSAGER-001"
}
```

##### 3.3.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "解绑成功",
  "data": null,
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.3.6 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 1121 | Token已过期 |

#### 3.4 获取设备列表

##### 3.4.1 接口定义
```
GET /api/v1.0/iot/devices
```

##### 3.4.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.4.3 查询参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| type | string | 否 | 设备类型 | MASSAGER/SENSOR/TOY |
| status | string | 否 | 设备状态 | ONLINE/OFFLINE |

##### 3.4.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 3,
    "devices": [
      {
        "deviceId": "HL-MASSAGER-001",
        "name": "我的按摩器",
        "type": "MASSAGER",
        "typeText": "按摩器",
        "status": "ONLINE",
        "statusText": "在线",
        "battery": 85,
        "firmwareVersion": "1.2.3",
        "lastUsedAt": "2026-02-03T09:00:00.000Z",
        "boundAt": "2026-01-15T10:00:00.000Z"
      }
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.4.5 错误码
| 错误码 | 说明 |
|-------|------|
| 1121 | Token已过期 |

#### 3.5 获取设备详情

##### 3.5.1 接口定义
```
GET /api/v1.0/iot/device/{deviceId}
```

##### 3.5.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.5.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.5.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "name": "我的按摩器",
    "type": "MASSAGER",
    "typeText": "按摩器",
    "model": "HL-M100",
    "status": "ONLINE",
    "statusText": "在线",
    "battery": 85,
    "batteryLevel": "HIGH",
    "firmwareVersion": "1.2.3",
    "latestFirmwareVersion": "1.3.0",
    "hasUpdate": true,
    "modes": [
      {
        "modeId": "mode-1",
        "name": "舒缓模式",
        "description": "轻柔按摩，适合放松"
      },
      {
        "modeId": "mode-2",
        "name": "强力模式",
        "description": "深层按摩，适合运动后"
      }
    ],
    "lastUsedAt": "2026-02-03T09:00:00.000Z",
    "boundAt": "2026-01-15T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.5.5 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 1121 | Token已过期 |

#### 3.6 控制设备

##### 3.6.1 接口定义
```
POST /api/v1.0/iot/device/{deviceId}/control
```

##### 3.6.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.6.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.6.4 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| action | string | 是 | 控制动作 | START/STOP/PAUSE/SET_MODE/SET_INTENSITY |
| modeId | string | 否 | 模式ID | mode-1 |
| intensity | number | 否 | 强度等级（1-10） | 5 |
| duration | number | 否 | 持续时间（分钟） | 15 |

##### 3.6.5 请求示例
```json
{
  "action": "SET_MODE",
  "modeId": "mode-1",
  "intensity": 5,
  "duration": 15
}
```

##### 3.6.6 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "控制成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "action": "SET_MODE",
    "modeId": "mode-1",
    "modeName": "舒缓模式",
    "intensity": 5,
    "duration": 15,
    "status": "RUNNING",
    "startedAt": "2026-02-03T10:00:00.000Z",
    "estimatedEndAt": "2026-02-03T10:15:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.6.7 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 7006 | 设备离线 |
| 7007 | 控制动作不支持 |
| 7008 | 电池电量不足 |
| 1121 | Token已过期 |

#### 3.7 获取设备状态

##### 3.7.1 接口定义
```
GET /api/v1.0/iot/device/{deviceId}/status
```

##### 3.7.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.7.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.7.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "status": "RUNNING",
    "statusText": "运行中",
    "battery": 85,
    "batteryLevel": "HIGH",
    "currentMode": {
      "modeId": "mode-1",
      "name": "舒缓模式"
    },
    "intensity": 5,
    "remainingTime": 720,
    "temperature": 38.5,
    "connection": "CONNECTED",
    "signalStrength": -65
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.7.5 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 1121 | Token已过期 |

#### 3.8 更新设备固件

##### 3.8.1 接口定义
```
POST /api/v1.0/iot/device/{deviceId}/firmware/update
```

##### 3.8.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.8.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.8.4 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| version | string | 是 | 目标版本 | 1.3.0 |

##### 3.8.5 请求示例
```json
{
  "version": "1.3.0"
}
```

##### 3.8.6 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "固件更新已开始",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "currentVersion": "1.2.3",
    "targetVersion": "1.3.0",
    "updateId": "update-123",
    "status": "DOWNLOADING",
    "estimatedTime": 300
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.8.7 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 7006 | 设备离线 |
| 7009 | 固件版本不存在 |
| 7010 | 固件更新失败 |
| 1121 | Token已过期 |

#### 3.9 获取设备数据

##### 3.9.1 接口定义
```
GET /api/v1.0/iot/device/{deviceId}/data
```

##### 3.9.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.9.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.9.4 查询参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| startDate | string | 否 | 开始日期 | 2026-01-01 |
| endDate | string | 否 | 结束日期 | 2026-01-31 |
| dataType | string | 否 | 数据类型 | USAGE/HEALTH/SENSOR |

##### 3.9.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "dataType": "USAGE",
    "period": "2026-01-01 至 2026-01-31",
    "totalSessions": 45,
    "totalDuration": 675,
    "averageDuration": 15,
    "dailyData": [
      {
        "date": "2026-01-01",
        "sessions": 2,
        "duration": 30
      }
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.9.6 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 1121 | Token已过期 |

#### 3.10 同步设备数据

##### 3.10.1 接口定义
```
POST /api/v1.0/iot/device/{deviceId}/sync
```

##### 3.10.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.10.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.10.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "同步成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "syncedAt": "2026-02-03T10:00:00.000Z",
    "syncedRecords": 25
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.10.5 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 7006 | 设备离线 |
| 7011 | 同步失败 |
| 1121 | Token已过期 |

#### 3.11 设置设备模式

##### 3.11.1 接口定义
```
POST /api/v1.0/iot/device/{deviceId}/mode
```

##### 3.11.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.11.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.11.4 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| modeId | string | 是 | 模式ID | mode-1 |

##### 3.11.5 请求示例
```json
{
  "modeId": "mode-1"
}
```

##### 3.11.6 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "设置成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "modeId": "mode-1",
    "modeName": "舒缓模式",
    "appliedAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.11.7 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 7006 | 设备离线 |
| 7012 | 模式不存在 |
| 1121 | Token已过期 |

#### 3.12 获取设备使用统计

##### 3.12.1 接口定义
```
GET /api/v1.0/iot/device/{deviceId}/stats
```

##### 3.12.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.12.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.12.4 查询参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| period | string | 否 | 统计周期 | WEEK/MONTH/YEAR |

##### 3.12.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "period": "WEEK",
    "periodText": "本周",
    "totalSessions": 15,
    "totalDuration": 225,
    "averageDuration": 15,
    "mostUsedMode": {
      "modeId": "mode-1",
      "name": "舒缓模式",
      "usageCount": 10
    },
    "healthScore": 85,
    "recommendations": [
      "建议适当增加使用频率",
      "可尝试不同模式"
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.12.6 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 1121 | Token已过期 |

#### 3.13 设备固件升级

##### 3.13.1 接口定义
```
POST /api/v1.0/iot/device/{deviceId}/upgrade
```

##### 3.13.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.13.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.13.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "升级已开始",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "currentVersion": "1.2.3",
    "latestVersion": "1.3.0",
    "upgradeId": "upgrade-123",
    "status": "UPGRADING",
    "progress": 0
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.13.5 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 7006 | 设备离线 |
| 7010 | 固件更新失败 |
| 1121 | Token已过期 |

#### 3.14 设备重置

##### 3.14.1 接口定义
```
POST /api/v1.0/iot/device/{deviceId}/reset
```

##### 3.14.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.14.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| deviceId | string | 是 | 设备ID | HL-MASSAGER-001 |

##### 3.14.4 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| type | string | 是 | 重置类型 | SOFT/HARD |

##### 3.14.5 请求示例
```json
{
  "type": "SOFT"
}
```

##### 3.14.6 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "重置成功",
  "data": {
    "deviceId": "HL-MASSAGER-001",
    "resetType": "SOFT",
    "resetAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.14.7 错误码
| 错误码 | 说明 |
|-------|------|
| 7002 | 设备不存在 |
| 7005 | 设备未绑定 |
| 7006 | 设备离线 |
| 7013 | 重置失败 |
| 1121 | Token已过期 |

### 4. 数据模型

#### 4.1 设备模型

```typescript
interface Device {
  deviceId: string;
  name: string;
  type: 'MASSAGER' | 'SENSOR' | 'TOY';
  typeText: string;
  model: string;
  status: 'ONLINE' | 'OFFLINE' | 'RUNNING';
  statusText: string;
  battery: number;
  batteryLevel: 'LOW' | 'MEDIUM' | 'HIGH';
  firmwareVersion: string;
  latestFirmwareVersion?: string;
  hasUpdate?: boolean;
  boundAt: string;
  lastUsedAt?: string;
}
```

#### 4.2 设备模式模型

```typescript
interface DeviceMode {
  modeId: string;
  name: string;
  description: string;
  intensity?: number;
  duration?: number;
}
```

#### 4.3 设备状态模型

```typescript
interface DeviceStatus {
  deviceId: string;
  status: 'IDLE' | 'RUNNING' | 'PAUSED';
  statusText: string;
  battery: number;
  batteryLevel: 'LOW' | 'MEDIUM' | 'HIGH';
  currentMode?: DeviceMode;
  intensity?: number;
  remainingTime?: number;
  temperature?: number;
  connection: 'CONNECTED' | 'DISCONNECTED';
  signalStrength?: number;
}
```

#### 4.4 设备数据模型

```typescript
interface DeviceData {
  deviceId: string;
  dataType: 'USAGE' | 'HEALTH' | 'SENSOR';
  period: string;
  totalSessions: number;
  totalDuration: number;
  averageDuration: number;
  dailyData: DailyData[];
}

interface DailyData {
  date: string;
  sessions: number;
  duration: number;
}
```

### 5. 最佳实践

#### 5.1 前端实现

##### 5.1.1 蓝牙设备扫描
```typescript
// 扫描蓝牙设备
const scanDevices = async (timeout = 10) => {
  try {
    const bluetooth = navigator.bluetooth;
    
    const device = await bluetooth.requestDevice({
      filters: [{ services: ['0000ffe0-0000-1000-8000-00805f9b34fb'] }],
      optionalServices: ['0000ffe1-0000-1000-8000-00805f9b34fb']
    });
    
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService('0000ffe0-0000-1000-8000-00805f9b34fb');
    const characteristic = await service.getCharacteristic('0000ffe1-0000-1000-8000-00805f9b34fb');
    
    return {
      deviceId: device.id,
      name: device.name,
      characteristic
    };
  } catch (error) {
    console.error('扫描失败:', error);
    throw error;
  }
};
```

##### 5.1.2 设备连接与控制
```typescript
// 连接并控制设备
const connectAndControl = async (deviceId, action, params) => {
  try {
    const response = await fetch(`/api/v1.0/iot/device/${deviceId}/control`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ action, ...params })
    });
    
    const result = await response.json();
    
    if (result.success) {
      await sendToDevice(result.data);
    }
    
    return result;
  } catch (error) {
    console.error('控制失败:', error);
    throw error;
  }
};

const sendToDevice = async (data) => {
  const command = JSON.stringify({
    action: data.action,
    modeId: data.modeId,
    intensity: data.intensity,
    duration: data.duration
  });
  
  await characteristic.writeValue(new TextEncoder().encode(command));
};
```

#### 5.2 后端实现

##### 5.2.1 设备绑定验证
```typescript
// 验证设备绑定
async function bindDevice(userId, deviceId, pin) {
  const device = await prisma.device.findUnique({
    where: { deviceId }
  });
  
  if (!device) {
    throw new Error('设备不存在');
  }
  
  if (device.boundUserId) {
    throw new Error('设备已被绑定');
  }
  
  const isValidPin = await verifyDevicePin(deviceId, pin);
  if (!isValidPin) {
    throw new Error('PIN码错误');
  }
  
  await prisma.device.update({
    where: { deviceId },
    data: {
      boundUserId: userId,
      boundAt: new Date()
    }
  });
  
  return device;
}
```

##### 5.2.2 设备数据加密传输
```typescript
// 加密设备控制指令
import * as crypto from 'crypto';

function encryptDeviceCommand(command, deviceKey) {
  const iv = crypto.randomBytes(16);
  const cipher = crypto.createCipheriv('aes-256-cbc', deviceKey, iv);
  
  let encrypted = cipher.update(JSON.stringify(command), 'utf8', 'hex');
  encrypted += cipher.final('hex');
  
  return {
    iv: iv.toString('hex'),
    data: encrypted
  };
}

function decryptDeviceResponse(response, deviceKey, iv) {
  const decipher = crypto.createDecipheriv('aes-256-cbc', deviceKey, Buffer.from(iv, 'hex'));
  
  let decrypted = decipher.update(response, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  
  return JSON.parse(decrypted);
}
```

### 6. 安全注意事项

#### 6.1 设备安全
- 使用加密通信协议（TLS 1.3）
- 实现设备身份验证机制
- 定期更新设备固件
- 监控异常设备行为

#### 6.2 数据安全
- 设备数据加密存储
- 敏感数据脱敏处理
- 实现数据访问控制
- 定期备份设备数据

#### 6.3 隐私保护
- 不记录设备使用详细日志
- 支持用户删除设备数据
- 设备数据匿名化处理
- 符合数据保护法规

#### 6.4 通信安全
- 使用端到端加密
- 实现消息完整性校验
- 防止重放攻击
- 支持设备密钥轮换

## 附录

### A. 参考文档

- RESTful接口设计标准
- 接口错误码体系
- 接口签名鉴权手册
- YYC³项目规范文档

### B. 术语表

- IoT：Internet of Things（物联网）
- BLE：Bluetooth Low Energy（低功耗蓝牙）
- MAC：Media Access Control（媒体访问控制）
- RSSI：Received Signal Strength Indicator（接收信号强度指示）
- Firmware：固件

---

<div align="center">

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

</div>

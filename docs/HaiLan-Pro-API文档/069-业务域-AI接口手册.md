---
@file: 069-业务域-AI接口手册.md
@description: HaiLan Pro AI功能相关接口的详细定义，包含对话、推荐、问答等
@author: YanYuCloudCube Team
@version: v1.0.0
@created: 2026-02-03
@updated: 2026-02-03
@status: published
@tags: [API接口],[业务域],[AI]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 069 业务域-AI接口手册

## 概述

本文档详细描述HaiLan Pro项目AI功能相关接口的详细定义，包含对话、推荐、问答等，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范AI接口的定义和使用
- 为前后端开发人员提供清晰的接口文档
- 保障接口的一致性和可维护性

### 2. 接口列表

| 接口名称 | HTTP方法 | 路径 | 认证要求 |
|---------|---------|------|---------|
| AI对话 | POST | /api/v1.0/ai/chat | JWT Token |
| 获取对话历史 | GET | /api/v1.0/ai/chat/history | JWT Token |
| 获取对话详情 | GET | /api/v1.0/ai/chat/{chatId} | JWT Token |
| 删除对话 | DELETE | /api/v1.0/ai/chat/{chatId} | JWT Token |
| AI推荐 | POST | /api/v1.0/ai/recommend | JWT Token |
| 获取推荐历史 | GET | /api/v1.0/ai/recommend/history | JWT Token |
| AI问答 | POST | /api/v1.0/ai/qa | JWT Token |
| 获取问答历史 | GET | /api/v1.0/ai/qa/history | JWT Token |
| AI情感分析 | POST | /api/v1.0/ai/sentiment | JWT Token |
| AI健康评估 | POST | /api/v1.0/ai/health-assessment | JWT Token |
| 获取AI使用统计 | GET | /api/v1.0/ai/usage-stats | JWT Token |

### 3. 接口详情

#### 3.1 AI对话

##### 3.1.1 接口定义
```
POST /api/v1.0/ai/chat
```

##### 3.1.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.1.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| message | string | 是 | 用户消息 | 你好，我想了解一下产品 |
| chatId | string | 否 | 对话ID（续聊时使用） | chat-123 |
| model | string | 否 | AI模型 | GPT-4/CLAUDE-3/GEMINI-PRO |
| stream | boolean | 否 | 是否流式输出 | false |

##### 3.1.4 请求示例
```json
{
  "message": "你好，我想了解一下产品",
  "model": "GPT-4",
  "stream": false
}
```

##### 3.1.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "对话成功",
  "data": {
    "chatId": "chat-123",
    "messageId": "msg-456",
    "response": "您好！我是海蓝AI助手，很高兴为您服务。请问您想了解哪方面的产品呢？",
    "model": "GPT-4",
    "tokensUsed": 150,
    "createdAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.1.6 错误码
| 错误码 | 说明 |
|-------|------|
| 6100 | 消息内容为空 |
| 6101 | AI模型不支持 |
| 6102 | Token余额不足 |
| 1121 | Token已过期 |

#### 3.2 获取对话历史

##### 3.2.1 接口定义
```
GET /api/v1.0/ai/chat/history
```

##### 3.2.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.2.3 查询参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| page | number | 否 | 页码 | 1 |
| pageSize | number | 否 | 每页数量 | 20 |

##### 3.2.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 50,
    "page": 1,
    "pageSize": 20,
    "chats": [
      {
        "chatId": "chat-123",
        "title": "产品咨询",
        "lastMessage": "请问您想了解哪方面的产品呢？",
        "messageCount": 5,
        "createdAt": "2026-02-03T10:00:00.000Z",
        "updatedAt": "2026-02-03T10:05:00.000Z"
      }
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.2.5 错误码
| 错误码 | 说明 |
|-------|------|
| 1121 | Token已过期 |

#### 3.3 获取对话详情

##### 3.3.1 接口定义
```
GET /api/v1.0/ai/chat/{chatId}
```

##### 3.3.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.3.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| chatId | string | 是 | 对话ID | chat-123 |

##### 3.3.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "chatId": "chat-123",
    "title": "产品咨询",
    "messages": [
      {
        "messageId": "msg-123",
        "role": "USER",
        "content": "你好，我想了解一下产品",
        "createdAt": "2026-02-03T10:00:00.000Z"
      },
      {
        "messageId": "msg-124",
        "role": "ASSISTANT",
        "content": "您好！我是海蓝AI助手，很高兴为您服务。请问您想了解哪方面的产品呢？",
        "createdAt": "2026-02-03T10:00:01.000Z"
      }
    ],
    "createdAt": "2026-02-03T10:00:00.000Z",
    "updatedAt": "2026-02-03T10:05:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.3.5 错误码
| 错误码 | 说明 |
|-------|------|
| 6103 | 对话不存在 |
| 1121 | Token已过期 |

#### 3.4 删除对话

##### 3.4.1 接口定义
```
DELETE /api/v1.0/ai/chat/{chatId}
```

##### 3.4.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.4.3 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| chatId | string | 是 | 对话ID | chat-123 |

##### 3.4.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "删除成功",
  "data": null,
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.4.5 错误码
| 错误码 | 说明 |
|-------|------|
| 6103 | 对话不存在 |
| 1121 | Token已过期 |

#### 3.5 AI推荐

##### 3.5.1 接口定义
```
POST /api/v1.0/ai/recommend
```

##### 3.5.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.5.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| type | string | 是 | 推荐类型 | PRODUCT/CONTENT/HEALTH |
| preferences | object | 否 | 用户偏好 | 见下方 |
| limit | number | 否 | 返回数量限制 | 10 |

##### 3.5.4 请求示例
```json
{
  "type": "PRODUCT",
  "preferences": {
    "category": "智能设备",
    "priceRange": "200-500",
    "features": ["蓝牙", "防水"]
  },
  "limit": 10
}
```

##### 3.5.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "推荐成功",
  "data": {
    "recommendId": "rec-123",
    "type": "PRODUCT",
    "items": [
      {
        "productId": "prod-123",
        "name": "海蓝智能按摩器",
        "reason": "根据您的浏览历史和偏好推荐",
        "score": 0.95,
        "price": 299.00,
        "image": "https://cdn.hailan.com/products/prod-123.jpg"
      }
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.5.6 错误码
| 错误码 | 说明 |
|-------|------|
| 6104 | 推荐类型不支持 |
| 1121 | Token已过期 |

#### 3.6 AI问答

##### 3.6.1 接口定义
```
POST /api/v1.0/ai/qa
```

##### 3.6.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.6.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| question | string | 是 | 问题 | 如何正确使用按摩器？ |
| category | string | 否 | 问题分类 | USAGE/HEALTH/PRODUCT |

##### 3.6.4 请求示例
```json
{
  "question": "如何正确使用按摩器？",
  "category": "USAGE"
}
```

##### 3.6.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "问答成功",
  "data": {
    "qaId": "qa-123",
    "question": "如何正确使用按摩器？",
    "answer": "使用按摩器前，请先清洁双手和设备。建议使用润滑剂以减少摩擦。从低档位开始，逐渐增加强度。每次使用时间建议不超过30分钟。使用后请及时清洁并充电。",
    "category": "USAGE",
    "relatedQuestions": [
      "按摩器需要充电吗？",
      "如何清洁按摩器？"
    ],
    "createdAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.6.6 错误码
| 错误码 | 说明 |
|-------|------|
| 6100 | 问题内容为空 |
| 6105 | 问题分类不支持 |
| 1121 | Token已过期 |

#### 3.7 AI情感分析

##### 3.7.1 接口定义
```
POST /api/v1.0/ai/sentiment
```

##### 3.7.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.7.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| text | string | 是 | 待分析文本 | 今天心情很好，感觉很放松 |

##### 3.7.4 请求示例
```json
{
  "text": "今天心情很好，感觉很放松"
}
```

##### 3.7.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "分析成功",
  "data": {
    "sentimentId": "sent-123",
    "sentiment": "POSITIVE",
    "sentimentText": "积极",
    "confidence": 0.92,
    "emotions": {
      "joy": 0.85,
      "relaxation": 0.78,
      "satisfaction": 0.72
    },
    "suggestions": [
      "保持积极心态",
      "适当运动增强放松效果"
    ],
    "createdAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.7.6 错误码
| 错误码 | 说明 |
|-------|------|
| 6100 | 文本内容为空 |
| 1121 | Token已过期 |

#### 3.8 AI健康评估

##### 3.8.1 接口定义
```
POST /api/v1.0/ai/health-assessment
```

##### 3.8.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.8.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| type | string | 是 | 评估类型 | PHYSICAL/MENTAL/OVERALL |
| data | object | 是 | 评估数据 | 见下方 |

##### 3.8.4 请求示例
```json
{
  "type": "PHYSICAL",
  "data": {
    "sleepHours": 7,
    "exerciseMinutes": 30,
    "stressLevel": 3,
    "energyLevel": 7
  }
}
```

##### 3.8.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "评估成功",
  "data": {
    "assessmentId": "assess-123",
    "type": "PHYSICAL",
    "score": 78,
    "level": "GOOD",
    "levelText": "良好",
    "dimensions": {
      "sleep": 85,
      "exercise": 70,
      "stress": 75,
      "energy": 82
    },
    "recommendations": [
      "建议增加睡眠时间至8小时",
      "适当增加有氧运动"
    ],
    "createdAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.8.6 错误码
| 错误码 | 说明 |
|-------|------|
| 6106 | 评估类型不支持 |
| 6107 | 评估数据不完整 |
| 1121 | Token已过期 |

#### 3.9 获取AI使用统计

##### 3.9.1 接口定义
```
GET /api/v1.0/ai/usage-stats
```

##### 3.9.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.9.3 查询参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| startDate | string | 否 | 开始日期 | 2026-01-01 |
| endDate | string | 否 | 结束日期 | 2026-01-31 |

##### 3.9.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "period": "2026-01-01 至 2026-01-31",
    "totalChats": 50,
    "totalMessages": 200,
    "totalTokensUsed": 30000,
    "totalRecommendations": 30,
    "totalQa": 20,
    "breakdown": {
      "chat": 15000,
      "recommend": 8000,
      "qa": 5000,
      "sentiment": 2000
    },
    "dailyAverage": {
      "chats": 1.6,
      "messages": 6.5,
      "tokens": 968
    }
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.9.5 错误码
| 错误码 | 说明 |
|-------|------|
| 1121 | Token已过期 |

### 4. 数据模型

#### 4.1 对话消息模型

```typescript
interface ChatMessage {
  messageId: string;
  chatId: string;
  role: 'USER' | 'ASSISTANT' | 'SYSTEM';
  content: string;
  tokensUsed?: number;
  createdAt: string;
}
```

#### 4.2 对话模型

```typescript
interface Chat {
  chatId: string;
  title: string;
  lastMessage: string;
  messageCount: number;
  model: string;
  createdAt: string;
  updatedAt: string;
}
```

#### 4.3 推荐模型

```typescript
interface Recommendation {
  recommendId: string;
  type: 'PRODUCT' | 'CONTENT' | 'HEALTH';
  items: RecommendationItem[];
  createdAt: string;
}

interface RecommendationItem {
  productId?: string;
  name: string;
  reason: string;
  score: number;
  price?: number;
  image?: string;
}
```

#### 4.4 问答模型

```typescript
interface QA {
  qaId: string;
  question: string;
  answer: string;
  category: string;
  relatedQuestions: string[];
  createdAt: string;
}
```

### 5. 最佳实践

#### 5.1 前端实现

##### 5.1.1 流式输出处理
```typescript
// 处理AI流式响应
const handleStreamResponse = async (response) => {
  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  
  while (true) {
    const { done, value } = await reader.read();
    if (done) break;
    
    const chunk = decoder.decode(value);
    const lines = chunk.split('\n');
    
    for (const line of lines) {
      if (line.startsWith('data: ')) {
        const data = JSON.parse(line.slice(6));
        appendMessage(data.content);
      }
    }
  }
};
```

##### 5.1.2 对话上下文管理
```typescript
// 维护对话上下文
const chatContext = {
  chatId: null,
  messages: [],
  maxMessages: 20
};

const sendMessage = async (message) => {
  chatContext.messages.push({
    role: 'USER',
    content: message,
    timestamp: Date.now()
  });
  
  if (chatContext.messages.length > chatContext.maxMessages) {
    chatContext.messages = chatContext.messages.slice(-chatContext.maxMessages);
  }
  
  return await aiChat({
    chatId: chatContext.chatId,
    message,
    context: chatContext.messages
  });
};
```

#### 5.2 后端实现

##### 5.2.1 AI模型调用
```typescript
// 统一AI模型调用接口
class AIModelClient {
  async chat(model: string, messages: Message[], options?: ChatOptions) {
    switch (model) {
      case 'GPT-4':
        return await this.callOpenAI(messages, options);
      case 'CLAUDE-3':
        return await this.callAnthropic(messages, options);
      case 'GEMINI-PRO':
        return await this.callGoogle(messages, options);
      default:
        throw new Error('Unsupported model');
    }
  }
  
  private async callOpenAI(messages, options) {
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${process.env.OPENAI_API_KEY}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: 'gpt-4',
        messages,
        stream: options?.stream || false
      })
    });
    return await response.json();
  }
}
```

##### 5.2.2 Token使用统计
```typescript
// 记录Token使用情况
async function trackTokenUsage(userId, model, tokens) {
  await prisma.tokenUsage.create({
    data: {
      userId,
      model,
      tokens,
      cost: calculateCost(model, tokens),
      createdAt: new Date()
    }
  });
}

function calculateCost(model, tokens) {
  const pricing = {
    'GPT-4': 0.03,
    'CLAUDE-3': 0.015,
    'GEMINI-PRO': 0.02
  };
  return (tokens / 1000) * pricing[model];
}
```

### 6. 安全注意事项

#### 6.1 内容安全
- 实现内容过滤机制
- 检测敏感词汇
- 拦截不当请求
- 记录安全事件

#### 6.2 隐私保护
- 不在日志中记录用户对话内容
- 支持用户删除对话历史
- 对话数据加密存储
- 符合数据保护法规

#### 6.3 使用限制
- 实现Token配额管理
- 防止恶意刷接口
- 支持速率限制
- 提供使用统计

#### 6.4 模型安全
- 验证模型调用权限
- 监控API密钥使用
- 实现降级策略
- 支持多模型切换

## 附录

### A. 参考文档

- RESTful接口设计标准
- 接口错误码体系
- 接口签名鉴权手册
- YYC³项目规范文档

### B. 术语表

- LLM：Large Language Model（大语言模型）
- GPT：Generative Pre-trained Transformer
- Token：AI模型的基本计量单位
- Stream：流式输出

---

<div align="center">

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

</div>

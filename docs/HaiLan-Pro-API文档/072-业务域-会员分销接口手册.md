---
file: 072-业务域-会员分销接口手册.md
description: HaiLan Pro 会员与分销系统相关接口的详细定义，包含积分、等级、推广等
author: YanYuCloudCube Team
version: v1.0.0
created: 2026-01-26
updated: 2026-01-26
status: published
tags:
  - HaiLan-Pro-API文档,[]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 072 业务域-会员分销接口手册

## 概述

本文档详细描述HaiLan Pro-HaiLan-Pro-API文档-业务域-会员分销接口手册相关内容，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范业务域-会员分销接口手册相关的业务标准与技术落地要求
- 为项目相关人员提供清晰的参考依据
- 保障相关模块开发、实施、运维的一致性与规范性

### 2. 设计原则

#### 2.1 五高原则
- **高可用性**：确保系统7x24小时稳定运行，支持PWA离线能力
- **高性能**：优化响应时间和处理能力，支持高并发访问
- **高安全性**：保护用户数据和隐私安全，双重加密机制
- **高扩展性**：支持业务快速扩展，微服务架构设计
- **高可维护性**：便于后续维护和升级，模块化设计

#### 2.2 五标体系
- **标准化**：统一的技术和流程标准
- **规范化**：严格的开发和管理规范
- **自动化**：提高开发效率和质量，CI/CD自动化
- **智能化**：利用AI技术提升能力，LLM智能顾问
- **可视化**：直观的监控和管理界面

#### 2.3 五化架构
- **流程化**：标准化的开发流程
- **文档化**：完善的文档体系
- **工具化**：高效的开发工具链
- **数字化**：数据驱动的决策
- **生态化**：开放的生态系统

### 3. 业务域-会员分销接口手册

#### 3.1 会员等级体系

##### 3.1.1 会员等级定义

HaiLan Pro采用多层级会员体系，为不同等级的会员提供差异化的权益和服务。

| 等级 | 等级名称 | 消费门槛 | 积分要求 | 有效期 | 主要权益 |
|------|----------|----------|----------|--------|----------|
| LV0 | 普通会员 | 0元 | 0分 | 永久 | 基础购物、社区互动 |
| LV1 | 铜牌会员 | 500元 | 500分 | 1年 | 9.5折优惠、专属客服 |
| LV2 | 银牌会员 | 2000元 | 2000分 | 1年 | 9折优惠、优先发货、生日礼包 |
| LV3 | 金牌会员 | 5000元 | 5000分 | 1年 | 8.5折优惠、专属顾问、免费换货 |
| LV4 | 铂金会员 | 10000元 | 10000分 | 1年 | 8折优惠、VIP通道、定制服务 |
| LV5 | 钻石会员 | 20000元 | 20000分 | 1年 | 7.5折优惠、专属管家、新品试用 |

##### 3.1.2 会员等级升级规则

```typescript
/**
 * 会员等级升级规则
 * @description 根据消费金额和积分自动升级会员等级
 */
interface MemberLevelRule {
  level: number;
  levelName: string;
  minSpend: number;        // 最低消费金额（元）
  minPoints: number;       // 最低积分要求
  discountRate: number;    // 折扣率（0.85表示8.5折）
  benefits: string[];      // 权益列表
}

const MEMBER_LEVEL_RULES: MemberLevelRule[] = [
  {
    level: 1,
    levelName: '铜牌会员',
    minSpend: 500,
    minPoints: 500,
    discountRate: 0.95,
    benefits: ['9.5折优惠', '专属客服', '积分倍率1.2x']
  },
  {
    level: 2,
    levelName: '银牌会员',
    minSpend: 2000,
    minPoints: 2000,
    discountRate: 0.9,
    benefits: ['9折优惠', '优先发货', '生日礼包', '积分倍率1.5x']
  },
  {
    level: 3,
    levelName: '金牌会员',
    minSpend: 5000,
    minPoints: 5000,
    discountRate: 0.85,
    benefits: ['8.5折优惠', '专属顾问', '免费换货', '积分倍率2x']
  },
  {
    level: 4,
    levelName: '铂金会员',
    minSpend: 10000,
    minPoints: 10000,
    discountRate: 0.8,
    benefits: ['8折优惠', 'VIP通道', '定制服务', '积分倍率2.5x']
  },
  {
    level: 5,
    levelName: '钻石会员',
    minSpend: 20000,
    minPoints: 20000,
    discountRate: 0.75,
    benefits: ['7.5折优惠', '专属管家', '新品试用', '积分倍率3x']
  }
];

/**
 * 计算会员等级
 * @param totalSpend 累计消费金额
 * @param totalPoints 累计积分
 * @returns 会员等级
 */
function calculateMemberLevel(totalSpend: number, totalPoints: number): number {
  for (let i = MEMBER_LEVEL_RULES.length - 1; i >= 0; i--) {
    const rule = MEMBER_LEVEL_RULES[i];
    if (totalSpend >= rule.minSpend && totalPoints >= rule.minPoints) {
      return rule.level;
    }
  }
  return 0;
}
```

#### 3.2 积分系统

##### 3.2.1 积分获取规则

| 获取方式 | 积分比例 | 说明 | 上限 |
|----------|----------|------|------|
| 购物消费 | 1元=1积分 | 实际支付金额 | 无上限 |
| 签到 | 5积分/天 | 每日签到奖励 | 150积分/月 |
| 评价商品 | 10积分/次 | 图文评价 | 300积分/月 |
| 分享商品 | 5积分/次 | 分享到社交平台 | 100积分/月 |
| 邀请好友 | 100积分/人 | 好友注册并完成首单 | 1000积分/月 |
| 生日特权 | 500积分 | 生日当天领取 | 500积分/年 |
| 完善资料 | 50积分 | 首次完善个人资料 | 50积分/次 |

##### 3.2.2 积分兑换规则

| 兑换类型 | 兑换比例 | 说明 | 最低兑换 |
|----------|----------|------|----------|
| 现金抵扣 | 100积分=1元 | 购物时抵扣 | 100积分 |
| 优惠券 | 500积分=10元券 | 无门槛优惠券 | 500积分 |
| 会员卡 | 5000积分=月卡 | 会员月卡 | 5000积分 |
| 商品兑换 | 按商品价值 | 专属积分商品 | 按商品要求 |

##### 3.2.3 积分API接口

**获取积分余额**

```http
GET /api/member/points/balance
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| - | - | - | 无 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "userId": "user_123",
    "totalPoints": 12500,
    "availablePoints": 9800,
    "frozenPoints": 2700,
    "level": 3,
    "levelName": "金牌会员",
    "nextLevelPoints": 10000,
    "nextLevelName": "铂金会员",
    "pointsExpireDate": "2026-12-31"
  }
}
```

**积分流水查询**

```http
GET /api/member/points/records
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| type | string | 否 | 流水类型：EARN(获取)/SPEND(消费)/EXPIRE(过期) |
| page | number | 否 | 页码，默认1 |
| pageSize | number | 否 | 每页数量，默认20 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "total": 150,
    "page": 1,
    "pageSize": 20,
    "records": [
      {
        "id": "point_001",
        "type": "EARN",
        "amount": 100,
        "balance": 9800,
        "description": "购物消费获得积分",
        "orderId": "order_123",
        "createdAt": "2026-02-01T10:30:00Z"
      },
      {
        "id": "point_002",
        "type": "SPEND",
        "amount": -50,
        "balance": 9700,
        "description": "积分兑换优惠券",
        "couponId": "coupon_456",
        "createdAt": "2026-02-01T09:15:00Z"
      }
    ]
  }
}
```

**每日签到**

```http
POST /api/member/points/check-in
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| - | - | - | 无 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "userId": "user_123",
    "pointsEarned": 5,
    "totalPoints": 9805,
    "consecutiveDays": 7,
    "bonusPoints": 10,
    "checkInDate": "2026-02-03",
    "message": "签到成功！连续签到7天，获得额外10积分奖励"
  }
}
```

#### 3.3 分销系统

##### 3.3.1 分销员等级体系

| 等级 | 等级名称 | 累计销售额 | 团队人数 | 佣金比例 | 主要权益 |
|------|----------|------------|----------|----------|----------|
| LV1 | 初级分销员 | 0元 | 0人 | 5% | 基础佣金 |
| LV2 | 中级分销员 | 5000元 | 10人 | 8% | 提高佣金、培训支持 |
| LV3 | 高级分销员 | 20000元 | 50人 | 12% | 更高佣金、专属活动 |
| LV4 | 核心分销员 | 50000元 | 100人 | 15% | 高佣金、团队管理权 |
| LV5 | 合伙人 | 100000元 | 200人 | 20% | 最高佣金、股权激励 |

##### 3.3.2 佣金计算规则

```typescript
/**
 * 佣金计算规则
 * @description 根据分销员等级和订单金额计算佣金
 */
interface CommissionRule {
  level: number;
  levelName: string;
  minSales: number;        // 最低销售额（元）
  minTeamSize: number;     // 最低团队人数
  commissionRate: number;  // 佣金比例
  teamCommissionRate: number; // 团队佣金比例
}

const COMMISSION_RULES: CommissionRule[] = [
  {
    level: 1,
    levelName: '初级分销员',
    minSales: 0,
    minTeamSize: 0,
    commissionRate: 0.05,
    teamCommissionRate: 0.02
  },
  {
    level: 2,
    levelName: '中级分销员',
    minSales: 5000,
    minTeamSize: 10,
    commissionRate: 0.08,
    teamCommissionRate: 0.03
  },
  {
    level: 3,
    levelName: '高级分销员',
    minSales: 20000,
    minTeamSize: 50,
    commissionRate: 0.12,
    teamCommissionRate: 0.05
  },
  {
    level: 4,
    levelName: '核心分销员',
    minSales: 50000,
    minTeamSize: 100,
    commissionRate: 0.15,
    teamCommissionRate: 0.08
  },
  {
    level: 5,
    levelName: '合伙人',
    minSales: 100000,
    minTeamSize: 200,
    commissionRate: 0.20,
    teamCommissionRate: 0.10
  }
];

/**
 * 计算直接佣金
 * @param orderAmount 订单金额
 * @param distributorLevel 分销员等级
 * @returns 佣金金额
 */
function calculateDirectCommission(orderAmount: number, distributorLevel: number): number {
  const rule = COMMISSION_RULES.find(r => r.level === distributorLevel);
  if (!rule) return 0;
  return orderAmount * rule.commissionRate;
}

/**
 * 计算团队佣金
 * @param orderAmount 订单金额
 * @param distributorLevel 分销员等级
 * @returns 团队佣金金额
 */
function calculateTeamCommission(orderAmount: number, distributorLevel: number): number {
  const rule = COMMISSION_RULES.find(r => r.level === distributorLevel);
  if (!rule) return 0;
  return orderAmount * rule.teamCommissionRate;
}

/**
 * 计算分销员等级
 * @param totalSales 累计销售额
 * @param teamSize 团队人数
 * @returns 分销员等级
 */
function calculateDistributorLevel(totalSales: number, teamSize: number): number {
  for (let i = COMMISSION_RULES.length - 1; i >= 0; i--) {
    const rule = COMMISSION_RULES[i];
    if (totalSales >= rule.minSales && teamSize >= rule.minTeamSize) {
      return rule.level;
    }
  }
  return 1;
}
```

##### 3.3.3 分销API接口

**申请成为分销员**

```http
POST /api/distributor/apply
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "realName": "张三",
  "idCard": "110101199001011234",
  "phone": "13800138000",
  "wechat": "wx123456",
  "alipayAccount": "alipay123",
  "region": "北京市朝阳区",
  "experience": "有电商销售经验",
  "reason": "希望推广优质产品"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "distributorId": "dist_001",
    "userId": "user_123",
    "status": "PENDING",
    "level": 1,
    "levelName": "初级分销员",
    "inviteCode": "HL20260203",
    "inviteLink": "https://hailan.pro/invite/HL20260203",
    "qrCode": "https://hailan.pro/qr/HL20260203.png",
    "createdAt": "2026-02-03T10:00:00Z"
  }
}
```

**获取推广链接**

```http
GET /api/distributor/invite-link
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| productId | string | 否 | 商品ID，不传则返回通用推广链接 |
| channel | string | 否 | 推广渠道：WECHAT/WEIBO/DOUYIN/TIKTOK/OTHER |

**响应示例**

```json
{
  "success": true,
  "data": {
    "inviteCode": "HL20260203",
    "inviteLink": "https://hailan.pro/invite/HL20260203?productId=prod_123",
    "shortLink": "https://hl.pro/HL20260203",
    "qrCode": "https://hailan.pro/qr/HL20260203.png",
    "shareText": "海蓝Pro - 高端情趣健康生活管理平台，新用户注册即送500积分",
    "shareImage": "https://hailan.pro/share/HL20260203.jpg",
    "validDays": 30
  }
}
```

**佣金流水查询**

```http
GET /api/distributor/commission/records
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| type | string | 否 | 佣金类型：DIRECT(直接)/TEAM(团队)/WITHDRAW(提现) |
| status | string | 否 | 状态：PENDING(待结算)/SETTLED(已结算)/FROZEN(冻结) |
| startDate | string | 否 | 开始日期，格式：YYYY-MM-DD |
| endDate | string | 否 | 结束日期，格式：YYYY-MM-DD |
| page | number | 否 | 页码，默认1 |
| pageSize | number | 否 | 每页数量，默认20 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "total": 50,
    "page": 1,
    "pageSize": 20,
    "summary": {
      "totalCommission": 12500.00,
      "settledCommission": 9800.00,
      "pendingCommission": 2700.00,
      "frozenCommission": 0.00
    },
    "records": [
      {
        "id": "comm_001",
        "type": "DIRECT",
        "amount": 120.00,
        "status": "SETTLED",
        "orderId": "order_123",
        "orderAmount": 1200.00,
        "commissionRate": 0.10,
        "buyerId": "user_456",
        "settledAt": "2026-02-01T10:30:00Z",
        "createdAt": "2026-01-25T14:20:00Z"
      },
      {
        "id": "comm_002",
        "type": "TEAM",
        "amount": 30.00,
        "status": "PENDING",
        "orderId": "order_789",
        "orderAmount": 600.00,
        "commissionRate": 0.05,
        "teamMemberId": "dist_002",
        "estimatedSettleDate": "2026-02-10T00:00:00Z",
        "createdAt": "2026-01-30T16:45:00Z"
      }
    ]
  }
}
```

**佣金提现申请**

```http
POST /api/distributor/commission/withdraw
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "amount": 1000.00,
  "withdrawMethod": "ALIPAY",
  "account": "alipay123",
  "accountName": "张三",
  "remark": "佣金提现"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "withdrawId": "withdraw_001",
    "distributorId": "dist_001",
    "amount": 1000.00,
    "fee": 5.00,
    "actualAmount": 995.00,
    "withdrawMethod": "ALIPAY",
    "account": "alipay***23",
    "status": "PENDING",
    "estimatedArrivalDate": "2026-02-05T00:00:00Z",
    "createdAt": "2026-02-03T10:00:00Z"
  }
}
```

**分销数据统计**

```http
GET /api/distributor/statistics
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| period | string | 否 | 统计周期：TODAY/YESTERDAY/WEEK/MONTH/YEAR/ALL，默认MONTH |

**响应示例**

```json
{
  "success": true,
  "data": {
    "period": "MONTH",
    "startDate": "2026-01-01",
    "endDate": "2026-01-31",
    "overview": {
      "totalSales": 25000.00,
      "totalOrders": 125,
      "totalCommission": 3000.00,
      "newMembers": 45,
      "conversionRate": 0.36,
      "avgOrderAmount": 200.00
    },
    "team": {
      "teamSize": 67,
      "activeMembers": 52,
      "teamSales": 85000.00,
      "teamCommission": 4250.00
    },
    "trend": [
      {
        "date": "2026-01-01",
        "sales": 500.00,
        "orders": 3,
        "commission": 60.00,
        "newMembers": 2
      },
      {
        "date": "2026-01-02",
        "sales": 800.00,
        "orders": 4,
        "commission": 96.00,
        "newMembers": 3
      }
    ],
    "topProducts": [
      {
        "productId": "prod_001",
        "productName": "海蓝智能按摩器 Pro",
        "sales": 5000.00,
        "orders": 25,
        "commission": 600.00
      }
    ]
  }
}
```

#### 3.4 会员权益管理

##### 3.4.1 会员权益列表

| 权益类型 | 权益名称 | 适用等级 | 说明 | 使用限制 |
|----------|----------|----------|------|----------|
| 折扣优惠 | 购物折扣 | LV1-LV5 | 不同等级享受不同折扣 | 无限制 |
| 专属客服 | 在线客服 | LV1-LV5 | 专属客服通道 | 工作时间 |
| 优先发货 | 快速配送 | LV2-LV5 | 优先处理订单 | 无限制 |
| 生日礼包 | 生日礼物 | LV2-LV5 | 生日当月领取 | 每年一次 |
| 专属顾问 | 健康顾问 | LV3-LV5 | 1对1健康咨询 | 每月3次 |
| 免费换货 | 无理由换货 | LV3-LV5 | 7天内免费换货 | 每月2次 |
| VIP通道 | 专属通道 | LV4-LV5 | 专属客服通道 | 无限制 |
| 定制服务 | 个性化定制 | LV4-LV5 | 定制化服务 | 按需定制 |
| 专属管家 | 贴身管家 | LV5 | 全程管家服务 | 7x24小时 |
| 新品试用 | 免费试用 | LV5 | 新品优先试用 | 按活动规则 |

##### 3.4.2 会员权益API接口

**获取会员权益**

```http
GET /api/member/benefits
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| - | - | - | 无 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "userId": "user_123",
    "level": 3,
    "levelName": "金牌会员",
    "benefits": [
      {
        "id": "benefit_001",
        "type": "DISCOUNT",
        "name": "购物折扣",
        "description": "享受8.5折购物优惠",
        "value": "0.85",
        "unit": "折扣率",
        "available": true,
        "usageLimit": "无限制",
        "expiryDate": null
      },
      {
        "id": "benefit_002",
        "type": "SERVICE",
        "name": "专属顾问",
        "description": "1对1健康咨询服务",
        "value": "3",
        "unit": "次/月",
        "available": true,
        "usageLimit": "每月3次",
        "expiryDate": "2026-03-31",
        "usedCount": 1,
        "remainingCount": 2
      },
      {
        "id": "benefit_003",
        "type": "SERVICE",
        "name": "免费换货",
        "description": "7天内免费换货",
        "value": "2",
        "unit": "次/月",
        "available": true,
        "usageLimit": "每月2次",
        "expiryDate": "2026-02-29",
        "usedCount": 0,
        "remainingCount": 2
      }
    ]
  }
}
```

**使用会员权益**

```http
POST /api/member/benefits/use
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "benefitId": "benefit_002",
  "orderId": "order_123",
  "remark": "使用专属顾问权益"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "usageId": "usage_001",
    "benefitId": "benefit_002",
    "benefitName": "专属顾问",
    "userId": "user_123",
    "orderId": "order_123",
    "usedCount": 1,
    "remainingCount": 2,
    "usedAt": "2026-02-03T10:00:00Z"
  }
}
```

#### 3.5 分销关系管理

##### 3.5.1 分销关系结构

```
合伙人 (LV5)
├── 核心分销员 (LV4)
│   ├── 高级分销员 (LV3)
│   │   ├── 中级分销员 (LV2)
│   │   │   ├── 初级分销员 (LV1)
│   │   │   └── 初级分销员 (LV1)
│   │   └── 中级分销员 (LV2)
│   └── 高级分销员 (LV3)
└── 核心分销员 (LV4)
```

##### 3.5.2 分销关系API接口

**获取下级分销员列表**

```http
GET /api/distributor/team-members
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| level | number | 否 | 筛选等级 |
| status | string | 否 | 状态：ACTIVE/INACTIVE |
| page | number | 否 | 页码，默认1 |
| pageSize | number | 否 | 每页数量，默认20 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "total": 67,
    "page": 1,
    "pageSize": 20,
    "summary": {
      "totalMembers": 67,
      "activeMembers": 52,
      "inactiveMembers": 15,
      "totalSales": 85000.00,
      "totalCommission": 4250.00
    },
    "members": [
      {
        "distributorId": "dist_002",
        "userId": "user_456",
        "realName": "李四",
        "level": 2,
        "levelName": "中级分销员",
        "status": "ACTIVE",
        "totalSales": 8500.00,
        "totalOrders": 42,
        "totalCommission": 680.00,
        "teamSize": 15,
        "joinedAt": "2025-12-15T10:00:00Z",
        "lastActiveAt": "2026-02-02T14:30:00Z"
      },
      {
        "distributorId": "dist_003",
        "userId": "user_789",
        "realName": "王五",
        "level": 1,
        "levelName": "初级分销员",
        "status": "ACTIVE",
        "totalSales": 2500.00,
        "totalOrders": 12,
        "totalCommission": 125.00,
        "teamSize": 3,
        "joinedAt": "2026-01-10T08:00:00Z",
        "lastActiveAt": "2026-02-01T09:15:00Z"
      }
    ]
  }
}
```

**获取分销关系树**

```http
GET /api/distributor/team-tree
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| maxDepth | number | 否 | 最大深度，默认3 |
| - | - | - | 无 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "distributorId": "dist_001",
    "userId": "user_123",
    "realName": "张三",
    "level": 3,
    "levelName": "高级分销员",
    "totalTeamSize": 67,
    "totalTeamSales": 85000.00,
    "children": [
      {
        "distributorId": "dist_002",
        "userId": "user_456",
        "realName": "李四",
        "level": 2,
        "levelName": "中级分销员",
        "teamSize": 15,
        "teamSales": 8500.00,
        "children": [
          {
            "distributorId": "dist_004",
            "userId": "user_101",
            "realName": "赵六",
            "level": 1,
            "levelName": "初级分销员",
            "teamSize": 3,
            "teamSales": 2500.00,
            "children": []
          }
        ]
      }
    ]
  }
}
```

#### 3.6 安全与风控

##### 3.6.1 会员安全措施

```typescript
/**
 * 会员安全验证
 * @description 防止恶意刷分、虚假分销等行为
 */
import * as crypto from 'crypto';

/**
 * 生成签到唯一标识
 * @param userId 用户ID
 * @param date 签到日期
 * @returns 唯一标识
 */
function generateCheckInSignature(userId: string, date: string): string {
  const secret = process.env.CHECK_IN_SECRET;
  const data = `${userId}:${date}`;
  return crypto.createHmac('sha256', secret).update(data).digest('hex');
}

/**
 * 验证签到请求
 * @param userId 用户ID
 * @param date 签到日期
 * @param signature 签名
 * @returns 验证结果
 */
function verifyCheckInRequest(userId: string, date: string, signature: string): boolean {
  const expectedSignature = generateCheckInSignature(userId, date);
  return signature === expectedSignature;
}

/**
 * 检测异常积分获取行为
 * @param userId 用户ID
 * @param points 积分数量
 * @param type 获取类型
 * @returns 是否异常
 */
async function detectAbnormalPoints(userId: string, points: number, type: string): Promise<boolean> {
  const recentPoints = await getRecentPoints(userId, 24); // 24小时内
  const totalPoints = recentPoints.reduce((sum, p) => sum + p.amount, 0);
  
  // 检测规则
  if (type === 'EARN' && totalPoints > 1000) {
    return true; // 24小时内获取超过1000积分
  }
  
  if (type === 'CHECK_IN' && recentPoints.filter(p => p.type === 'CHECK_IN').length > 1) {
    return true; // 同一天多次签到
  }
  
  return false;
}

/**
 * 检测虚假分销行为
 * @param distributorId 分销员ID
 * @param buyerId 买家ID
 * @returns 是否虚假
 */
async function detectFakeDistribution(distributorId: string, buyerId: string): Promise<boolean> {
  // 检查IP地址
  const distributorIP = await getUserIP(distributorId);
  const buyerIP = await getUserIP(buyerId);
  
  if (distributorIP === buyerIP) {
    return true; // 相同IP，可能是自买自卖
  }
  
  // 检查设备指纹
  const distributorDevice = await getUserDevice(distributorId);
  const buyerDevice = await getUserDevice(buyerId);
  
  if (distributorDevice === buyerDevice) {
    return true; // 相同设备，可能是自买自卖
  }
  
  // 检查收货地址
  const distributorAddress = await getUserAddress(distributorId);
  const buyerAddress = await getUserAddress(buyerId);
  
  if (distributorAddress === buyerAddress) {
    return true; // 相同地址，可能是自买自卖
  }
  
  return false;
}
```

##### 3.6.2 分销风控规则

| 风控类型 | 检测规则 | 处理措施 |
|----------|----------|----------|
| 自买自卖 | 相同IP/设备/地址 | 冻结佣金，警告 |
| 刷单行为 | 短时间内大量订单 | 限制下单，人工审核 |
| 虚假推广 | 无真实推广行为 | 降低等级，取消资格 |
| 恶意邀请 | 邀请用户无活跃 | 取消邀请奖励 |
| 佣金异常 | 佣金比例异常 | 暂停结算，调查 |

#### 3.7 数据统计与报表

##### 3.7.1 会员数据统计

**会员增长趋势**

```http
GET /api/member/statistics/growth
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| startDate | string | 否 | 开始日期，格式：YYYY-MM-DD |
| endDate | string | 否 | 结束日期，格式：YYYY-MM-DD |
| granularity | string | 否 | 粒度：DAY/WEEK/MONTH，默认DAY |

**响应示例**

```json
{
  "success": true,
  "data": {
    "startDate": "2026-01-01",
    "endDate": "2026-01-31",
    "granularity": "DAY",
    "totalNewMembers": 1250,
    "totalActiveMembers": 8500,
    "growthRate": 0.15,
    "trend": [
      {
        "date": "2026-01-01",
        "newMembers": 35,
        "totalMembers": 7250,
        "activeMembers": 6800
      },
      {
        "date": "2026-01-02",
        "newMembers": 42,
        "totalMembers": 7292,
        "activeMembers": 6850
      }
    ]
  }
}
```

##### 3.7.2 分销数据统计

**分销业绩排行**

```http
GET /api/distributor/ranking
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| type | string | 否 | 排行类型：SALES/COMMISSION/TEAM_SIZE，默认SALES |
| period | string | 否 | 统计周期：WEEK/MONTH/YEAR/ALL，默认MONTH |
| limit | number | 否 | 返回数量，默认50 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "type": "SALES",
    "period": "MONTH",
    "startDate": "2026-01-01",
    "endDate": "2026-01-31",
    "ranking": [
      {
        "rank": 1,
        "distributorId": "dist_001",
        "realName": "张三",
        "avatar": "https://hailan.pro/avatar/dist_001.jpg",
        "level": 5,
        "levelName": "合伙人",
        "sales": 25000.00,
        "orders": 125,
        "commission": 5000.00,
        "teamSize": 67
      },
      {
        "rank": 2,
        "distributorId": "dist_002",
        "realName": "李四",
        "avatar": "https://hailan.pro/avatar/dist_002.jpg",
        "level": 4,
        "levelName": "核心分销员",
        "sales": 18500.00,
        "orders": 92,
        "commission": 2775.00,
        "teamSize": 45
      }
    ],
    "myRank": {
      "rank": 15,
      "sales": 5200.00,
      "orders": 26,
      "commission": 520.00
    }
  }
}
```

#### 3.8 通知与消息

##### 3.8.1 会员通知

**积分变动通知**

```typescript
/**
 * 积分变动通知
 * @description 当用户积分发生变动时发送通知
 */
interface PointsNotification {
  userId: string;
  type: 'EARN' | 'SPEND' | 'EXPIRE';
  amount: number;
  balance: number;
  description: string;
  source?: string;
}

async function sendPointsNotification(notification: PointsNotification) {
  const { userId, type, amount, balance, description, source } = notification;
  
  const title = type === 'EARN' ? '积分到账通知' : 
                type === 'SPEND' ? '积分消费通知' : '积分过期通知';
  
  const content = type === 'EARN' ? 
    `恭喜您获得${amount}积分，当前积分余额：${balance}分。${description}` :
    type === 'SPEND' ?
    `您消费了${Math.abs(amount)}积分，当前积分余额：${balance}分。${description}` :
    `您的${Math.abs(amount)}积分已过期，当前积分余额：${balance}分。`;
  
  // 发送站内消息
  await sendInboxMessage(userId, {
    type: 'POINTS',
    title,
    content,
    data: { amount, balance, type, source }
  });
  
  // 发送推送通知
  await sendPushNotification(userId, {
    title,
    body: content,
    data: { type: 'POINTS_CHANGE' }
  });
}
```

##### 3.8.2 分销通知

**佣金到账通知**

```typescript
/**
 * 佣金到账通知
 * @description 当分销员佣金到账时发送通知
 */
interface CommissionNotification {
  distributorId: string;
  type: 'DIRECT' | 'TEAM';
  amount: number;
  balance: number;
  orderId: string;
  orderAmount: number;
  commissionRate: number;
}

async function sendCommissionNotification(notification: CommissionNotification) {
  const { distributorId, type, amount, balance, orderId, orderAmount, commissionRate } = notification;
  
  const title = '佣金到账通知';
  const content = type === 'DIRECT' ?
    `恭喜您获得直接佣金${amount.toFixed(2)}元（订单金额：${orderAmount.toFixed(2)}元，佣金比例：${(commissionRate * 100).toFixed(0)}%），当前佣金余额：${balance.toFixed(2)}元。` :
    `恭喜您获得团队佣金${amount.toFixed(2)}元，当前佣金余额：${balance.toFixed(2)}元。`;
  
  // 发送站内消息
  await sendInboxMessage(distributorId, {
    type: 'COMMISSION',
    title,
    content,
    data: { amount, balance, type, orderId }
  });
  
  // 发送推送通知
  await sendPushNotification(distributorId, {
    title,
    body: content,
    data: { type: 'COMMISSION_RECEIVED' }
  });
}
```

#### 3.9 最佳实践

##### 3.9.1 会员运营建议

1. **个性化推荐**
   - 根据会员等级和购买历史推荐商品
   - 生日前推送专属优惠
   - 节假日发送个性化祝福和优惠

2. **积分激励**
   - 设计多样化的积分获取方式
   - 定期举办积分翻倍活动
   - 设置积分兑换专属商品

3. **会员关怀**
   - 定期发送会员权益提醒
   - 会员等级即将过期时发送提醒
   - 提供专属客服支持

##### 3.9.2 分销运营建议

1. **分销员培训**
   - 提供产品知识和销售技巧培训
   - 分享成功案例和经验
   - 定期举办分销员大会

2. **激励政策**
   - 设置分销员排行榜和奖励
   - 提供晋升通道和股权激励
   - 举办分销员专属活动

3. **工具支持**
   - 提供分销员管理后台
   - 开发分销员移动端APP
   - 提供数据分析和报表工具

#### 3.10 常见问题

##### 3.10.1 会员相关

**Q: 积分有有效期吗？**
A: 积分有效期为1年，自获得之日起计算。过期未使用的积分将自动失效。

**Q: 如何提升会员等级？**
A: 通过购物消费和获取积分可以提升会员等级。系统会根据累计消费金额和积分自动计算会员等级。

**Q: 会员等级会降级吗？**
A: 会员等级有效期1年，到期后根据过去1年的消费金额和积分重新计算等级。

**Q: 会员权益可以转让吗？**
A: 会员权益仅限本人使用，不可转让给他人。

##### 3.10.2 分销相关

**Q: 如何成为分销员？**
A: 在个人中心申请成为分销员，提交真实身份信息，审核通过后即可开始推广。

**Q: 佣金多久结算一次？**
A: 佣金每月结算一次，每月10日结算上月佣金。

**Q: 佣金提现有最低金额限制吗？**
A: 佣金提现最低金额为100元，低于100元无法提现。

**Q: 分销员会被取消资格吗？**
A: 分销员如有违规行为（如自买自卖、刷单等），将被取消分销员资格，并冻结未结算佣金。

---

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

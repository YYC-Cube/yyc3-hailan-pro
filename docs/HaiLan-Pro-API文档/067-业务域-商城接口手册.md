---
@file: 067-业务域-商城接口手册.md
@description: HaiLan Pro 商城相关接口的详细定义，包含商品、购物车、订单、支付等
@author: YanYuCloudCube Team
@version: v1.0.0
@created: 2026-02-03
@updated: 2026-02-03
@status: published
@tags: [API接口],[业务域],[商城]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 067 业务域-商城接口手册

## 概述

本文档详细描述HaiLan Pro项目商城相关接口的详细定义，包含商品、购物车、订单、支付等，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范商城接口的定义和使用
- 为前后端开发人员提供清晰的接口文档
- 保障接口的一致性和可维护性

### 2. 接口列表

| 接口名称 | HTTP方法 | 路径 | 认证要求 |
|---------|---------|------|---------|
| 获取商品列表 | GET | /api/v1.0/products | 公开 |
| 获取商品详情 | GET | /api/v1.0/products/{productId} | 公开 |
| 搜索商品 | GET | /api/v1.0/products/search | 公开 |
| 获取商品分类 | GET | /api/v1.0/categories | 公开 |
| 获取购物车 | GET | /api/v1.0/cart | JWT Token |
| 添加到购物车 | POST | /api/v1.0/cart/items | JWT Token |
| 更新购物车商品 | PUT | /api/v1.0/cart/items/{itemId} | JWT Token |
| 删除购物车商品 | DELETE | /api/v1.0/cart/items/{itemId} | JWT Token |
| 清空购物车 | DELETE | /api/v1.0/cart | JWT Token |
| 创建订单 | POST | /api/v1.0/orders | JWT Token |
| 获取订单列表 | GET | /api/v1.0/orders | JWT Token |
| 获取订单详情 | GET | /api/v1.0/orders/{orderId} | JWT Token |
| 取消订单 | POST | /api/v1.0/orders/{orderId}/cancel | JWT Token |
| 确认收货 | POST | /api/v1.0/orders/{orderId}/confirm | JWT Token |
| 申请退款 | POST | /api/v1.0/orders/{orderId}/refund | JWT Token |
| 创建支付 | POST | /api/v1.0/payments | JWT Token |
| 查询支付状态 | GET | /api/v1.0/payments/{paymentId} | JWT Token |
| 获取收货地址列表 | GET | /api/v1.0/addresses | JWT Token |
| 添加收货地址 | POST | /api/v1.0/addresses | JWT Token |
| 更新收货地址 | PUT | /api/v1.0/addresses/{addressId} | JWT Token |
| 删除收货地址 | DELETE | /api/v1.0/addresses/{addressId} | JWT Token |

### 3. 接口详情

#### 3.1 获取商品列表

##### 3.1.1 接口定义
```
GET /api/v1.0/products
```

##### 3.1.2 查询参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| page | number | 否 | 页码 | 1 |
| pageSize | number | 否 | 每页数量 | 20 |
| categoryId | string | 否 | 分类ID | cat-123 |
| sortBy | string | 否 | 排序方式 | price_asc/price_desc/sales |
| minPrice | number | 否 | 最低价格 | 0 |
| maxPrice | number | 否 | 最高价格 | 1000 |

##### 3.1.3 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 100,
    "page": 1,
    "pageSize": 20,
    "products": [
      {
        "productId": "prod-123",
        "name": "海蓝智能按摩器",
        "description": "医疗级标准，智能控制",
        "price": 299.00,
        "originalPrice": 399.00,
        "stock": 100,
        "sales": 500,
        "images": [
          "https://cdn.hailan.com/products/prod-123-1.jpg"
        ],
        "categoryId": "cat-123",
        "tags": ["热销", "新品"],
        "createdAt": "2026-01-01T00:00:00.000Z"
      }
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.1.4 错误码
| 错误码 | 说明 |
|-------|------|
| 1003 | 必填参数为空 |
| 2400 | 商品不存在 |

#### 3.2 获取商品详情

##### 3.2.1 接口定义
```
GET /api/v1.0/products/{productId}
```

##### 3.2.2 路径参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| productId | string | 是 | 商品ID | prod-123 |

##### 3.2.3 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "productId": "prod-123",
    "name": "海蓝智能按摩器",
    "description": "医疗级标准，智能控制，支持APP远程控制",
    "price": 299.00,
    "originalPrice": 399.00,
    "stock": 100,
    "sales": 500,
    "images": [
      "https://cdn.hailan.com/products/prod-123-1.jpg",
      "https://cdn.hailan.com/products/prod-123-2.jpg"
    ],
    "categoryId": "cat-123",
    "categoryName": "智能设备",
    "tags": ["热销", "新品"],
    "specifications": {
      "材质": "医用硅胶",
      "尺寸": "15cm x 8cm",
      "电池": "锂电池",
      "充电时间": "2小时"
    },
    "reviews": {
      "average": 4.8,
      "count": 120
    },
    "createdAt": "2026-01-01T00:00:00.000Z",
    "updatedAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.2.4 错误码
| 错误码 | 说明 |
|-------|------|
| 2400 | 商品不存在 |

#### 3.3 获取购物车

##### 3.3.1 接口定义
```
GET /api/v1.0/cart
```

##### 3.3.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.3.3 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "cartId": "cart-123",
    "totalPrice": 598.00,
    "totalQuantity": 2,
    "items": [
      {
        "itemId": "item-123",
        "productId": "prod-123",
        "productName": "海蓝智能按摩器",
        "productImage": "https://cdn.hailan.com/products/prod-123-1.jpg",
        "price": 299.00,
        "quantity": 2,
        "stock": 100
      }
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.3.4 错误码
| 错误码 | 说明 |
|-------|------|
| 1121 | Token已过期 |

#### 3.4 添加到购物车

##### 3.4.1 接口定义
```
POST /api/v1.0/cart/items
```

##### 3.4.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.4.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| productId | string | 是 | 商品ID | prod-123 |
| quantity | number | 是 | 数量 | 1 |

##### 3.4.4 请求示例
```json
{
  "productId": "prod-123",
  "quantity": 1
}
```

##### 3.4.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "添加成功",
  "data": {
    "itemId": "item-123",
    "productId": "prod-123",
    "quantity": 1
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.4.6 错误码
| 错误码 | 说明 |
|-------|------|
| 2400 | 商品不存在 |
| 2401 | 库存不足 |
| 1121 | Token已过期 |

#### 3.5 创建订单

##### 3.5.1 接口定义
```
POST /api/v1.0/orders
```

##### 3.5.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.5.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| items | array | 是 | 商品列表 | 见下方 |
| addressId | string | 是 | 收货地址ID | addr-123 |
| remark | string | 否 | 订单备注 | 请尽快发货 |
| couponId | string | 否 | 优惠券ID | coupon-123 |

##### 3.5.4 请求示例
```json
{
  "items": [
    {
      "productId": "prod-123",
      "quantity": 2
    }
  ],
  "addressId": "addr-123",
  "remark": "请尽快发货",
  "couponId": "coupon-123"
}
```

##### 3.5.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "订单创建成功",
  "data": {
    "orderId": "order-123",
    "orderNo": "HL20260203100001",
    "totalPrice": 598.00,
    "discount": 50.00,
    "actualPrice": 548.00,
    "status": "PENDING_PAYMENT",
    "paymentId": "pay-123",
    "createdAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.5.6 错误码
| 错误码 | 说明 |
|-------|------|
| 2400 | 商品不存在 |
| 2401 | 库存不足 |
| 2500 | 收货地址不存在 |
| 2600 | 优惠券不可用 |
| 1121 | Token已过期 |

#### 3.6 获取订单列表

##### 3.6.1 接口定义
```
GET /api/v1.0/orders
```

##### 3.6.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.6.3 查询参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| page | number | 否 | 页码 | 1 |
| pageSize | number | 否 | 每页数量 | 20 |
| status | string | 否 | 订单状态 | PENDING_PAYMENT/PAID/SHIPPED/COMPLETED/CANCELLED |

##### 3.6.4 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "total": 10,
    "page": 1,
    "pageSize": 20,
    "orders": [
      {
        "orderId": "order-123",
        "orderNo": "HL20260203100001",
        "totalPrice": 598.00,
        "actualPrice": 548.00,
        "status": "PAID",
        "statusText": "已支付",
        "createdAt": "2026-02-03T10:00:00.000Z",
        "items": [
          {
            "productId": "prod-123",
            "productName": "海蓝智能按摩器",
            "productImage": "https://cdn.hailan.com/products/prod-123-1.jpg",
            "price": 299.00,
            "quantity": 2
          }
        ]
      }
    ]
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.6.5 错误码
| 错误码 | 说明 |
|-------|------|
| 1121 | Token已过期 |

#### 3.7 创建支付

##### 3.7.1 接口定义
```
POST /api/v1.0/payments
```

##### 3.7.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.7.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| orderId | string | 是 | 订单ID | order-123 |
| paymentMethod | string | 是 | 支付方式 | WECHAT/ALIPAY/BANK_CARD |
| returnUrl | string | 否 | 支付成功回调URL | https://hailan.com/payment/success |

##### 3.7.4 请求示例
```json
{
  "orderId": "order-123",
  "paymentMethod": "WECHAT",
  "returnUrl": "https://hailan.com/payment/success"
}
```

##### 3.7.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "支付创建成功",
  "data": {
    "paymentId": "pay-123",
    "paymentUrl": "https://pay.hailan.com/pay/xxx",
    "qrCode": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
    "expiresAt": "2026-02-03T10:30:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.7.6 错误码
| 错误码 | 说明 |
|-------|------|
| 2700 | 订单不存在 |
| 2701 | 订单状态异常 |
| 2702 | 支付方式不支持 |
| 1121 | Token已过期 |

#### 3.8 获取收货地址列表

##### 3.8.1 接口定义
```
GET /api/v1.0/addresses
```

##### 3.8.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.8.3 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": [
    {
      "addressId": "addr-123",
      "receiverName": "张三",
      "receiverPhone": "138****8000",
      "province": "广东省",
      "city": "深圳市",
      "district": "南山区",
      "detail": "科技园南区1001号",
      "isDefault": true,
      "createdAt": "2026-01-01T00:00:00.000Z"
    }
  ],
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.8.4 错误码
| 错误码 | 说明 |
|-------|------|
| 1121 | Token已过期 |

#### 3.9 添加收货地址

##### 3.9.1 接口定义
```
POST /api/v1.0/addresses
```

##### 3.9.2 请求头
```http
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...
```

##### 3.9.3 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|-------|------|------|------|------|
| receiverName | string | 是 | 收货人姓名 | 张三 |
| receiverPhone | string | 是 | 收货人手机号 | 13800138000 |
| province | string | 是 | 省份 | 广东省 |
| city | string | 是 | 城市 | 深圳市 |
| district | string | 是 | 区县 | 南山区 |
| detail | string | 是 | 详细地址 | 科技园南区1001号 |
| isDefault | boolean | 否 | 是否默认地址 | false |

##### 3.9.4 请求示例
```json
{
  "receiverName": "张三",
  "receiverPhone": "13800138000",
  "province": "广东省",
  "city": "深圳市",
  "district": "南山区",
  "detail": "科技园南区1001号",
  "isDefault": false
}
```

##### 3.9.5 成功响应
```json
{
  "success": true,
  "code": 200,
  "message": "添加成功",
  "data": {
    "addressId": "addr-123",
    "receiverName": "张三",
    "receiverPhone": "138****8000",
    "province": "广东省",
    "city": "深圳市",
    "district": "南山区",
    "detail": "科技园南区1001号",
    "isDefault": false,
    "createdAt": "2026-02-03T10:00:00.000Z"
  },
  "timestamp": "2026-02-03T10:00:00.000Z",
  "requestId": "550e8400-e29b-41d4-a716-446655440001"
}
```

##### 3.9.6 错误码
| 错误码 | 说明 |
|-------|------|
| 1102 | 手机号格式错误 |
| 1121 | Token已过期 |

### 4. 数据模型

#### 4.1 商品模型

```typescript
interface Product {
  productId: string;
  name: string;
  description: string;
  price: number;
  originalPrice?: number;
  stock: number;
  sales: number;
  images: string[];
  categoryId: string;
  categoryName?: string;
  tags: string[];
  specifications?: Record<string, any>;
  reviews?: {
    average: number;
    count: number;
  };
  createdAt: string;
  updatedAt: string;
}
```

#### 4.2 订单模型

```typescript
interface Order {
  orderId: string;
  orderNo: string;
  totalPrice: number;
  discount?: number;
  actualPrice: number;
  status: 'PENDING_PAYMENT' | 'PAID' | 'SHIPPED' | 'COMPLETED' | 'CANCELLED';
  statusText: string;
  items: OrderItem[];
  address?: Address;
  createdAt: string;
  updatedAt: string;
}

interface OrderItem {
  productId: string;
  productName: string;
  productImage: string;
  price: number;
  quantity: number;
}
```

#### 4.3 购物车模型

```typescript
interface Cart {
  cartId: string;
  totalPrice: number;
  totalQuantity: number;
  items: CartItem[];
}

interface CartItem {
  itemId: string;
  productId: string;
  productName: string;
  productImage: string;
  price: number;
  quantity: number;
  stock: number;
}
```

### 5. 最佳实践

#### 5.1 前端实现

##### 5.1.1 购物车数量更新
```typescript
// 防抖处理，避免频繁请求
const debouncedUpdateCart = debounce(async (itemId, quantity) => {
  await updateCartItem(itemId, { quantity });
}, 500);
```

##### 5.1.2 订单状态轮询
```typescript
// 支付完成后轮询订单状态
const pollOrderStatus = async (orderId) => {
  const interval = setInterval(async () => {
    const order = await getOrderDetail(orderId);
    if (order.status !== 'PENDING_PAYMENT') {
      clearInterval(interval);
      return order;
    }
  }, 2000);
};
```

#### 5.2 后端实现

##### 5.2.1 库存扣减
```typescript
// 使用数据库事务确保库存一致性
async function createOrder(userId, orderData) {
  return await prisma.$transaction(async (tx) => {
    // 检查库存
    for (const item of orderData.items) {
      const product = await tx.product.findUnique({
        where: { productId: item.productId }
      });
      if (product.stock < item.quantity) {
        throw new Error('库存不足');
      }
    }
    
    // 扣减库存
    for (const item of orderData.items) {
      await tx.product.update({
        where: { productId: item.productId },
        data: { stock: { decrement: item.quantity } }
      });
    }
    
    // 创建订单
    return await tx.order.create({ data: orderData });
  });
}
```

##### 5.2.2 价格计算
```typescript
// 统一价格计算服务
class PriceCalculator {
  calculateTotal(items, coupon) {
    let total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
    
    if (coupon) {
      total = this.applyCoupon(total, coupon);
    }
    
    return total;
  }
  
  applyCoupon(total, coupon) {
    if (coupon.type === 'PERCENTAGE') {
      return total * (1 - coupon.value / 100);
    } else if (coupon.type === 'FIXED') {
      return Math.max(0, total - coupon.value);
    }
    return total;
  }
}
```

### 6. 安全注意事项

#### 6.1 价格安全
- 前端显示价格仅供参考
- 最终价格以服务器计算为准
- 禁止客户端修改商品价格
- 支持价格异常监控

#### 6.2 库存安全
- 使用数据库事务保证一致性
- 实现库存预占机制
- 超时自动释放预占库存
- 支持库存预警

#### 6.3 隐私保护
- 收货地址信息脱敏显示
- 不在日志中记录完整地址
- 支持匿名购买
- 伪装发货保护用户隐私

## 附录

### A. 参考文档

- RESTful接口设计标准
- 接口错误码体系
- 接口签名鉴权手册
- YYC³项目规范文档

### B. 术语表

- SKU：Stock Keeping Unit（库存量单位）
- PWA：Progressive Web App
- JWT：JSON Web Token

---

<div align="center">

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

</div>

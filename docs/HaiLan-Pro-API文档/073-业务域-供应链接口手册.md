---
file: 073-业务域-供应链接口手册.md
description: HaiLan Pro 供应链管理相关接口的详细定义，包含库存、发货、O2O等
author: YanYuCloudCube Team
version: v1.0.0
created: 2026-01-26
updated: 2026-01-26
status: published
tags:
  - HaiLan-Pro-API文档,[]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 073 业务域-供应链接口手册

## 概述

本文档详细描述HaiLan Pro-HaiLan-Pro-API文档-业务域-供应链接口手册相关内容，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范业务域-供应链接口手册相关的业务标准与技术落地要求
- 为项目相关人员提供清晰的参考依据
- 保障相关模块开发、实施、运维的一致性与规范性

### 2. 设计原则

#### 2.1 五高原则
- **高可用性**：确保系统7x24小时稳定运行，支持PWA离线能力
- **高性能**：优化响应时间和处理能力，支持高并发访问
- **高安全性**：保护用户数据和隐私安全，双重加密机制
- **高扩展性**：支持业务快速扩展，微服务架构设计
- **高可维护性**：便于后续维护和升级，模块化设计

#### 2.2 五标体系
- **标准化**：统一的技术和流程标准
- **规范化**：严格的开发和管理规范
- **自动化**：提高开发效率和质量，CI/CD自动化
- **智能化**：利用AI技术提升能力，LLM智能顾问
- **可视化**：直观的监控和管理界面

#### 2.3 五化架构
- **流程化**：标准化的开发流程
- **文档化**：完善的文档体系
- **工具化**：高效的开发工具链
- **数字化**：数据驱动的决策
- **生态化**：开放的生态系统

### 3. 业务域-供应链接口手册

#### 3.1 库存管理系统

##### 3.1.1 库存类型定义

HaiLan Pro采用多层级库存管理体系，确保库存数据的准确性和实时性。

| 库存类型 | 类型代码 | 说明 | 更新频率 | 安全库存 |
|----------|----------|------|----------|----------|
| 总仓库存 | WAREHOUSE | 中心仓库库存 | 实时 | 100件 |
| 门店库存 | STORE | 线下门店库存 | 每小时 | 20件 |
| 虚拟库存 | VIRTUAL | 预售/预售库存 | 实时 | 0件 |
| 在途库存 | TRANSIT | 运输中库存 | 每日 | 0件 |
| 冻结库存 | FROZEN | 订单锁定库存 | 实时 | 0件 |

##### 3.1.2 库存同步机制

```typescript
/**
 * 库存同步机制
 * @description 确保多层级库存数据的一致性和实时性
 */
interface InventorySync {
  productId: string;
  warehouseId: string;
  storeId?: string;
  quantity: number;
  frozenQuantity: number;
  availableQuantity: number;
  lastSyncTime: Date;
  syncStatus: 'SYNCED' | 'PENDING' | 'FAILED';
}

/**
 * 库存同步服务
 */
class InventorySyncService {
  /**
   * 同步库存到总仓
   * @param productId 商品ID
   * @param quantity 变更数量
   * @param operation 操作类型：ADD/REDUCE/FREEZE/UNFREEZE
   */
  async syncToWarehouse(productId: string, quantity: number, operation: string) {
    const inventory = await this.getWarehouseInventory(productId);
    
    switch (operation) {
      case 'ADD':
        inventory.quantity += quantity;
        inventory.availableQuantity += quantity;
        break;
      case 'REDUCE':
        if (inventory.availableQuantity < quantity) {
          throw new Error('库存不足');
        }
        inventory.quantity -= quantity;
        inventory.availableQuantity -= quantity;
        break;
      case 'FREEZE':
        if (inventory.availableQuantity < quantity) {
          throw new Error('可用库存不足');
        }
        inventory.frozenQuantity += quantity;
        inventory.availableQuantity -= quantity;
        break;
      case 'UNFREEZE':
        inventory.frozenQuantity -= quantity;
        inventory.availableQuantity += quantity;
        break;
    }
    
    inventory.lastSyncTime = new Date();
    inventory.syncStatus = 'SYNCED';
    
    await this.updateWarehouseInventory(inventory);
    
    // 同步到门店
    await this.syncToStores(productId, inventory);
    
    return inventory;
  }
  
  /**
   * 同步库存到门店
   * @param productId 商品ID
   * @param warehouseInventory 总仓库存
   */
  async syncToStores(productId: string, warehouseInventory: InventorySync) {
    const stores = await this.getActiveStores();
    
    for (const store of stores) {
      const storeInventory = await this.getStoreInventory(productId, store.id);
      
      // 根据门店销量分配库存
      const allocationRatio = await this.calculateAllocationRatio(store.id);
      const allocatedQuantity = Math.floor(warehouseInventory.availableQuantity * allocationRatio);
      
      storeInventory.quantity = allocatedQuantity;
      storeInventory.availableQuantity = allocatedQuantity;
      storeInventory.lastSyncTime = new Date();
      storeInventory.syncStatus = 'SYNCED';
      
      await this.updateStoreInventory(storeInventory);
    }
  }
  
  /**
   * 计算门店库存分配比例
   * @param storeId 门店ID
   * @returns 分配比例
   */
  async calculateAllocationRatio(storeId: string): Promise<number> {
    const totalSales = await this.getTotalSales();
    const storeSales = await this.getStoreSales(storeId);
    
    return storeSales / totalSales;
  }
}
```

##### 3.1.3 库存API接口

**查询商品库存**

```http
GET /api/supply/inventory/product/{productId}
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| productId | string | 是 | 商品ID（路径参数） |
| location | string | 否 | 库存位置：WAREHOUSE/STORE/ALL，默认ALL |

**响应示例**

```json
{
  "success": true,
  "data": {
    "productId": "prod_001",
    "productName": "海蓝智能按摩器 Pro",
    "inventory": [
      {
        "location": "WAREHOUSE",
        "warehouseId": "wh_001",
        "warehouseName": "北京总仓",
        "quantity": 500,
        "frozenQuantity": 50,
        "availableQuantity": 450,
        "safeStock": 100,
        "status": "NORMAL",
        "lastSyncTime": "2026-02-03T10:00:00Z"
      },
      {
        "location": "STORE",
        "storeId": "store_001",
        "storeName": "北京朝阳门店",
        "quantity": 30,
        "frozenQuantity": 5,
        "availableQuantity": 25,
        "safeStock": 20,
        "status": "LOW",
        "lastSyncTime": "2026-02-03T09:30:00Z"
      }
    ],
    "totalQuantity": 530,
    "totalAvailableQuantity": 475,
    "totalFrozenQuantity": 55
  }
}
```

**批量查询库存**

```http
POST /api/supply/inventory/batch
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "productIds": ["prod_001", "prod_002", "prod_003"],
  "location": "ALL"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "inventories": [
      {
        "productId": "prod_001",
        "productName": "海蓝智能按摩器 Pro",
        "totalQuantity": 530,
        "availableQuantity": 475,
        "status": "NORMAL"
      },
      {
        "productId": "prod_002",
        "productName": "海蓝智能戒指",
        "totalQuantity": 200,
        "availableQuantity": 180,
        "status": "NORMAL"
      },
      {
        "productId": "prod_003",
        "productName": "海蓝智能手环",
        "totalQuantity": 15,
        "availableQuantity": 10,
        "status": "LOW"
      }
    ]
  }
}
```

**库存预警设置**

```http
POST /api/supply/inventory/alert
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "productId": "prod_001",
  "warehouseId": "wh_001",
  "safeStock": 100,
  "lowStockThreshold": 50,
  "outOfStockThreshold": 10,
  "alertEmail": "inventory@hailan.pro",
  "alertPhone": "13800138000"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "alertId": "alert_001",
    "productId": "prod_001",
    "productName": "海蓝智能按摩器 Pro",
    "warehouseId": "wh_001",
    "warehouseName": "北京总仓",
    "safeStock": 100,
    "lowStockThreshold": 50,
    "outOfStockThreshold": 10,
    "currentQuantity": 450,
    "status": "NORMAL",
    "createdAt": "2026-02-03T10:00:00Z"
  }
}
```

#### 3.2 发货管理系统

##### 3.2.1 发货流程

```
订单创建 → 库存锁定 → 拣货 → 打包 → 称重 → 面单打印 → 发货 → 物流跟踪 → 签收
```

##### 3.2.2 发货规则

| 发货类型 | 发货时效 | 配送范围 | 运费标准 | 备注 |
|----------|----------|----------|----------|------|
| 普通快递 | 2-3天 | 全国 | 满99元包邮，否则10元 | 默认发货方式 |
| 顺丰速运 | 1-2天 | 全国 | 满199元包邮，否则15元 | 优先发货 |
| 门店自提 | 即时 | 门店周边 | 免费 | 需到店自提 |
| O2O配送 | 2小时 | 3公里内 | 满299元包邮，否则20元 | 同城配送 |
| 伪装发货 | 3-5天 | 全国 | 满199元包邮，否则15元 | 隐私保护 |

##### 3.2.3 发货API接口

**创建发货单**

```http
POST /api/supply/shipping/create
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "orderId": "order_123",
  "shippingType": "STANDARD",
  "shippingAddress": {
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "province": "北京市",
    "city": "北京市",
    "district": "朝阳区",
    "address": "建国路88号",
    "postalCode": "100020"
  },
  "isDisguised": true,
  "disguiseName": "日用品",
  "remark": "请尽快发货"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "shippingId": "ship_001",
    "orderId": "order_123",
    "shippingNo": "HL2026020300001",
    "shippingType": "STANDARD",
    "shippingStatus": "PENDING",
    "estimatedDeliveryDate": "2026-02-06",
    "shippingAddress": {
      "receiverName": "张三",
      "receiverPhone": "138***800",
      "fullAddress": "北京市北京市朝阳区建国路88号"
    },
    "isDisguised": true,
    "disguiseName": "日用品",
    "createdAt": "2026-02-03T10:00:00Z"
  }
}
```

**更新物流信息**

```http
PUT /api/supply/shipping/tracking
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "shippingId": "ship_001",
  "logisticsCompany": "SF",
  "trackingNo": "SF1234567890",
  "trackingStatus": "SHIPPED",
  "trackingInfo": [
    {
      "time": "2026-02-03T14:00:00Z",
      "status": "已揽收",
      "location": "北京市朝阳区营业部"
    },
    {
      "time": "2026-02-03T18:00:00Z",
      "status": "运输中",
      "location": "北京转运中心"
    }
  ]
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "shippingId": "ship_001",
    "trackingNo": "SF1234567890",
    "logisticsCompany": "SF",
    "trackingStatus": "SHIPPED",
    "estimatedDeliveryDate": "2026-02-05",
    "lastUpdate": "2026-02-03T18:00:00Z",
    "trackingInfo": [
      {
        "time": "2026-02-03T14:00:00Z",
        "status": "已揽收",
        "location": "北京市朝阳区营业部"
      },
      {
        "time": "2026-02-03T18:00:00Z",
        "status": "运输中",
        "location": "北京转运中心"
      }
    ]
  }
}
```

**查询物流信息**

```http
GET /api/supply/shipping/tracking/{shippingId}
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| shippingId | string | 是 | 发货单ID（路径参数） |

**响应示例**

```json
{
  "success": true,
  "data": {
    "shippingId": "ship_001",
    "orderId": "order_123",
    "shippingNo": "HL2026020300001",
    "logisticsCompany": "SF",
    "trackingNo": "SF1234567890",
    "trackingStatus": "DELIVERED",
    "estimatedDeliveryDate": "2026-02-05",
    "actualDeliveryDate": "2026-02-05T10:30:00Z",
    "trackingInfo": [
      {
        "time": "2026-02-03T14:00:00Z",
        "status": "已揽收",
        "location": "北京市朝阳区营业部"
      },
      {
        "time": "2026-02-03T18:00:00Z",
        "status": "运输中",
        "location": "北京转运中心"
      },
      {
        "time": "2026-02-04T08:00:00Z",
        "status": "派送中",
        "location": "上海市浦东新区营业部"
      },
      {
        "time": "2026-02-05T10:30:00Z",
        "status": "已签收",
        "location": "上海市浦东新区"
      }
    ]
  }
}
```

#### 3.3 O2O服务管理

##### 3.3.1 O2O服务类型

| 服务类型 | 服务代码 | 服务范围 | 配送时效 | 服务费用 |
|----------|----------|----------|----------|----------|
| 即时配送 | INSTANT | 3公里内 | 2小时 | 满299元包邮，否则20元 |
| 当日达 | SAME_DAY | 10公里内 | 当日18点前 | 满199元包邮，否则15元 |
| 次日达 | NEXT_DAY | 20公里内 | 次日12点前 | 满99元包邮，否则10元 |
| 门店自提 | PICKUP | 门店周边 | 即时 | 免费 |

##### 3.3.2 O2O服务API接口

**查询O2O服务可用性**

```http
GET /api/supply/o2o/availability
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| latitude | number | 是 | 纬度 |
| longitude | number | 是 | 经度 |
| serviceType | string | 否 | 服务类型：INSTANT/SAME_DAY/NEXT_DAY/PICKUP，默认ALL |

**响应示例**

```json
{
  "success": true,
  "data": {
    "location": {
      "latitude": 39.9042,
      "longitude": 116.4074,
      "address": "北京市东城区"
    },
    "services": [
      {
        "serviceType": "INSTANT",
        "serviceName": "即时配送",
        "available": true,
        "estimatedDeliveryTime": "2小时",
        "deliveryFee": 20.00,
        "freeDeliveryThreshold": 299.00,
        "stores": [
          {
            "storeId": "store_001",
            "storeName": "北京朝阳门店",
            "distance": 1.5,
            "address": "北京市朝阳区建国路88号",
            "phone": "010-12345678"
          }
        ]
      },
      {
        "serviceType": "SAME_DAY",
        "serviceName": "当日达",
        "available": true,
        "estimatedDeliveryTime": "今日18:00前",
        "deliveryFee": 15.00,
        "freeDeliveryThreshold": 199.00,
        "stores": [
          {
            "storeId": "store_002",
            "storeName": "北京东城门店",
            "distance": 3.2,
            "address": "北京市东城区王府井大街1号",
            "phone": "010-87654321"
          }
        ]
      },
      {
        "serviceType": "PICKUP",
        "serviceName": "门店自提",
        "available": true,
        "estimatedPickupTime": "30分钟",
        "deliveryFee": 0.00,
        "stores": [
          {
            "storeId": "store_001",
            "storeName": "北京朝阳门店",
            "distance": 1.5,
            "address": "北京市朝阳区建国路88号",
            "phone": "010-12345678",
            "businessHours": "09:00-21:00"
          }
        ]
      }
    ]
  }
}
```

**创建O2O订单**

```http
POST /api/supply/o2o/order
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "orderId": "order_123",
  "serviceType": "INSTANT",
  "storeId": "store_001",
  "deliveryTime": "2026-02-03T12:00:00Z",
  "deliveryAddress": {
    "receiverName": "张三",
    "receiverPhone": "13800138000",
    "latitude": 39.9042,
    "longitude": 116.4074,
    "address": "北京市东城区王府井大街1号",
    "remark": "请按门铃"
  },
  "items": [
    {
      "productId": "prod_001",
      "productName": "海蓝智能按摩器 Pro",
      "quantity": 1,
      "price": 299.00
    }
  ]
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "o2oOrderId": "o2o_001",
    "orderId": "order_123",
    "serviceType": "INSTANT",
    "storeId": "store_001",
    "storeName": "北京朝阳门店",
    "storePhone": "010-12345678",
    "deliveryStatus": "PENDING",
    "estimatedDeliveryTime": "2026-02-03T12:00:00Z",
    "deliveryFee": 20.00,
    "deliveryAddress": {
      "receiverName": "张三",
      "receiverPhone": "138***800",
      "address": "北京市东城区王府井大街1号"
    },
    "rider": null,
    "createdAt": "2026-02-03T10:00:00Z"
  }
}
```

**更新O2O订单状态**

```http
PUT /api/supply/o2o/status
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "o2oOrderId": "o2o_001",
  "deliveryStatus": "DELIVERING",
  "rider": {
    "riderId": "rider_001",
    "riderName": "李四",
    "riderPhone": "13900139000",
    "riderAvatar": "https://hailan.pro/avatar/rider_001.jpg"
  },
  "location": {
    "latitude": 39.9042,
    "longitude": 116.4074
  },
  "remark": "骑手已接单，正在配送中"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "o2oOrderId": "o2o_001",
    "deliveryStatus": "DELIVERING",
    "rider": {
      "riderId": "rider_001",
      "riderName": "李四",
      "riderPhone": "139***900",
      "riderAvatar": "https://hailan.pro/avatar/rider_001.jpg"
    },
    "currentLocation": {
      "latitude": 39.9042,
      "longitude": 116.4074,
      "address": "北京市东城区王府井大街附近"
    },
    "estimatedArrivalTime": "2026-02-03T11:45:00Z",
    "updatedAt": "2026-02-03T11:00:00Z"
  }
}
```

#### 3.4 供应商管理

##### 3.4.1 供应商分类

| 供应商类型 | 类型代码 | 合作模式 | 结算周期 | 账期天数 |
|----------|----------|----------|----------|----------|
| 核心供应商 | CORE | 独家合作 | 月结 | 30天 |
| 重点供应商 | KEY | 长期合作 | 月结 | 45天 |
| 一般供应商 | NORMAL | 短期合作 | 季结 | 60天 |
| 临时供应商 | TEMP | 临时采购 | 现结 | 0天 |

##### 3.4.2 供应商API接口

**创建供应商**

```http
POST /api/supply/supplier/create
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "supplierName": "海蓝科技有限公司",
  "supplierType": "CORE",
  "contactPerson": "张三",
  "contactPhone": "13800138000",
  "contactEmail": "zhangsan@hailan.com",
  "address": {
    "province": "广东省",
    "city": "深圳市",
    "district": "南山区",
    "address": "科技园南区1001号",
    "postalCode": "518057"
  },
  "businessLicense": "440301123456789",
  "taxNumber": "91440300MA5D123456",
  "bankAccount": {
    "bankName": "中国工商银行",
    "accountName": "海蓝科技有限公司",
    "accountNumber": "6222021234567890123"
  },
  "settlementPeriod": "MONTHLY",
  "creditDays": 30,
  "remark": "核心供应商，长期合作"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "supplierId": "supplier_001",
    "supplierName": "海蓝科技有限公司",
    "supplierType": "CORE",
    "supplierCode": "HL202602030001",
    "status": "ACTIVE",
    "contactPerson": "张三",
    "contactPhone": "138***800",
    "contactEmail": "zhang***@hailan.com",
    "settlementPeriod": "MONTHLY",
    "creditDays": 30,
    "createdAt": "2026-02-03T10:00:00Z"
  }
}
```

**查询供应商列表**

```http
GET /api/supply/supplier/list
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| supplierType | string | 否 | 供应商类型：CORE/KEY/NORMAL/TEMP |
| status | string | 否 | 状态：ACTIVE/INACTIVE/SUSPENDED |
| keyword | string | 否 | 关键词搜索 |
| page | number | 否 | 页码，默认1 |
| pageSize | number | 否 | 每页数量，默认20 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "total": 25,
    "page": 1,
    "pageSize": 20,
    "suppliers": [
      {
        "supplierId": "supplier_001",
        "supplierName": "海蓝科技有限公司",
        "supplierType": "CORE",
        "supplierCode": "HL202602030001",
        "status": "ACTIVE",
        "contactPerson": "张三",
        "contactPhone": "138***800",
        "totalPurchaseAmount": 5000000.00,
        "lastPurchaseDate": "2026-01-30",
        "createdAt": "2025-01-01T10:00:00Z"
      },
      {
        "supplierId": "supplier_002",
        "supplierName": "蓝海电子有限公司",
        "supplierType": "KEY",
        "supplierCode": "HL202602030002",
        "status": "ACTIVE",
        "contactPerson": "李四",
        "contactPhone": "139***900",
        "totalPurchaseAmount": 2000000.00,
        "lastPurchaseDate": "2026-01-28",
        "createdAt": "2025-03-15T10:00:00Z"
      }
    ]
  }
}
```

**创建采购订单**

```http
POST /api/supply/purchase/create
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "supplierId": "supplier_001",
  "warehouseId": "wh_001",
  "expectedDeliveryDate": "2026-02-10",
  "items": [
    {
      "productId": "prod_001",
      "productName": "海蓝智能按摩器 Pro",
      "quantity": 100,
      "unitPrice": 150.00,
      "totalPrice": 15000.00
    },
    {
      "productId": "prod_002",
      "productName": "海蓝智能戒指",
      "quantity": 200,
      "unitPrice": 80.00,
      "totalPrice": 16000.00
    }
  ],
  "totalAmount": 31000.00,
  "paymentMethod": "CREDIT",
  "remark": "常规补货"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "purchaseOrderId": "po_001",
    "purchaseOrderNo": "PO2026020300001",
    "supplierId": "supplier_001",
    "supplierName": "海蓝科技有限公司",
    "warehouseId": "wh_001",
    "warehouseName": "北京总仓",
    "expectedDeliveryDate": "2026-02-10",
    "status": "PENDING",
    "totalAmount": 31000.00,
    "paymentMethod": "CREDIT",
    "paymentStatus": "UNPAID",
    "items": [
      {
        "productId": "prod_001",
        "productName": "海蓝智能按摩器 Pro",
        "quantity": 100,
        "unitPrice": 150.00,
        "totalPrice": 15000.00
      },
      {
        "productId": "prod_002",
        "productName": "海蓝智能戒指",
        "quantity": 200,
        "unitPrice": 80.00,
        "totalPrice": 16000.00
      }
    ],
    "createdAt": "2026-02-03T10:00:00Z"
  }
}
```

#### 3.5 退货与售后

##### 3.5.1 退货类型

| 退货类型 | 类型代码 | 退货时效 | 退货条件 | 退款方式 |
|----------|----------|----------|----------|----------|
| 七天无理由 | NO_REASON | 7天 | 商品完好 | 原路退回 |
| 质量问题 | QUALITY | 15天 | 质量问题 | 原路退回 |
| 发货错误 | SHIPPING_ERROR | 30天 | 发货错误 | 原路退回 |
| 商品损坏 | DAMAGED | 7天 | 运输损坏 | 原路退回 |

##### 3.5.2 退货API接口

**创建退货申请**

```http
POST /api/supply/return/create
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "orderId": "order_123",
  "returnType": "NO_REASON",
  "items": [
    {
      "productId": "prod_001",
      "productName": "海蓝智能按摩器 Pro",
      "quantity": 1,
      "reason": "不想要了",
      "images": ["https://hailan.pro/return/img_001.jpg"]
    }
  ],
  "returnAddress": {
    "receiverName": "海蓝售后",
    "receiverPhone": "010-12345678",
    "province": "北京市",
    "city": "北京市",
    "district": "朝阳区",
    "address": "建国路88号",
    "postalCode": "100020"
  },
  "remark": "商品未拆封，全新"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "returnId": "return_001",
    "returnNo": "RT2026020300001",
    "orderId": "order_123",
    "returnType": "NO_REASON",
    "returnStatus": "PENDING",
    "items": [
      {
        "productId": "prod_001",
        "productName": "海蓝智能按摩器 Pro",
        "quantity": 1,
        "reason": "不想要了"
      }
    ],
    "returnAddress": {
      "receiverName": "海蓝售后",
      "receiverPhone": "010-12345678",
      "fullAddress": "北京市北京市朝阳区建国路88号"
    },
    "estimatedRefundAmount": 299.00,
    "createdAt": "2026-02-03T10:00:00Z"
  }
}
```

**审核退货申请**

```http
PUT /api/supply/return/review
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "returnId": "return_001",
  "reviewStatus": "APPROVED",
  "reviewComment": "同意退货，请寄回商品",
  "returnShippingMethod": "FREE_RETURN",
  "returnShippingNo": "SF9876543210"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "returnId": "return_001",
    "returnNo": "RT2026020300001",
    "reviewStatus": "APPROVED",
    "returnStatus": "RETURNING",
    "reviewComment": "同意退货，请寄回商品",
    "reviewedBy": "admin_001",
    "reviewedAt": "2026-02-03T11:00:00Z",
    "returnShippingMethod": "FREE_RETURN",
    "returnShippingNo": "SF9876543210"
  }
}
```

**处理退货**

```http
PUT /api/supply/return/process
Authorization: Bearer {token}
```

**请求参数**

```json
{
  "returnId": "return_001",
  "processStatus": "COMPLETED",
  "actualCondition": "GOOD",
  "refundAmount": 299.00,
  "refundMethod": "ORIGINAL",
  "processImages": ["https://hailan.pro/return/img_002.jpg"],
  "remark": "商品完好，已退款"
}
```

**响应示例**

```json
{
  "success": true,
  "data": {
    "returnId": "return_001",
    "returnNo": "RT2026020300001",
    "processStatus": "COMPLETED",
    "returnStatus": "COMPLETED",
    "actualCondition": "GOOD",
    "refundAmount": 299.00,
    "refundMethod": "ORIGINAL",
    "refundStatus": "SUCCESS",
    "refundedAt": "2026-02-03T14:00:00Z",
    "processedBy": "admin_001",
    "processedAt": "2026-02-03T14:00:00Z"
  }
}
```

#### 3.6 数据统计与分析

##### 3.6.1 库存分析

**库存周转率分析**

```http
GET /api/supply/analytics/inventory-turnover
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| startDate | string | 否 | 开始日期，格式：YYYY-MM-DD |
| endDate | string | 否 | 结束日期，格式：YYYY-MM-DD |
| productId | string | 否 | 商品ID，不传则查询全部 |

**响应示例**

```json
{
  "success": true,
  "data": {
    "startDate": "2026-01-01",
    "endDate": "2026-01-31",
    "summary": {
      "averageInventoryValue": 500000.00,
      "totalSales": 800000.00,
      "inventoryTurnoverRate": 1.6,
      "inventoryTurnoverDays": 18.75
    },
    "products": [
      {
        "productId": "prod_001",
        "productName": "海蓝智能按摩器 Pro",
        "averageInventory": 250,
        "totalSales": 400,
        "inventoryTurnoverRate": 1.6,
        "inventoryTurnoverDays": 18.75,
        "status": "NORMAL"
      },
      {
        "productId": "prod_002",
        "productName": "海蓝智能戒指",
        "averageInventory": 300,
        "totalSales": 100,
        "inventoryTurnoverRate": 0.33,
        "inventoryTurnoverDays": 90.91,
        "status": "SLOW"
      }
    ]
  }
}
```

##### 3.6.2 发货分析

**发货时效分析**

```http
GET /api/supply/analytics/shipping-performance
Authorization: Bearer {token}
```

**请求参数**

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| startDate | string | 否 | 开始日期，格式：YYYY-MM-DD |
| endDate | string | 否 | 结束日期，格式：YYYY-MM-DD |
| shippingType | string | 否 | 发货类型：STANDARD/SF/INSTANT/PICKUP |

**响应示例**

```json
{
  "success": true,
  "data": {
    "startDate": "2026-01-01",
    "endDate": "2026-01-31",
    "summary": {
      "totalOrders": 5000,
      "shippedOrders": 4950,
      "deliveredOrders": 4800,
      "shippingRate": 0.99,
      "deliveryRate": 0.96,
      "avgShippingTime": 24,
      "avgDeliveryTime": 48
    },
    "byShippingType": [
      {
        "shippingType": "STANDARD",
        "totalOrders": 3000,
        "shippedOrders": 2980,
        "deliveredOrders": 2900,
        "avgShippingTime": 24,
        "avgDeliveryTime": 72
      },
      {
        "shippingType": "SF",
        "totalOrders": 1500,
        "shippedOrders": 1480,
        "deliveredOrders": 1450,
        "avgShippingTime": 12,
        "avgDeliveryTime": 36
      },
      {
        "shippingType": "INSTANT",
        "totalOrders": 500,
        "shippedOrders": 490,
        "deliveredOrders": 450,
        "avgShippingTime": 0.5,
        "avgDeliveryTime": 2
      }
    ]
  }
}
```

#### 3.7 安全与合规

##### 3.7.1 数据安全

```typescript
/**
 * 供应链数据安全
 * @description 保护供应链数据的安全性和隐私性
 */
import * as crypto from 'crypto';

/**
 * 加密供应商信息
 * @param supplierData 供应商数据
 * @returns 加密后的数据
 */
function encryptSupplierData(supplierData: any): any {
  const key = process.env.SUPPLIER_ENCRYPTION_KEY;
  const iv = crypto.randomBytes(16);
  
  const cipher = crypto.createCipheriv('aes-256-cbc', key, iv);
  
  let encryptedContactPhone = cipher.update(supplierData.contactPhone, 'utf8', 'hex');
  encryptedContactPhone += cipher.final('hex');
  
  let encryptedBankAccount = cipher.update(supplierData.bankAccount.accountNumber, 'utf8', 'hex');
  encryptedBankAccount += cipher.final('hex');
  
  return {
    ...supplierData,
    contactPhone: encryptedContactPhone,
    bankAccount: {
      ...supplierData.bankAccount,
      accountNumber: encryptedBankAccount
    },
    iv: iv.toString('hex')
  };
}

/**
 * 解密供应商信息
 * @param encryptedData 加密的数据
 * @returns 解密后的数据
 */
function decryptSupplierData(encryptedData: any): any {
  const key = process.env.SUPPLIER_ENCRYPTION_KEY;
  const iv = Buffer.from(encryptedData.iv, 'hex');
  
  const decipher = crypto.createDecipheriv('aes-256-cbc', key, iv);
  
  let decryptedContactPhone = decipher.update(encryptedData.contactPhone, 'hex', 'utf8');
  decryptedContactPhone += decipher.final('utf8');
  
  let decryptedBankAccount = decipher.update(encryptedData.bankAccount.accountNumber, 'hex', 'utf8');
  decryptedBankAccount += decipher.final('utf8');
  
  return {
    ...encryptedData,
    contactPhone: decryptedContactPhone,
    bankAccount: {
      ...encryptedData.bankAccount,
      accountNumber: decryptedBankAccount
    }
  };
}
```

##### 3.7.2 合规要求

| 合规类型 | 合规要求 | 检查频率 | 责任人 |
|----------|----------|----------|--------|
| 供应商资质 | 营业执照、税务登记证 | 每年 | 采购部 |
| 商品质量 | 质量检测报告 | 每批次 | 质检部 |
| 库存安全 | 库存盘点、安全库存 | 每月 | 仓储部 |
| 发货合规 | 物流资质、发货记录 | 每日 | 物流部 |
| 数据隐私 | 数据加密、访问控制 | 持续 | 技术部 |

#### 3.8 最佳实践

##### 3.8.1 库存管理建议

1. **安全库存设置**
   - 根据历史销量设置合理的安全库存
   - 定期调整安全库存水平
   - 建立库存预警机制

2. **库存优化**
   - 分析库存周转率，优化库存结构
   - 及时清理滞销商品
   - 合理安排采购计划

3. **库存盘点**
   - 定期进行库存盘点
   - 及时调整库存差异
   - 优化库存管理流程

##### 3.8.2 发货管理建议

1. **发货时效优化**
   - 优化拣货流程，提高拣货效率
   - 合理安排发货顺序
   - 选择合适的物流服务商

2. **物流跟踪**
   - 实时跟踪物流信息
   - 及时处理物流异常
   - 提高客户满意度

3. **伪装发货**
   - 严格执行伪装发货标准
   - 保护用户隐私
   - 提升用户体验

#### 3.9 常见问题

**Q: 库存不足时如何处理？**
A: 系统会自动触发库存预警，采购部门会根据预警信息及时补货。对于紧急订单，可以协调其他仓库调货。

**Q: O2O配送范围如何确定？**
A: O2O配送范围根据门店位置和配送能力确定，系统会自动计算用户地址与门店的距离，显示可用的配送服务。

**Q: 退货流程需要多长时间？**
A: 退货申请审核通常在24小时内完成，商品寄回后质检和退款处理在3-5个工作日内完成。

**Q: 供应商如何管理？**
A: 供应商按照合作类型分为核心供应商、重点供应商、一般供应商和临时供应商，不同类型供应商有不同的合作模式和结算周期。

---

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」

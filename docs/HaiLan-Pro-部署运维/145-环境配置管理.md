---
file: 145-环境配置管理.md
description: HaiLan Pro 环境配置管理，包含开发、测试、预生产、生产环境配置
author: YanYuCloudCube Team
version: v1.0.0
created: 2026-01-26
updated: 2026-01-26
status: published
tags:
  - HaiLan-Pro-部署运维,[]
---

> ***YanYuCloudCube***
> **标语**：言启象限 | 语枢未来
> ***Words Initiate Quadrants, Language Serves as Core for the Future***
> **标语**：万象归元于云枢 | 深栈智启新纪元
> ***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***

---

# 145 环境配置管理

## 概述

本文档详细描述HaiLan Pro-HaiLan-Pro-部署运维-环境配置管理相关内容，确保项目按照YYC³标准规范进行开发和实施。

## 核心内容

### 1. 背景与目标

#### 1.1 项目背景
HaiLan Pro (海蓝) 是新一代高端、私密、智能的情趣健康生活管理平台。项目基于「五高五标五化」理念，通过 PWA 技术结合 AI 智能辅助与物联网，为用户提供从生理健康到心理愉悦的全方位解决方案。

#### 1.2 项目愿景
打造极致隐私、智能陪伴、品质合规、全场景覆盖的情趣健康生活管理平台，为用户提供安全、专业、高端的健康生活体验。

#### 1.3 核心价值主张
- **极致隐私**：双重加密、隐私浏览模式及伪装发货机制
- **智能陪伴**：基于 LLM 的 AI 情感与生理健康顾问
- **品质合规**：医疗级标准商品，高端"海蓝蓝"视觉调性
- **全场景覆盖**：PWA 端支持离线浏览、桌面安装及无缝推送

#### 1.4 文档目标
- 规范环境配置管理相关的业务标准与技术落地要求
- 为项目相关人员提供清晰的参考依据
- 保障相关模块开发、实施、运维的一致性与规范性

### 2. 设计原则

#### 2.1 五高原则
- **高可用性**：确保系统7x24小时稳定运行，支持PWA离线能力
- **高性能**：优化响应时间和处理能力，支持高并发访问
- **高安全性**：保护用户数据和隐私安全，双重加密机制
- **高扩展性**：支持业务快速扩展，微服务架构设计
- **高可维护性**：便于后续维护和升级，模块化设计

#### 2.2 五标体系
- **标准化**：统一的技术和流程标准
- **规范化**：严格的开发和管理规范
- **自动化**：提高开发效率和质量，CI/CD自动化
- **智能化**：利用AI技术提升能力，LLM智能顾问
- **可视化**：直观的监控和管理界面

#### 2.3 五化架构
- **流程化**：标准化的开发流程
- **文档化**：完善的文档体系
- **工具化**：高效的开发工具链
- **数字化**：数据驱动的决策
- **生态化**：开放的生态系统

### 3. 环境配置管理

#### 3.1 环境划分

HaiLan Pro 采用标准的多环境配置管理策略，确保代码在不同环境间的一致性和可追溯性。

**环境定义：**

| 环境名称 | 用途 | 域名 | 数据隔离 | 访问权限 |
|----------|------|------|----------|----------|
| Development | 本地开发 | localhost:5173 | 独立数据库 | 开发人员 |
| Testing | 自动化测试 | test.hailan.pro | 测试数据库 | CI/CD |
| Staging | 预生产验证 | staging.hailan.pro | 生产数据脱敏副本 | 测试+产品 |
| Production | 生产环境 | hailan.pro | 生产数据库 | 全员 |

#### 3.2 环境变量配置

**开发环境 (.env.development)：**

```bash
# API 配置
VITE_API_URL=http://localhost:3000
VITE_API_TIMEOUT=30000

# Supabase 配置
VITE_SUPABASE_URL=https://dev-xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# 功能开关
VITE_ENABLE_DEBUG=true
VITE_ENABLE_MOCK=true
VITE_ENABLE_AI=true

# 日志配置
VITE_LOG_LEVEL=debug

# 第三方服务
VITE_IPFS_GATEWAY=https://ipfs.io/ipfs
VITE_AI_ENDPOINT=https://api.openai.com/v1
```

**生产环境 (.env.production)：**

```bash
# API 配置
VITE_API_URL=https://api.hailan.pro
VITE_API_TIMEOUT=30000

# Supabase 配置
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# 功能开关
VITE_ENABLE_DEBUG=false
VITE_ENABLE_MOCK=false
VITE_ENABLE_AI=true

# 日志配置
VITE_LOG_LEVEL=error

# 第三方服务
VITE_IPFS_GATEWAY=https://gateway.hailan.pro/ipfs
VITE_AI_ENDPOINT=https://ai.hailan.pro/v1

# 监控配置
VITE_SENTRY_DSN=https://xxxxx@sentry.io/xxxxx
VITE_ANALYTICS_ID=G-XXXXXXXXXX
```

#### 3.3 ConfigMap 管理

**Kubernetes ConfigMap：**

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: hailan-config
  namespace: hailan-pro
data:
  # 环境配置
  environment: "production"
  log-level: "info"
  api-timeout: "30000"

  # Nginx 配置
  nginx.conf: |
    user nginx;
    worker_processes auto;
    error_log /var/log/nginx/error.log warn;
    pid /var/run/nginx.pid;

    events {
        worker_connections 1024;
    }

    http {
        include /etc/nginx/mime.types;
        default_type application/octet-stream;
        sendfile on;
        keepalive_timeout 65;
        gzip on;

        server {
            listen 8080;
            server_name _;
            root /usr/share/nginx/html;

            location / {
                try_files $uri $uri/ /index.html;
            }

            location /health {
                return 200 "healthy\n";
            }
        }
    }

  # 应用配置
  app.json: |
    {
      "name": "hailan-pro",
      "version": "1.0.0",
      "environment": "production",
      "features": {
        "ai": true,
        "iot": true,
        "privacy": true
      }
    }
```

#### 3.4 Secret 管理

**敏感信息管理策略：**

| 密钥类型 | 存储方式 | 轮换周期 | 访问控制 |
|----------|----------|----------|----------|
| 数据库密码 | Kubernetes Secret | 90天 | DBA + DevOps |
| API 密钥 | External Secrets | 30天 | 服务账号 |
| TLS 证书 | cert-manager | 自动 | 自动续期 |
| JWT 密钥 | Kubernetes Secret | 180天 | 认证服务 |

**Secret 配置示例：**

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: hailan-secrets
  namespace: hailan-pro
type: Opaque
stringData:
  # Supabase
  supabase-url: "https://xxxxx.supabase.co"
  supabase-anon-key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  supabase-service-role-key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

  # Redis
  redis-password: "your-redis-password"

  # JWT
  jwt-secret: "your-jwt-secret-key-min-32-chars"

  # 加密
  encryption-key: "your-aes-256-encryption-key"
```

#### 3.5 配置验证

**配置健康检查：**

```typescript
// src/config/health.ts
export async function checkConfigHealth(): Promise<{
  healthy: boolean;
  checks: Record<string, boolean>;
}> {
  const checks = {
    supabase: await checkSupabaseConnection(),
    redis: await checkRedisConnection(),
    ipfs: await checkIPFSConnection(),
  };

  const healthy = Object.values(checks).every(v => v);

  return { healthy, checks };
}

async function checkSupabaseConnection(): Promise<boolean> {
  try {
    const { data, error } = await supabase.from('health').select('*').limit(1);
    return !error;
  } catch {
    return false;
  }
}
```

#### 3.6 配置变更流程

**配置变更管理：**

```
1. 提交变更请求
   ↓
2. 代码审查 (Code Review)
   ↓
3. 测试环境验证
   ↓
4. 预发环境验证
   ↓
5. 生产环境变更
   ↓
6. 监控验证
   ↓
7. 回滚预案 (如需要)
```

---

> 「***YanYuCloudCube***」
> 「***<admin@0379.email>***」
> 「***Words Initiate Quadrants, Language Serves as Core for the Future***」
> 「***All things converge in the cloud pivot; Deep stacks ignite a new era of intelligence***」
